<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Drag Racing - Shift Duel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <script>
        (function () {
            try {
                var loc = window.location;
                var host = loc && loc.hostname ? loc.hostname : '';
                var path = loc && loc.pathname ? loc.pathname : '';
                var isLocalHost = /^(localhost|127\.0\.0\.1|0\.0\.0\.0)$/.test(host) || host.startsWith('192.168.');
                if (!window.DRAG_DEV_PROXY && isLocalHost && path && path.startsWith('/drag/')) {
                    window.DRAG_DEV_PROXY = 'https://server-jeux-millionnaire.onrender.com';
                }
                if (!window.DRAG_API_BASE && window.DRAG_DEV_PROXY) {
                    window.DRAG_API_BASE = window.DRAG_DEV_PROXY;
                }
            } catch (err) {
                /* ignore bootstrap errors */
            }
        })();
    </script>
    <style>
      /* Garantir que l‚Äôiframe occupe tout l‚Äô√©cran sans d√©bordement */
      html, body { height: 100%; overscroll-behavior: none; }
    </style>
    
</head>
<body>
    <div class="auth-bar">
        <div class="auth-left auth-profile">
            <span class="auth-label">Profil</span>
            <span id="authStatus" class="auth-status">Connexion en cours‚Ä¶</span>
        </div>
        <div class="auth-right">
            <span id="authHint" class="auth-hint">D√©connexion via l'accueil du Millionnaire.</span>
        </div>
    </div>
    <main class="wrapper">
        <section class="hud">
            <div class="hud-card">
                <span class="label">Course</span>
                <span class="value" id="hudStage">1</span>
            </div>
            <div class="hud-card">
                <span class="label">Argent</span>
                <span class="value" id="hudCash">0 $</span>
            </div>
            <div class="hud-card">
                <span class="label">Temps r√©alis√©</span>
                <span class="value" id="hudTime">‚Äî</span>
            </div>
            <div class="hud-card">
                <span class="label">Meilleur temps</span>
                <span class="value" id="hudBestTime">‚Äî</span>
            </div>
            <div class="hud-card">
                <span class="label">Dernier shift</span>
                <span class="value" id="hudShift">‚Äî</span>
            </div>
            <div class="hud-card">
                <span class="label">Vitesse max</span>
                <span class="value" id="hudTopSpeed">0 km/h</span>
            </div>
            <div class="hud-card">
                <span class="label">RPM max</span>
                <span class="value" id="hudTopRpm">0</span>
            </div>
        </section>

        <section class="game-shell">
            <div class="playfield">
                <canvas id="trackCanvas" width="960" height="540"></canvas>
                <div class="overlay">
                    <div class="status-banner" id="statusBanner">
                        Maintiens la p√©dale (fl√®che haut ou bouton), utilise Nitro (N/X ou bouton) et change de vitesse dans la zone verte.
                    </div>
                </div>
            </div>

            <!-- Page d'accueil: connexion (barre en haut), modes, garage/r√©glages et actions -->
            <section class="home-screen" id="homeScreen">
                <h2 class="home-title">Drag Shift Duel</h2>
                <p class="home-sub">Choisis ton mode, v√©rifie tes r√©glages et lance la course.</p>

                <!-- S√©lection du mode de course -->
                <div class="mode-select" id="modeSelect">
                    <h3>Choisis ton mode</h3>
                    <div class="mode-buttons">
                        <button id="modeWorld" class="secondary-button" type="button" data-mode="world" title="Contre le meilleur fant√¥me mondial">Record mondial ‚Ä¢ +1 000 000 $</button>
                        <button id="modePvP" class="secondary-button" type="button" data-mode="pvp" title="Contre le meilleur fant√¥me d'un autre joueur">PvP ‚Ä¢ +500 000 $</button>
                        <button id="modeGhost" class="secondary-button" type="button" data-mode="ghost" title="Contre ton fant√¥me IA (10e meilleur)">Fant√¥me IA ‚Ä¢ +50 000 $</button>
                    </div>
                </div>

                <!-- Raccourcis et options de vue -->
                <div class="home-actions">
                    <button id="garageButton" class="secondary-button" type="button">Garage &amp; R√©glages</button>
                    <div class="spacer"></div>
                    <button id="exitButton" class="secondary-button" type="button" title="Revenir au Jeu du Millionnaire">Sortir</button>
                </div>

                <!-- Lancer la course en bas -->
                <div class="home-start">
                    <button id="startButton" class="primary-button" type="button">Lancer la course</button>
                </div>
            </section>
            
            <!-- Barre de contr√¥les sous la piste: √† gauche Gaz + Nitro, au centre le cadran, √† droite le Shifter -->
            <div class="race-controls" id="raceControls">
                <div class="race-left">
                    <button id="gasButton" class="pedal-button" type="button" aria-label="P√©dale d'acc√©l√©rateur">Acc√©l√©rer</button>
                    <button id="nitroButton" class="nitro-button" type="button" aria-label="Activer le nitro">Nitro</button>
                </div>
                
                <div class="race-center">
                    <div class="gauge-panel">
                        <canvas id="rpmCanvas" width="280" height="280"></canvas>
                        <div class="gear-display">
                            <span class="gear-label">Rapport</span>
                            <span class="gear-value" id="gearValue">N</span>
                        </div>
                    </div>
                </div>
                
                <div class="race-right">
                    <button id="shiftButton" class="pedal-button shift-mode" type="button" aria-label="Changer de vitesse">SHIFT</button>
                </div>
            </div>
        </section>
    </main>

    <div id="garageOverlay" class="garage-overlay" hidden>
        <div class="garage-panel" role="dialog" aria-modal="true" aria-labelledby="garageTitle">
            <header class="garage-header">
                <h2 id="garageTitle">Garage</h2>
                <button id="closeGarageButton" class="icon-button" type="button" aria-label="Fermer le garage">&times;</button>
            </header>
            
            <div class="garage-tabs">
                <button id="tabUpgrades" class="garage-tab active" type="button" data-tab="upgrades">Am√©liorations</button>
                <button id="tabSettings" class="garage-tab" type="button" data-tab="settings">R√©glages</button>
            </div>
            
            <div class="garage-content">
                <!-- Onglet Am√©liorations (Upgrades) -->
                <section id="upgradesPanel" class="garage-section tab-panel active">
                    <div class="upgrade-card">
                        <h3>Moteur</h3>
                        <p class="upgrade-description">
                            Niveau <span id="engineLevelDisplay">1</span>/20<br>
                            <span id="enginePowerDisplay">130 HP</span> (Corolla)
                        </p>
                        <div class="upgrade-actions">
                            <button id="buyEngineButton" class="primary-button" type="button">
                                Am√©liorer - 1 000 000 $ + <span class="reward-icon">üì∫</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="upgrade-card">
                        <h3>Transmission</h3>
                        <p class="upgrade-description">
                            Niveau <span id="transmissionLevelDisplay">1</span>/5<br>
                            <span id="transmissionDesc">5 vitesses Corolla (fixe)</span>
                        </p>
                        <div class="upgrade-actions">
                            <button id="buyTransmissionButton" class="primary-button" type="button">
                                Am√©liorer - 1 000 000 $ + <span class="reward-icon">üì∫</span>
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Onglet R√©glages (Settings) -->
                <section id="settingsPanel" class="garage-section tab-panel">
                    <h3>√âtagement des vitesses</h3>
                    <p class="section-hint">Ajuste les ratios pour espacer ou rapprocher les rapports. 1.00 = valeur d'origine.</p>
                    <div class="slider-list" id="gearSliderList"></div>
                    
                    <h3>Moteur</h3>
                    <div class="slider-group">
                        <label for="engineSlider">Force moteur</label>
                        <input id="engineSlider" type="range" min="0.9" max="1.7" step="0.05" value="1.0" />
                        <span id="engineValue" class="slider-value">1.00√ó</span>
                    </div>
                    
                    <h3>Nitro</h3>
                    <div class="slider-group">
                        <label for="nitroPowerSlider">Puissance</label>
                        <input id="nitroPowerSlider" type="range" min="1" max="1.9" step="0.05" value="1.4" />
                        <span id="nitroPowerValue" class="slider-value">1.40√ó</span>
                    </div>
                    <div class="slider-group">
                        <label for="nitroDurationSlider">Dur√©e (s)</label>
                        <input id="nitroDurationSlider" type="range" min="0.6" max="3" step="0.1" value="1.5" />
                        <span id="nitroDurationValue" class="slider-value">1.5 s</span>
                    </div>
                    <div class="slider-group">
                        <label for="nitroChargesSlider">Charges</label>
                        <input id="nitroChargesSlider" type="range" min="1" max="3" step="1" value="1" />
                        <span id="nitroChargesValue" class="slider-value">1</span>
                    </div>
                </section>
            </div>
            
            <footer class="garage-footer">
                <button id="resetGarageButton" class="secondary-button" type="button">R√©initialiser</button>
                <button id="applyGarageButton" class="primary-button" type="button">Appliquer</button>
            </footer>
        </div>
    </div>

    <footer class="footer">
        <p>
            Drag Shift Duel ‚Äî maintiens le moteur dans la zone verte, encha√Æne les shifts parfaits et laisse
            l'adversaire dans ton r√©tro.
        </p>
    </footer>

    <script src="main.js"></script>
</body>
</html>
