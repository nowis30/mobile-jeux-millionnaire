"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{6325:function(t,e,o){o.d(e,{Fy:function(){return A},Ie:function(){return h},Nf:function(){return g},YY:function(){return s},fL:function(){return f},showInterstitialAd:function(){return u},yk:function(){return w}});let n=!1,a=0,r=0;try{{let t=localStorage.getItem("hm-ads-rewarded-last"),e=t?Number(t):0;!Number.isNaN(e)&&e>0&&(r=e)}}catch(t){}function l(){let t=window.Capacitor,e=!1;try{let o=null==t?void 0:t.isNativePlatform;"function"==typeof o?e=!!o():(null==t?void 0:t.platform)&&"web"!==t.platform&&(e=!0)}catch(t){}return console.log("[Ads] isNativePlatform:",e),console.log("[Ads] Capacitor available:",!!t),console.log("[Ads] Capacitor.platform:",null==t?void 0:t.platform),e}function i(){var t;let e=window.Capacitor;return(console.log("[Ads] Capacitor:",e),console.log("[Ads] Capacitor.Plugins:",null==e?void 0:e.Plugins),console.log("[Ads] Capacitor.Plugins.AdMob:",null==e?void 0:null===(t=e.Plugins)||void 0===t?void 0:t.AdMob),null==e?void 0:e.Plugins)?e.Plugins.AdMob:null}async function s(){if(!n){if(!l()){console.log("[Ads] Skip initialization (web/PWA)");return}try{let t=localStorage.getItem("hm-ad-consent");if(!t||"refused"===t){let e=i();if(e&&"function"==typeof e.requestConsent)try{let o=await e.requestConsent();if(o&&"boolean"==typeof o.npa){let e=o.npa?"npa":"accepted";try{localStorage.setItem("hm-ad-consent",e),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(t){}t=e}}catch(t){console.warn("[Ads] Native requestConsent failed:",t)}}if("refused"===t){t="npa";try{localStorage.setItem("hm-ad-consent","npa"),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(t){}}if("accepted"!==t&&"npa"!==t){console.log("[Ads] User has not accepted ad consent, skipping initialization");return}}catch(t){}try{let l=i();if(!l){console.log("[Ads] AdMob plugin not available");return}await l.initialize(),n=!0;try{var t,e,o,a,r;null===(t=l.addListener)||void 0===t||t.call(l,"adShowed",()=>console.log("[Ads] Event: adShowed")),null===(e=l.addListener)||void 0===e||e.call(l,"adDismissed",()=>console.log("[Ads] Event: adDismissed")),null===(o=l.addListener)||void 0===o||o.call(l,"rewardedAdShowed",()=>console.log("[Ads] Event: rewardedAdShowed")),null===(a=l.addListener)||void 0===a||a.call(l,"rewardedAdDismissed",()=>console.log("[Ads] Event: rewardedAdDismissed")),null===(r=l.addListener)||void 0===r||r.call(l,"rewardEarned",t=>console.log("[Ads] Event: rewardEarned",t))}catch(t){console.warn("[Ads] Failed to attach listeners:",t)}await c(),await d(),console.log("[Ads] AdMob initialized successfully")}catch(t){console.error("[Ads] Failed to initialize AdMob:",t)}}}async function c(){if(!l())return;let t=i();if(t&&n)try{await t.loadInterstitial(),console.log("[Ads] Interstitial ad loaded")}catch(t){console.error("[Ads] Failed to load interstitial ad:",t)}}async function d(){if(!l())return;let t=i();if(t&&n)try{await t.loadRewardedAd(),console.log("[Ads] Rewarded ad loaded")}catch(t){console.error("[Ads] Failed to load rewarded ad:",t)}}async function u(){if(!l())return console.log("[Ads] Not on native platform"),!1;let t=i();if(!t||!n)return console.log("[Ads] AdMob not initialized"),!1;let e=Date.now();if(e-a<12e4)return console.log("[Ads] Too soon to show another ad"),!1;try{let{ready:o}=await t.isAdReady();if(!o)return console.log("[Ads] No ad ready to show, loading new one..."),c(),!1;return await t.showInterstitial(),a=e,c(),console.log("[Ads] Interstitial ad shown successfully"),!0}catch(t){return console.error("[Ads] Failed to show interstitial ad:",t),!1}}async function f(t){var e;if(!l())return console.log("[Ads] Not on native platform"),!1;let o=i();if(!o||!n)return console.log("[Ads] AdMob not initialized"),!1;let a="function"==typeof t?{onReward:t}:null!=t?t:{},s=null!==(e=a.ignoreCooldown)&&void 0!==e&&e,c=Date.now();if(!s&&c-r<3e5){let t=Math.ceil((3e5-(c-r))/6e4);return console.log("[Ads] Too soon to show another rewarded ad. Wait ".concat(t," more minutes")),!1}try{let{ready:t}=await o.isRewardedAdReady();if(!t)return console.log("[Ads] No rewarded ad ready to show, loading new one..."),d(),!1;let e=await o.showRewardedAd();if(!s){r=c;try{localStorage.setItem("hm-ads-rewarded-last",String(c))}catch(t){}}return a.onReward&&a.onReward(e.amount,e.type),d(),console.log("[Ads] Rewarded ad shown successfully. Reward: ".concat(e.amount," ").concat(e.type)),!0}catch(t){return console.error("[Ads] Failed to show rewarded ad:",t),!1}}async function w(t){if(!l())return!1;let e=i();if(!e||!n)return!1;let o=Date.now();if(!(null==t?void 0:t.ignoreCooldown)&&o-r<3e5)return!1;try{let{ready:t}=await e.isRewardedAdReady();return t}catch(t){return!1}}function h(){let t=Date.now()-r;return t>=3e5?0:Math.ceil((3e5-t)/1e3)}function g(){return l()}async function A(){if(!l())return!1;let t=i();if(!t||!n)return!1;try{let{ready:e}=await t.isAdReady();return e}catch(t){return!1}}},9513:function(t,e,o){o.d(e,{MS:function(){return c},SC:function(){return w},Sg:function(){return s}});var n=o(5050);let a="https://server-jeux-millionnaire.onrender.com",r=!!window.Capacitor,l=/localhost:3000$/.test(window.location.host),i="1"===n.env.NEXT_PUBLIC_FORCE_ABS,s=r||i||!l?a:"";console.log("[API] ABS_BACKEND:",a),console.log("[API] isCapacitor:",r),console.log("[API] isLocalDev:",l),console.log("[API] forceAbs:",i),console.log("[API] API_BASE:",s);class c extends Error{constructor(t,e){super(e),this.name="ApiError",this.status=t,Object.setPrototypeOf(this,c.prototype)}}let d=null,u="HM_TOKEN";async function f(){try{var t;if(d)return d;let e=await fetch("".concat(s,"/api/auth/csrf"),{credentials:"include"});if(!e.ok)return null;let o=await e.json();return d=null!==(t=null==o?void 0:o.csrf)&&void 0!==t?t:null}catch(t){return null}}async function w(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(e.method||"GET").toUpperCase(),n={...e.headers};if(console.log("[API] ".concat(o," ").concat(s).concat(t)),["POST","PUT","PATCH","DELETE"].includes(o)){let t=await f();t&&(n["x-csrf-token"]=t)}let a=function(){try{return window.localStorage.getItem(u)}catch(t){return null}}();a&&(n.Authorization="Bearer ".concat(a));let r=function(){try{let t=window.localStorage.getItem("hm-session");if(!t)return null;return JSON.parse(t).playerId||null}catch(t){return null}}();r&&(n["X-Player-ID"]=r);try{let o=await fetch("".concat(s).concat(t),{credentials:"include",...e,headers:n});if(console.log("[API] Response ".concat(o.status," ").concat(o.statusText)),401===o.status)try{if(a){let o=await fetch("".concat(s,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(a)}});if(o.ok){let a=await o.json().catch(()=>({}));if(null==a?void 0:a.token){try{window.localStorage.setItem(u,a.token)}catch(t){}n.Authorization="Bearer ".concat(a.token)}let r=await fetch("".concat(s).concat(t),{credentials:"include",...e,headers:n});if(!r.ok)throw new c(r.status,r.statusText);if(204===r.status)return;return await r.json()}}}catch(t){}if(!o.ok)try{if((o.headers.get("content-type")||"").includes("application/json")){let t=await o.json(),e=t&&(t.error||t.message)?String(t.error||t.message):"Erreur ".concat(o.status);throw new c(o.status,e)}{let t=(await o.text()||"").trim(),e=t.length?t:o.statusText?"".concat(o.status," ").concat(o.statusText):"Erreur ".concat(o.status);throw new c(o.status,e)}}catch(e){let t=o.statusText?"".concat(o.status," ").concat(o.statusText):"Erreur ".concat(o.status);if(e instanceof c)throw e;throw new c(o.status,t)}if(204===o.status)return;return await o.json()}catch(t){throw console.error("[API] Fetch error:",t),new c(0,"Erreur r\xe9seau: ".concat(t.message||"Failed to fetch"))}}},2705:function(t,e,o){o.d(e,{Aj:function(){return r},Ov:function(){return l},dF:function(){return a}});let n="hm-session";function a(){let t=window;if(!t)return null;try{let e=t.localStorage.getItem(n);if(!e)return null;let o=JSON.parse(e);if(!o.gameId)return null;return o}catch(t){return console.error("loadSession error",t),null}}function r(t){let e=window;e&&e.localStorage.setItem(n,JSON.stringify(t))}function l(){let t=window;t&&t.localStorage.removeItem(n)}},4233:function(t,e,o){o.d(e,{default:function(){return a.a}});var n=o(7498),a=o.n(n)}}]);