(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[45],{9068:function(e,t,n){Promise.resolve().then(n.bind(n,9559))},9559:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(7821),a=n(8078),o=n(9513),s=n(6325);function l(){var e;let[t,n]=(0,a.useState)(null),[l,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,f]=(0,a.useState)(0),[h,m]=(0,a.useState)(0),[p,g]=(0,a.useState)(5e3),[x,v]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null),[b,N]=(0,a.useState)(null),[j,A]=(0,a.useState)(null),[S,k]=(0,a.useState)([]),[I,C]=(0,a.useState)(0),E=(0,a.useRef)(null),[T,P]=(0,a.useState)(!1),[M,R]=(0,a.useState)(0),L=(0,a.useRef)(null),D=(0,a.useRef)(null),O=(0,a.useRef)(!1),F=(0,a.useRef)(!1),z=(0,a.useRef)(0),$=(0,a.useRef)(0),_=(0,a.useRef)(0),q=null!=c?Math.min(1e9,Math.max(5e3,Math.floor(.5*Math.max(0,c)))):null,[B,J]=(0,a.useState)(!1),[X,U]=(0,a.useState)(0),[Y,H]=(0,a.useState)(!1),[K,G]=(0,a.useState)(null),[W,Q]=(0,a.useState)(null);function V(){L.current&&(clearTimeout(L.current),L.current=null),D.current&&(clearInterval(D.current),D.current=null),R(0)}function Z(e){if(!O.current)return;V();let t=null!=e?e:2500;if($.current>0&&(t=Math.max(t,$.current+500)),z.current<=0){if(_.current>0)t=Math.max(t,1e3*_.current+500);else{P(!1),N(e=>null!=e?e:"Auto-roll arr\xeat\xe9 (plus de tokens).");return}}let n=Date.now();R(t),L.current=setTimeout(()=>{if(L.current=null,D.current&&(clearInterval(D.current),D.current=null),R(0),O.current){if(F.current){Z(500);return}if(z.current<=0){if(_.current>0){Z(Math.max(2500,1e3*_.current+500));return}P(!1),N(e=>null!=e?e:"Auto-roll arr\xeat\xe9 (plus de tokens).");return}ea()}},t),D.current=setInterval(()=>{R(Math.max(0,t-(Date.now()-n)))},200)}(0,a.useEffect)(()=>{try{let e=localStorage.getItem("pari-history");if(e){let t=JSON.parse(e);Array.isArray(t)&&k(t.slice(0,100))}}catch(e){}},[]),(0,a.useEffect)(()=>{try{localStorage.setItem("pari-history",JSON.stringify(S.slice(0,100)))}catch(e){}},[S]),(0,a.useEffect)(()=>{if(I<=0)return;let e=setInterval(()=>{C(e=>e-200)},200);return()=>clearInterval(e)},[I]),(0,a.useEffect)(()=>{O.current=T,T||V()},[T]),(0,a.useEffect)(()=>{F.current=x},[x]),(0,a.useEffect)(()=>{z.current=d},[d]),(0,a.useEffect)(()=>{$.current=I},[I]),(0,a.useEffect)(()=>{_.current=h},[h]),(0,a.useEffect)(()=>()=>{L.current&&clearTimeout(L.current),D.current&&clearInterval(D.current)},[]),(0,a.useEffect)(()=>{(0,s.YY)()},[]),(0,a.useEffect)(()=>{let e=!1,t=async()=>{try{let t=await (0,s.yk)();if(e||J(t),!e){let e=(0,s.Ie)();e>0&&U(t=>Math.max(t,e))}}catch(e){}};t();let n=setInterval(t,15e3);return()=>{e=!0,clearInterval(n)}},[]),(0,a.useEffect)(()=>{if(X<=0)return;let e=setInterval(()=>{U(e=>e>0?e-1:0)},1e3);return()=>clearInterval(e)},[X>0]);let ee=(0,a.useCallback)(async()=>{try{var e;let t=localStorage.getItem("hm-session");if(console.log("[Pari] session localStorage:",t),t){let e=JSON.parse(t);if(null==e?void 0:e.gameId)return n(e.gameId),i(e.playerId),!0}console.warn("[Pari] Pas de session — fallback auto-join");let r=await (0,o.SC)("/api/games"),a=null===(e=r.games)||void 0===e?void 0:e[0];if(!a)throw Error("Aucune partie disponible");let s=await (0,o.SC)("/api/games/".concat(a.id,"/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),l={gameId:a.id,playerId:s.playerId,nickname:""};try{localStorage.setItem("hm-session",JSON.stringify(l))}catch(e){}return n(a.id),i(s.playerId),console.log("[Pari] Auto-join OK"),!0}catch(e){return console.error("[Pari] ensureSession erreur:",e.message),!1}},[]);(0,a.useEffect)(()=>{(async()=>{await ee()})()},[ee]);let et=(0,a.useCallback)(async()=>{var e,n,r,a,s,i;if(t&&l)try{let i=await (0,o.SC)("/api/games/".concat(t,"/tokens"),{headers:{"X-Player-ID":l}}),c=Number(null!==(a=null==i?void 0:null===(e=i.pari)||void 0===e?void 0:e.tokens)&&void 0!==a?a:0),u=Number(null!==(s=null==i?void 0:null===(n=i.pari)||void 0===n?void 0:n.secondsUntilNext)&&void 0!==s?s:0);f(c),m(u),"number"==typeof(null==i?void 0:null===(r=i.pari)||void 0===r?void 0:r.adCooldownSeconds)&&U(e=>Math.max(e,Number(i.pari.adCooldownSeconds)))}catch(e){console.warn("[Pari] /tokens erreur",null!==(i=null==e?void 0:e.message)&&void 0!==i?i:e)}},[t,l]);function en(e){g(t=>{let n=Math.max(5e3,e);return null!=c?Math.min(n,null!=q?Math.min(q,c):c):n})}(0,a.useEffect)(()=>{t&&l&&(async()=>{try{var e;let n=await fetch("".concat(o.Sg,"/api/games/").concat(t,"/me"),{headers:{"X-Player-ID":l},credentials:"include"});if(!n.ok)return;let r=await n.json();(null===(e=r.player)||void 0===e?void 0:e.cash)!=null&&u(r.player.cash)}catch(e){console.warn("[Pari] /me erreur",e.message)}})()},[t,l]),(0,a.useEffect)(()=>{if(!t||!l)return;let e=!0,n=async()=>{e&&await et()};n();let r=setInterval(n,15e3);return()=>{e=!1,clearInterval(r)}},[t,l,et]);let er=(0,a.useCallback)(async()=>{if(!t||!l){Q("Session inconnue. Rejoignez une partie depuis l'accueil.");return}if(!Y){H(!0),Q(null),G(null);try{var e,n;if(!await (0,s.yk)()){let e=(0,s.Ie)();throw e>0&&U(t=>Math.max(t,e)),Error("La publicit\xe9 n'est pas pr\xeate. R\xe9essayez dans quelques instants.")}if(!await (0,s.fL)())throw Error("Impossible d'afficher la publicit\xe9 pour le moment.");let r=await (0,o.SC)("/api/games/".concat(t,"/tokens/ads"),{method:"POST",headers:{"Content-Type":"application/json","X-Player-ID":l},body:JSON.stringify({type:"pari"})}),a=Number(null!==(e=null==r?void 0:r.added)&&void 0!==e?e:0);"number"==typeof(null==r?void 0:r.tokens)&&f(r.tokens),G(a>0?"+".concat(a," tokens ajout\xe9s ✅"):"Tokens d\xe9j\xe0 au maximum ✅");let i=Number(null!==(n=null==r?void 0:r.cooldownSeconds)&&void 0!==n?n:0),c=(0,s.Ie)(),u=Math.max(i,c);u>0&&U(e=>Math.max(e,u)),await et()}catch(e){if(e instanceof o.MS){if(Q(e.message),429===e.status){let t=e.message.match(/(\d+)/);if(t){let e=Number(t[1]);Number.isNaN(e)||U(t=>Math.max(t,60*e))}}}else e instanceof Error?Q(e.message):Q("Impossible de recharger via publicit\xe9.")}finally{H(!1),setTimeout(()=>{(0,s.yk)().then(e=>J(e))},500)}}},[t,l,Y,et]);async function ea(){if(!t||!l){N("Joueur ou partie inconnus (assurez-vous d'avoir d\xe9j\xe0 une session ailleurs)");return}if(I>0){N("Cooldown actif");return}if(d<=0){N("Pas assez de tokens Pari (\uD83C\uDF9F️)");return}if(null!=c&&p>c){N("Mise sup\xe9rieure \xe0 votre cash disponible");return}N(null),y(null),v(!0),C(2e3),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>C(0),2e3);let e=setInterval(()=>{A([1,2,3].map(()=>Math.floor(6*Math.random())+1))},120);try{let e=await fetch("".concat(o.Sg,"/api/games/").concat(t,"/pari/play"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-Player-ID":l},body:JSON.stringify({bet:p})}),n=await e.json();if(e.ok){let e={...n,ts:Date.now()};y(e),null!=n.finalCash&&u(n.finalCash),A(n.dice),k(t=>[e,...t].slice(0,50)),"number"==typeof n.tokensLeft&&f(Number(n.tokensLeft))}else N(n.error||"Erreur pari")}catch(e){N(e.message)}finally{clearInterval(e),v(!1),O.current&&Z()}}(0,a.useEffect)(()=>{if(T&&!x&&!L.current){if(d>0&&I<=0){Z(400);return}d<=0&&h>0&&Z(Math.max(2500,1e3*h+500))}},[T,x,d,I,h]);let eo=S.reduce((e,t)=>e+(t.bet||0),0),es=S.reduce((e,t)=>e+(t.gain||0),0),el=S.reduce((e,t)=>e+(t.netResult||0),0),ei=(0,a.useCallback)(e=>{if(e<=0)return"";let t=Math.floor(e/60),n=e%60;return t>0?"".concat(t,"m ").concat(n.toString().padStart(2,"0"),"s"):"".concat(n,"s")},[]);return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-indigo-900 to-purple-900 text-white p-4",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-8",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83C\uDFB2 Pari (Prototype)"}),(0,r.jsx)("a",{href:"/",className:"text-sm underline hover:text-yellow-300",children:"← Retour"})]}),(0,r.jsxs)("div",{className:"bg-white/10 backdrop-blur rounded-xl p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Game: ",t?t.slice(0,8)+"…":"—"]}),(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Player: ",l?l.slice(0,8)+"…":"—"]}),(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Cash: ",null!=c?c.toLocaleString()+" $":"—"]}),(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Tokens \uD83C\uDF9F️: ",d,"/",100," ",d<=0&&h>0?"(+5 dans ".concat(Math.floor(h/60),"m)"):""]}),(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Total mis\xe9: ",eo.toLocaleString()," $"]}),(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Total gagn\xe9: ",es.toLocaleString()," $"]}),(0,r.jsxs)("div",{className:"px-3 py-2 bg-white/5 rounded-md",children:["Net: ",el.toLocaleString()," $"]})]}),d<=0&&(0,r.jsx)("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded text-sm text-center",children:"Plus de tokens disponibles. Attendez la r\xe9g\xe9n\xe9ration automatique (+5/h) ou regardez une pub pour +20 tokens."}),(0,r.jsxs)("div",{className:"bg-indigo-900/40 border border-indigo-500/30 rounded-lg p-4 space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-indigo-100",children:"Recharge publicitaire \uD83C\uDF81"}),(0,r.jsx)("p",{className:"text-xs text-indigo-200/70",children:"Regardez une pub r\xe9compens\xe9e pour regagner +20 tokens (cooldown 30 min)."})]}),(0,r.jsx)("button",{type:"button",onClick:er,disabled:Y||X>0||!B||d>=100,className:"w-full py-2 rounded-lg font-semibold transition ".concat(Y||X>0||!B||d>=100?"bg-white/10 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-400 to-green-500 text-black hover:from-emerald-300 hover:to-green-400"),children:Y?"Lecture en cours…":X>0?"Disponible dans ".concat(ei(X)):d>=100?"Tokens d\xe9j\xe0 au maximum":B?"\uD83D\uDCFA Regarder une pub (+20 tokens)":"Pub indisponible sur cette plateforme"}),K&&(0,r.jsx)("div",{className:"text-xs text-emerald-300",children:K}),W&&(0,r.jsx)("div",{className:"text-xs text-red-300",children:W})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"text-sm font-semibold",children:["Mise (min ",5e3.toLocaleString()," $)",null!=q?" \xb7 plafond dynamique ".concat(q.toLocaleString()," $"):""]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"number",min:5e3,value:p,onChange:e=>en(Number(e.target.value)),className:"bg-white/10 px-3 py-2 rounded w-40 outline-none focus:ring-2 focus:ring-indigo-400"}),(0,r.jsx)("div",{className:"flex gap-1",children:[5e3,1e4,2e4,5e4].map(e=>(0,r.jsxs)("button",{onClick:()=>en(e),className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded",children:[e/1e3,"k"]},e))})]})]}),(0,r.jsx)("button",{disabled:x||p<5e3||null!=c&&p>c||I>0||d<=0,onClick:ea,className:"relative w-full py-3 rounded-lg font-bold text-lg bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 disabled:from-gray-600 disabled:to-gray-600 disabled:cursor-not-allowed",children:x?"Lancement…":I>0?"Cooldown ".concat((I/1e3).toFixed(1),"s"):d<=0?"Pas de tokens":"Lancer les d\xe9s"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 text-xs text-gray-300",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>P(e=>!e),className:"px-3 py-1 rounded-full border text-xs font-semibold transition ".concat(T?"bg-emerald-400 text-black border-emerald-300 hover:bg-emerald-300":"bg-white/10 border-white/20 text-gray-200 hover:bg-white/20"),title:"Active lancers automatiques tant que des tokens sont disponibles",children:T?"Auto-roll activ\xe9":"Activer auto-roll"}),(0,r.jsx)("span",{className:"font-medium text-gray-200",children:"Auto-roll"})]}),T&&(0,r.jsx)("span",{className:"text-xs text-indigo-200",children:d<=0?"En attente de tokens… (~".concat(Math.max(0,h),"s)"):M>0?"Prochain lancer auto dans ".concat((M/1e3).toFixed(1),"s"):"Lancer auto imminent"})]}),b&&(0,r.jsx)("div",{className:"p-3 bg-red-600/80 rounded text-sm",children:b})]}),(0,r.jsxs)("div",{className:"bg-white/5 backdrop-blur rounded-xl p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"R\xe9sultat"}),(0,r.jsx)("div",{className:"flex justify-center gap-4",children:(j||(null==w?void 0:w.dice)||[1,1,1]).map((e,t)=>(0,r.jsx)("div",{className:"w-20 h-20 rounded-xl flex items-center justify-center text-3xl font-extrabold shadow-lg transition ".concat(x?"animate-pulse":""," bg-white text-black border border-black/20"),children:e},t))}),(0,r.jsx)("div",{className:"text-center text-sm text-gray-300",children:w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-lg font-bold mt-2",children:w.description}),(0,r.jsxs)("div",{className:"mt-1",children:["Mise: ",w.bet.toLocaleString()," $"]}),(0,r.jsx)("div",{className:w.netResult>=0?"text-green-400 font-semibold":"text-red-400 font-semibold",children:w.netResult>=0?"+".concat(w.netResult.toLocaleString()," $ net"):"".concat(w.netResult.toLocaleString()," $ net")}),(0,r.jsxs)("div",{className:"mt-1 text-gray-400",children:["Cash final: ",null===(e=w.finalCash)||void 0===e?void 0:e.toLocaleString()," $"]})]}):(0,r.jsx)("div",{children:"Aucun lancer encore."})}),(0,r.jsx)("div",{className:"text-xs text-gray-400 text-center",children:"R\xe8gles: triple = somme des 3 d\xe9s (ex: 6-6-6 ⇒ x18), double = valeur du d\xe9 doubl\xe9 (ex: 4-4-1 ⇒ x4), suite (3 cons\xe9cutifs) = x2. Sinon la mise est perdue."})]}),(0,r.jsxs)("div",{className:"bg-white/10 backdrop-blur rounded-xl p-6 space-y-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Historique r\xe9cent"}),(0,r.jsxs)("div",{className:"space-y-2 max-h-72 overflow-auto text-sm",children:[0===S.length&&(0,r.jsx)("div",{className:"text-gray-400",children:"Aucun lancer sauvegard\xe9."}),S.slice(0,15).map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between bg-white/5 rounded px-3 py-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.ts).toLocaleTimeString()}),(0,r.jsx)("div",{className:"flex gap-1",children:e.dice.map((e,t)=>(0,r.jsx)("span",{className:"inline-block w-6 text-center font-mono",children:e},t))}),(0,r.jsx)("span",{className:"text-indigo-300",children:e.combination})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("span",{className:"text-gray-300",children:["Mise ",e.bet.toLocaleString(),"$"]}),(0,r.jsxs)("span",{className:e.netResult>=0?"text-green-400":"text-red-400",children:[e.netResult>=0?"+":"",e.netResult.toLocaleString(),"$"]})]})]},e.ts))]})]})]})})}},6325:function(e,t,n){"use strict";n.d(t,{Ie:function(){return m},YY:function(){return i},fL:function(){return f},showInterstitialAd:function(){return d},yk:function(){return h}});let r=!1,a=0,o=0;function s(){var e,t,n;let r=!!(null===(t=window.Capacitor)||void 0===t?void 0:null===(e=t.isNativePlatform)||void 0===e?void 0:e.call(t));return console.log("[Ads] isNativePlatform:",r),console.log("[Ads] Capacitor available:",!!window.Capacitor),console.log("[Ads] Capacitor.isNativePlatform:",null===(n=window.Capacitor)||void 0===n?void 0:n.isNativePlatform),r}function l(){var e;let t=window.Capacitor;return(console.log("[Ads] Capacitor:",t),console.log("[Ads] Capacitor.Plugins:",null==t?void 0:t.Plugins),console.log("[Ads] Capacitor.Plugins.AdMob:",null==t?void 0:null===(e=t.Plugins)||void 0===e?void 0:e.AdMob),null==t?void 0:t.Plugins)?t.Plugins.AdMob:null}async function i(){if(!r&&s()){try{let e=localStorage.getItem("hm-ad-consent");if(!e){let t=l();if(t&&"function"==typeof t.requestConsent)try{let n=await t.requestConsent();if(n&&"boolean"==typeof n.npa){let t=n.npa?"npa":"accepted";try{localStorage.setItem("hm-ad-consent",t),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(e){}e=t}}catch(e){console.warn("[Ads] Native requestConsent failed:",e)}}if("accepted"!==e&&"npa"!==e){console.log("[Ads] User has not accepted ad consent, skipping initialization");return}}catch(e){}try{let s=l();if(!s){console.log("[Ads] AdMob plugin not available");return}await s.initialize(),r=!0;try{var e,t,n,a,o;null===(e=s.addListener)||void 0===e||e.call(s,"adShowed",()=>console.log("[Ads] Event: adShowed")),null===(t=s.addListener)||void 0===t||t.call(s,"adDismissed",()=>console.log("[Ads] Event: adDismissed")),null===(n=s.addListener)||void 0===n||n.call(s,"rewardedAdShowed",()=>console.log("[Ads] Event: rewardedAdShowed")),null===(a=s.addListener)||void 0===a||a.call(s,"rewardedAdDismissed",()=>console.log("[Ads] Event: rewardedAdDismissed")),null===(o=s.addListener)||void 0===o||o.call(s,"rewardEarned",e=>console.log("[Ads] Event: rewardEarned",e))}catch(e){console.warn("[Ads] Failed to attach listeners:",e)}await c(),await u(),console.log("[Ads] AdMob initialized successfully")}catch(e){console.error("[Ads] Failed to initialize AdMob:",e)}}}async function c(){if(!s())return;let e=l();if(e&&r)try{await e.loadInterstitial(),console.log("[Ads] Interstitial ad loaded")}catch(e){console.error("[Ads] Failed to load interstitial ad:",e)}}async function u(){if(!s())return;let e=l();if(e&&r)try{await e.loadRewardedAd(),console.log("[Ads] Rewarded ad loaded")}catch(e){console.error("[Ads] Failed to load rewarded ad:",e)}}async function d(){if(!s())return console.log("[Ads] Not on native platform"),!1;let e=l();if(!e||!r)return console.log("[Ads] AdMob not initialized"),!1;let t=Date.now();if(t-a<12e4)return console.log("[Ads] Too soon to show another ad"),!1;try{let{ready:n}=await e.isAdReady();if(!n)return console.log("[Ads] No ad ready to show, loading new one..."),c(),!1;return await e.showInterstitial(),a=t,c(),console.log("[Ads] Interstitial ad shown successfully"),!0}catch(e){return console.error("[Ads] Failed to show interstitial ad:",e),!1}}async function f(e){if(!s())return console.log("[Ads] Not on native platform"),!1;let t=l();if(!t||!r)return console.log("[Ads] AdMob not initialized"),!1;let n=Date.now();if(n-o<3e5){let e=Math.ceil((3e5-(n-o))/6e4);return console.log("[Ads] Too soon to show another rewarded ad. Wait ".concat(e," more minutes")),!1}try{let{ready:r}=await t.isRewardedAdReady();if(!r)return console.log("[Ads] No rewarded ad ready to show, loading new one..."),u(),!1;let a=await t.showRewardedAd();return o=n,e&&e(a.amount,a.type),u(),console.log("[Ads] Rewarded ad shown successfully. Reward: ".concat(a.amount," ").concat(a.type)),!0}catch(e){return console.error("[Ads] Failed to show rewarded ad:",e),!1}}async function h(){if(!s())return!1;let e=l();if(!e||!r||Date.now()-o<3e5)return!1;try{let{ready:t}=await e.isRewardedAdReady();return t}catch(e){return!1}}function m(){let e=Date.now()-o;return e>=3e5?0:Math.ceil((3e5-e)/1e3)}},9513:function(e,t,n){"use strict";n.d(t,{MS:function(){return c},SC:function(){return h},Sg:function(){return i}});var r=n(5050);let a="https://server-jeux-millionnaire.onrender.com",o=!!window.Capacitor,s=/localhost:3000$/.test(window.location.host),l="1"===r.env.NEXT_PUBLIC_FORCE_ABS,i=o||l||!s?a:"";console.log("[API] ABS_BACKEND:",a),console.log("[API] isCapacitor:",o),console.log("[API] isLocalDev:",s),console.log("[API] forceAbs:",l),console.log("[API] API_BASE:",i);class c extends Error{constructor(e,t){super(t),this.name="ApiError",this.status=e,Object.setPrototypeOf(this,c.prototype)}}let u=null,d="HM_TOKEN";async function f(){try{var e;if(u)return u;let t=await fetch("".concat(i,"/api/auth/csrf"),{credentials:"include"});if(!t.ok)return null;let n=await t.json();return u=null!==(e=null==n?void 0:n.csrf)&&void 0!==e?e:null}catch(e){return null}}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.method||"GET").toUpperCase(),r={...t.headers};if(console.log("[API] ".concat(n," ").concat(i).concat(e)),["POST","PUT","PATCH","DELETE"].includes(n)){let e=await f();e&&(r["x-csrf-token"]=e)}let a=function(){try{return window.localStorage.getItem(d)}catch(e){return null}}();a&&(r.Authorization="Bearer ".concat(a));let o=function(){try{let e=window.localStorage.getItem("hm-session");if(!e)return null;return JSON.parse(e).playerId||null}catch(e){return null}}();o&&(r["X-Player-ID"]=o);try{let n=await fetch("".concat(i).concat(e),{credentials:"include",...t,headers:r});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(a){let n=await fetch("".concat(i,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(a)}});if(n.ok){let a=await n.json().catch(()=>({}));if(null==a?void 0:a.token){try{window.localStorage.setItem(d,a.token)}catch(e){}r.Authorization="Bearer ".concat(a.token)}let o=await fetch("".concat(i).concat(e),{credentials:"include",...t,headers:r});if(!o.ok)throw new c(o.status,o.statusText);if(204===o.status)return;return await o.json()}}}catch(e){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let e=await n.json(),t=e&&(e.error||e.message)?String(e.error||e.message):"Erreur ".concat(n.status);throw new c(n.status,t)}{let e=(await n.text()||"").trim(),t=e.length?e:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new c(n.status,t)}}catch(t){let e=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(t instanceof c)throw t;throw new c(n.status,e)}if(204===n.status)return;return await n.json()}catch(e){throw console.error("[API] Fetch error:",e),new c(0,"Erreur r\xe9seau: ".concat(e.message||"Failed to fetch"))}}},5050:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(9295)},9295:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var i=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?i=r.concat(i):u=-1,i.length&&f())}function f(){if(!c){var e=l(d);c=!0;for(var t=i.length;t;){for(r=i,i=[];++u<t;)r&&r[u].run();u=-1,t=i.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new h(e,t)),1!==i.length||c||l(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}},s=!0;try{t[e](o,o.exports,r),s=!1}finally{s&&delete n[e]}return o.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[115,205,744],function(){return e(e.s=9068)}),_N_E=e.O()}]);