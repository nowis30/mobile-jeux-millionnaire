(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8162:function(t,e,n){Promise.resolve().then(n.bind(n,6033))},6033:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return i}});var r=n(7821),o=n(8078),a=n(9513),s=n(168);function i(){let t=(0,s.useRouter)(),[e,n]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[l,u]=(0,o.useState)(null),[d,f]=(0,o.useState)(null),[h,m]=(0,o.useState)("login"),p=async n=>{n.preventDefault(),u(null),f(null);try{window.localStorage.removeItem("HM_TOKEN")}catch(t){}try{let n=await (0,a.SC)("login"===h?"/api/auth/login":"/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:i})});if(null==n?void 0:n.token)try{window.localStorage.setItem("HM_TOKEN",n.token)}catch(t){}t.push("/")}catch(t){u(t instanceof Error?t.message:"\xc9chec de l'authentification")}},g=async()=>{u(null),f(null);try{await (0,a.SC)("/api/auth/resend-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),f("Email de v\xe9rification renvoy\xe9. V\xe9rifiez votre bo\xeete de r\xe9ception (et spam).")}catch(t){u(t instanceof Error?t.message:"Impossible d'envoyer l'email de v\xe9rification")}};return(0,r.jsxs)("main",{className:"max-w-sm mx-auto space-y-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"login"===h?"Connexion":"Cr\xe9er un compte"}),(0,r.jsxs)("form",{onSubmit:p,className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-sm text-neutral-300",children:"Eâ€‘mail"}),(0,r.jsx)("input",{value:e,onChange:t=>n(t.target.value),type:"email",required:!0,className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-sm text-neutral-300",children:"Mot de passe"}),(0,r.jsx)("input",{value:i,onChange:t=>c(t.target.value),type:"password",required:!0,minLength:6,className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm"})]}),l&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm text-red-400",children:l}),l.toLowerCase().includes("non v\xe9rifi\xe9")&&(0,r.jsx)("button",{type:"button",onClick:g,className:"text-sm underline text-indigo-300",children:"Renvoyer l'email de v\xe9rification"})]}),d&&(0,r.jsx)("p",{className:"text-sm text-emerald-400",children:d}),(0,r.jsx)("button",{type:"submit",className:"w-full px-4 py-2 rounded bg-indigo-600 hover:bg-indigo-500",children:"login"===h?"Se connecter":"S'inscrire"})]}),(0,r.jsx)("button",{onClick:()=>m("login"===h?"register":"login"),className:"text-sm text-neutral-300 underline",children:"login"===h?"Cr\xe9er un compte":"J'ai d\xe9j\xe0 un compte"}),"login"===h&&(0,r.jsx)("p",{className:"text-sm text-neutral-400",children:(0,r.jsx)("a",{href:"/forgot",className:"underline",children:"Mot de passe oubli\xe9 ?"})})]})}},9513:function(t,e,n){"use strict";n.d(e,{MS:function(){return l},SC:function(){return h},Sg:function(){return c}});var r=n(5050);let o="https://server-jeux-millionnaire.onrender.com",a=!!window.Capacitor,s=/localhost:3000$/.test(window.location.host),i="1"===r.env.NEXT_PUBLIC_FORCE_ABS,c=a||i||!s?o:"";console.log("[API] ABS_BACKEND:",o),console.log("[API] isCapacitor:",a),console.log("[API] isLocalDev:",s),console.log("[API] forceAbs:",i),console.log("[API] API_BASE:",c);class l extends Error{constructor(t,e){super(e),this.name="ApiError",this.status=t,Object.setPrototypeOf(this,l.prototype)}}let u=null,d="HM_TOKEN";async function f(){try{var t;if(u)return u;let e=await fetch("".concat(c,"/api/auth/csrf"),{credentials:"include"});if(!e.ok)return null;let n=await e.json();return u=null!==(t=null==n?void 0:n.csrf)&&void 0!==t?t:null}catch(t){return null}}async function h(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(e.method||"GET").toUpperCase(),r={...e.headers};if(console.log("[API] ".concat(n," ").concat(c).concat(t)),["POST","PUT","PATCH","DELETE"].includes(n)){let t=await f();t&&(r["x-csrf-token"]=t)}let o=function(){try{return window.localStorage.getItem(d)}catch(t){return null}}();o&&(r.Authorization="Bearer ".concat(o));let a=function(){try{let t=window.localStorage.getItem("hm-session");if(!t)return null;return JSON.parse(t).playerId||null}catch(t){return null}}();a&&(r["X-Player-ID"]=a);try{let n=await fetch("".concat(c).concat(t),{credentials:"include",...e,headers:r});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(o){let n=await fetch("".concat(c,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(o)}});if(n.ok){let o=await n.json().catch(()=>({}));if(null==o?void 0:o.token){try{window.localStorage.setItem(d,o.token)}catch(t){}r.Authorization="Bearer ".concat(o.token)}let a=await fetch("".concat(c).concat(t),{credentials:"include",...e,headers:r});if(!a.ok)throw new l(a.status,a.statusText);if(204===a.status)return;return await a.json()}}}catch(t){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let t=await n.json(),e=t&&(t.error||t.message)?String(t.error||t.message):"Erreur ".concat(n.status);throw new l(n.status,e)}{let t=(await n.text()||"").trim(),e=t.length?t:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new l(n.status,e)}}catch(e){let t=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(e instanceof l)throw e;throw new l(n.status,t)}if(204===n.status)return;return await n.json()}catch(t){throw console.error("[API] Fetch error:",t),new l(0,"Erreur r\xe9seau: ".concat(t.message||"Failed to fetch"))}}},168:function(t,e,n){"use strict";var r=n(7462);n.o(r,"usePathname")&&n.d(e,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(e,{useRouter:function(){return r.useRouter}})},5050:function(t,e,n){"use strict";var r,o;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(9295)},9295:function(t){!function(){var e={229:function(t){var e,n,r,o=t.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(t){if(e===setTimeout)return setTimeout(t,0);if((e===a||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:a}catch(t){e=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var c=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?c=r.concat(c):u=-1,c.length&&f())}function f(){if(!l){var t=i(d);l=!0;for(var e=c.length;e;){for(r=c,c=[];++u<e;)r&&r[u].run();u=-1,e=c.length}r=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function m(){}o.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new h(t,e)),1!==c.length||l||i(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(t){return[]},o.binding=function(t){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var a=n[t]={exports:{}},s=!0;try{e[t](a,a.exports,r),s=!1}finally{s&&delete n[t]}return a.exports}r.ab="//";var o=r(229);t.exports=o}()}},function(t){t.O(0,[115,205,744],function(){return t(t.s=8162)}),_N_E=t.O()}]);