(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[680],{6223:function(e,t,a){Promise.resolve().then(a.bind(a,5926))},5926:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var l=a(7821),n=a(8078),s=a(9513),r=a(2044);async function i(e,t,a){if(!e||!t)return!1;try{let l=await fetch("".concat(s.Sg,"/api/games/").concat(e,"/properties/owner/").concat(t));if(!l.ok)throw Error("Erreur ".concat(l.status));let n=await l.json(),r=(null==n?void 0:n.ownerNickname)?String(n.ownerNickname).trim():"";return a(r?"\uD83D\uDE1C Haha ".concat(r," a d\xe9j\xe0 achet\xe9 !"):"\uD83D\uDE1C Haha c'est d\xe9j\xe0 achet\xe9 !"),!0}catch(e){return a("\uD83D\uDE1C Haha c'est d\xe9j\xe0 achet\xe9 !"),!0}}function c(){var e;let[t,a]=(0,n.useState)([]),[c,m]=(0,n.useState)("ALL"),[x,h]=(0,n.useState)(""),[p,b]=(0,n.useState)(""),[g,v]=(0,n.useState)(""),[f,j]=(0,n.useState)(null),[N,y]=(0,n.useState)(""),[M,w]=(0,n.useState)(""),[S,C]=(0,n.useState)(.05),[k,T]=(0,n.useState)(.2),[E,A]=(0,n.useState)("20"),[P,L]=(0,n.useState)(25),[I,R]=(0,n.useState)(null),[D,F]=(0,n.useState)(null),[O,V]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!O)return;let e=setTimeout(()=>V(null),5e3);return()=>clearTimeout(e)},[O]);let[q,U]=(0,n.useState)(!1),[_,z]=(0,n.useState)([]),[X,B]=(0,n.useState)(""),[G,$]=(0,n.useState)(0),[H,J]=(0,n.useState)(0),[W,Y]=(0,n.useState)("pct"),[K,Q]=(0,n.useState)(80),[Z,ee]=(0,n.useState)(0),[et,ea]=(0,n.useState)(""),[el,en]=(0,n.useState)({}),[es,er]=(0,n.useState)({}),ei=(0,n.useRef)(null),[ec,eo]=(0,n.useState)(null),[eu,ed]=(0,n.useState)("central"),[em,ex]=(0,n.useState)(!1),[eh,ep]=(0,n.useState)(!1),[eb,eg]=(0,n.useState)(!1),[ev,ef]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{await fetch("/api/auth/csrf",{credentials:"include"})}catch(e){}})()},[]),(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,s.SC)("/api/auth/me");ep(!!e.isAdmin)}catch(e){ep(!1)}})()},[]),(0,n.useEffect)(()=>{let e=Math.round(100*(k||0));String(e)!==E&&A(String(e))},[k]);let ej=e=>isFinite(e)?e>=1e6?"".concat((e/1e6).toFixed(2)," M$"):e>=1e3?"".concat((e/1e3).toFixed(1)," k$"):"$".concat(Math.round(e)):"$0",eN=(0,n.useMemo)(()=>{var e;let t=null!==(e=null==ec?void 0:ec.schedule)&&void 0!==e?e:[];if(!t.length)return[];let a="prudent"===eu?-.005:"optimiste"===eu?.005:0;return t.map(e=>Math.max(.02,Math.min(.05,e+a)))},[ec,eu]),ey=(0,n.useMemo)(()=>{var e,t;if(!em||!_||0===_.length)return[];let a=eN.length?eN:Array.from({length:10},()=>.02),l=null!==(e=null==ec?void 0:ec.baseMortgageRate)&&void 0!==e?e:.05,n=_.map(e=>{var t,a,n;return{value:Number(null!==(t=null==e?void 0:e.currentValue)&&void 0!==t?t:0),debt:Number(null!==(a=null==e?void 0:e.mortgageDebt)&&void 0!==a?a:0),rate:l,payW:Number(null!==(n=null==e?void 0:e.weeklyPayment)&&void 0!==n?n:0)}}),s=[],r=n.reduce((e,t)=>e+(t.value-t.debt),0);s.push({year:0,net:r});for(let e=1;e<=10;e++){for(let l of n){let n=Math.max(0,52*l.payW-l.debt*l.rate);l.debt=Math.max(0,l.debt-n),l.value=l.value*(1+(null!==(t=a[e-1])&&void 0!==t?t:.02))}let l=n.reduce((e,t)=>e+(t.value-t.debt),0);s.push({year:e,net:l})}return s},[em,_,ec,eN]);(0,n.useEffect)(()=>{(async()=>{try{if(!x){var e;let t=await (0,s.SC)("/api/games"),a=null===(e=t.games)||void 0===e?void 0:e[0];(null==a?void 0:a.id)&&h(a.id)}}catch(e){}})()},[x]),(0,n.useEffect)(()=>{x&&!p&&(async()=>{try{let e=await (0,s.SC)("/api/games/".concat(x,"/me"));b(e.player.id),e.player.nickname&&v(e.player.nickname),"number"==typeof e.player.cash&&j(e.player.cash)}catch(e){try{let e=await (0,s.SC)("/api/games/".concat(x,"/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});b(e.playerId)}catch(e){}}})()},[x,p]);let eM=(0,n.useCallback)(async()=>{if(x)try{let e=await (0,s.SC)("/api/games/".concat(x,"/me"));(null==e?void 0:e.player)&&(p||b(e.player.id),e.player.nickname&&v(e.player.nickname),"number"==typeof e.player.cash&&j(e.player.cash))}catch(e){}},[x,p]),ew=(0,n.useCallback)(async()=>{try{var e;let t=x?"?gameId=".concat(encodeURIComponent(x)):"",l=await (0,s.SC)("/api/properties/templates".concat(t));a(null!==(e=l.templates)&&void 0!==e?e:[]),F(null)}catch(e){F(e instanceof Error?e.message:"Impossible de charger les immeubles")}},[x]),eS=(0,n.useCallback)(async()=>{try{await (0,s.SC)("/api/properties/replenish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gameId:x})}),await ew(),R("Banque d'immeubles remplie."),F(null)}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec du remplissage")}},[ew,x]),eC=(0,n.useCallback)(async()=>{try{await (0,s.SC)("/api/properties/refill/sixplex10",{method:"POST"}),await ew(),R("Six-plex compl\xe9t\xe9s \xe0 10."),F(null)}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec du refill six-plex")}},[ew]),ek=(0,n.useCallback)(async()=>{try{await (0,s.SC)("/api/properties/refill/tower50x10",{method:"POST"}),await ew(),R("Tours 50 log. compl\xe9t\xe9es \xe0 10."),F(null)}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec du refill tours 50 log")}},[ew]),eT=(0,n.useCallback)(async()=>{try{await (0,s.SC)("/api/properties/refill/tower100x5",{method:"POST"}),await ew(),R("Tours 100 log. compl\xe9t\xe9es \xe0 5."),F(null)}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec du refill tours 100 log")}},[ew]),eE=(0,n.useCallback)(async e=>{try{await (0,s.SC)("/api/properties/refill/units/".concat(e,"/plus10"),{method:"POST"}),await ew(),R("Stock ".concat(e," unit\xe9s augment\xe9 de +10.")),F(null)}catch(t){R(null),F(t instanceof Error?t.message:"\xc9chec +10 (".concat(e,"u)"))}},[ew]),[eA,eP]=(0,n.useState)(null),[eL,eI]=(0,n.useState)(null),eR=(0,n.useCallback)(async()=>{if(x)try{var e;eI(null);let t=await fetch("/api/games/".concat(x,"/online"),{credentials:"include"});if(!t.ok)throw Error("HTTP ".concat(t.status));let a=await t.json();eP({online:null!==(e=a.online)&&void 0!==e?e:0,users:Array.isArray(a.users)?a.users:[]})}catch(e){eP(null),eI(e.message||"Erreur CORS")}},[x]);(0,n.useEffect)(()=>{ew()},[ew]);let eD=e=>{let t=Number(e||1);return t>=800?"VILLAGE_FUTURISTE":t>=400?"GRATTE_CIEL":t>=50?"TOUR":6===t?"SIXPLEX":3===t?"TRIPLEX":2===t?"DUPLEX":"MAISON"},eF=(0,n.useMemo)(()=>"ALL"===c?t:t.filter(e=>eD(e.units)===c),[t,c]),eO=(0,n.useCallback)(async()=>{if(x&&p)try{var e;let t=await (0,s.SC)("/api/games/".concat(x,"/properties/holdings/").concat(p));z(null!==(e=t.holdings)&&void 0!==e?e:[])}catch(e){F(e instanceof Error?e.message:"Impossible de charger le parc immobilier")}},[x,p]),eV=(0,n.useCallback)(async e=>{if(x&&e)try{er(t=>({...t,[e]:!0}));let t=await (0,s.SC)("/api/games/".concat(x,"/properties/bilan/").concat(e)),a=(null==t?void 0:t.bilan)?t.bilan:t;en(t=>({...t,[e]:{bilan:a}}))}catch(e){F(e instanceof Error?e.message:"Impossible de charger le bilan d\xe9taill\xe9")}finally{er(t=>({...t,[e]:!1}))}},[x]),eq=(0,n.useCallback)(async()=>{if(x)try{let e=await (0,s.SC)("/api/games/".concat(x,"/economy"));eo(e),"number"==typeof(null==e?void 0:e.baseMortgageRate)&&C(Number(e.baseMortgageRate))}catch(e){F(e instanceof Error?e.message:"Impossible de charger les param\xe8tres \xe9conomiques")}},[x]);(0,n.useEffect)(()=>{(async()=>{x&&await eq()})()},[x,eq]);let eU=(0,n.useCallback)(async()=>{if(x)try{var e,t,a;let l=await (0,s.SC)("/api/games/".concat(x,"/properties/backfill-rent-by-units"),{method:"POST",headers:{"Content-Type":"application/json"}}),n=Number(null!==(t=null==l?void 0:l.updated)&&void 0!==t?t:0),r=Number(null!==(a=null==l?void 0:l.total)&&void 0!==a?a:0),i=Array.isArray(null==l?void 0:l.errors)?l.errors:[],c=r>0?"Correction loyers: ".concat(n,"/").concat(r," corrig\xe9(s)"):"Correction des loyers effectu\xe9e (\xd7 unit\xe9s).";R(i.length?"".concat(c," \xb7 ").concat(i.length," erreur(s)"):c),F(i.length?"Exemple: ".concat(String((null===(e=i[0])||void 0===e?void 0:e.message)||i[0]||"inconnue")):null),await Promise.all([eO(),eM()])}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec de la correction des loyers")}},[x,eO,eM]),e_=(0,n.useCallback)(async()=>{if(!x||!p||!N){F("S\xe9lectionnez un immeuble");return}try{await (0,s.SC)("/api/games/".concat(x,"/properties/purchase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:p,templateId:N,mortgageRate:S,downPaymentPercent:k,mortgageYears:P})});try{await (0,s.SC)("/api/games/".concat(x,"/properties/maintain-bank"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})}catch(e){}R("Immeuble achet\xe9!"),F(null),V(null),ew(),eM()}catch(l){R(null),ew();let e=l instanceof s.MS?l.status:void 0,t=l instanceof Error?l.message:"Achat impossible";F(t);try{console.debug("[Immobilier] Erreur achat brute:",t)}catch(e){}let a=!1;try{let e=t.match(/(vendu|achete|acheté)[\s\S]*?à\s+['\"]?([^'\"\n]+)['\"]?/i);if(e&&e[2]){let t=e[2].trim();V("\uD83D\uDE1C Haha ".concat(t," a d\xe9j\xe0 achet\xe9 !")),a=!0}else/déjà/i.test(t)&&/(vendu|achete|acheté)/i.test(t)?a=await i(x,N,V):V(null)}catch(e){V(null)}!a&&400===e&&x&&N&&await i(x,N,V)}},[x,p,N,S,k,ew,eM]);return(0,l.jsxs)("main",{className:"space-y-6",children:[(0,l.jsxs)("section",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"Immobilier"}),(0,l.jsx)("p",{className:"text-sm text-neutral-300",children:"Achetez, vendez et g\xe9rez vos immeubles."})]}),(0,l.jsxs)("section",{ref:ei,className:"space-y-3",children:[(0,l.jsx)("div",{className:"flex flex-wrap gap-2 text-xs",children:[{k:"ALL",label:"Tous"},{k:"MAISON",label:"Maisons"},{k:"DUPLEX",label:"Duplex"},{k:"TRIPLEX",label:"Triplex"},{k:"SIXPLEX",label:"6‑plex"},{k:"TOUR",label:"Tours (50/100 log.)"},{k:"GRATTE_CIEL",label:"Gratte‑ciel (400 log.)"},{k:"VILLAGE_FUTURISTE",label:"Village futuriste"}].map(e=>{let{k:t,label:a}=e;return(0,l.jsx)("button",{onClick:()=>m(t),className:"px-3 py-1.5 rounded border ".concat(c===t?"bg-indigo-600 border-indigo-500":"bg-neutral-800 border-neutral-700 hover:bg-neutral-700"),children:a},t)})}),t.some(e=>100===Number(e.units||0))&&(0,l.jsx)("div",{className:"mt-2 p-2 rounded border border-indigo-600/40 bg-indigo-600/10 text-[12px] text-indigo-200",children:"Nouveau: des tours de 100 logements sont maintenant disponibles (GRM ~13–15\xd7)."}),(g||null!=f)&&(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-neutral-300",children:[g&&(0,l.jsxs)("p",{children:["Pseudo: ",(0,l.jsx)("span",{className:"font-medium",children:g})]}),null!=f&&(0,l.jsxs)("p",{children:["Encaisse disponible: ",f<0?(0,l.jsx)("span",{className:"font-medium text-rose-400",children:(0,r.l)(f)}):(0,l.jsx)("span",{className:"font-medium text-emerald-400",children:(0,r.l)(f)})]}),ec&&(0,l.jsx)("p",{title:"Marge: base + 5 pts → ".concat((100*ec.baseMortgageRate).toFixed(2),"% + 5.00 pts = ").concat(((ec.baseMortgageRate+.05)*100).toFixed(2),"%"),className:"text-xs text-neutral-400",children:"Marge: base + 5 pts"}),ec&&(0,l.jsxs)("p",{className:"text-xs text-neutral-500",children:["Inflation ",(100*Number(ec.inflationAnnual||0)).toFixed(1),"%/an \xb7 Indice ",Number(ec.inflationIndex||1).toFixed(3),"\xd7"]})]}),(0,l.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,l.jsxs)("label",{className:"text-sm text-neutral-300 flex flex-col gap-1",children:["Taux hypoth\xe9caire (d\xe9fini par le jeu)",(0,l.jsx)("input",{type:"number",step:"0.0001",value:S,readOnly:!0,className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm opacity-80 cursor-not-allowed",title:"Le taux est variable et d\xe9fini par le jeu (2% \xe0 7%), ajust\xe9 mensuellement par pas de 0.25%."})]}),(0,l.jsxs)("label",{className:"text-sm text-neutral-300 flex flex-col gap-1",title:"Entre 20% et 100% (ex: 50 = moiti\xe9)",children:["Mise de fonds (20–100% \xb7 ex: 50)",(0,l.jsx)("input",{type:"number",min:20,max:100,value:E,onChange:e=>{let t=e.target.value;A(t);let a=Number(t.replace(",","."));Number.isFinite(a)&&a>=20&&a<=100&&T(a/100)},onBlur:()=>{let e=Number(String(E).replace(",",".")),t=Math.max(20,Math.min(100,Number.isFinite(e)?e:20));T(t/100),A(String(Math.round(t)))},className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm"}),(0,l.jsx)("span",{className:"text-xs text-neutral-500",children:"Accept\xe9: 20 \xe0 100. 50 = 50%. Doit couvrir la mise de fonds."})]}),(0,l.jsxs)("label",{className:"text-sm text-neutral-300 flex flex-col gap-1",children:["Dur\xe9e hypoth\xe8que (ann\xe9es)",(0,l.jsx)("select",{value:P,onChange:e=>L(Number(e.target.value)),className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm",children:[5,10,15,20,25].map(e=>(0,l.jsxs)("option",{value:e,children:[e," ans"]},e))})]}),(0,l.jsxs)("label",{className:"text-sm text-neutral-300 flex flex-col gap-1",children:["Immeuble s\xe9lectionn\xe9",(0,l.jsxs)("select",{value:N,onChange:e=>y(e.target.value),className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm",children:[(0,l.jsx)("option",{value:"",children:"Choisir..."}),t.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.name," — ",e.city," (",(0,r.l)(e.price),")"]},e.id))]})]})]}),(0,l.jsx)("button",{onClick:e_,className:"px-4 py-2 rounded bg-sky-600 hover:bg-sky-500",children:"Acheter"}),(0,l.jsx)("button",{onClick:ew,className:"px-4 py-2 rounded bg-neutral-700 hover:bg-neutral-600",children:"Actualiser les immeubles"}),(0,l.jsx)("button",{onClick:eS,className:"px-4 py-2 rounded bg-indigo-700 hover:bg-indigo-600",children:"Remplir la banque (≥50)"}),(0,l.jsx)("button",{onClick:eU,className:"px-4 py-2 rounded bg-amber-700 hover:bg-amber-600",title:"Corrige les loyers des immeubles existants en les multipliant par le nombre d'unit\xe9s",children:"Corriger loyers (\xd7 unit\xe9s)"}),(0,l.jsx)("button",{onClick:eC,className:"px-4 py-2 rounded bg-teal-700 hover:bg-teal-600",title:"Ajoute des 6‑plex jusqu'\xe0 en avoir 10 disponibles",children:"6‑plex → 10"}),(0,l.jsx)("button",{onClick:ek,className:"px-4 py-2 rounded bg-cyan-700 hover:bg-cyan-600",title:"Ajoute des tours de 50 logements jusqu'\xe0 en avoir 10 disponibles",children:"Tours 50 log. → 10"}),(0,l.jsx)("button",{onClick:eT,className:"px-4 py-2 rounded bg-fuchsia-700 hover:bg-fuchsia-600",title:"Ajoute des tours de 100 logements jusqu'\xe0 en avoir 5 disponibles",children:"Tours 100 log. → 5"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,l.jsx)("button",{onClick:()=>eE(6),className:"px-3 py-1.5 rounded bg-teal-800 hover:bg-teal-700 text-xs",title:"Ajoute +10 six‑plex au stock global",children:"+10 six‑plex"}),(0,l.jsx)("button",{onClick:()=>eE(50),className:"px-3 py-1.5 rounded bg-cyan-800 hover:bg-cyan-700 text-xs",title:"Ajoute +10 tours 50 logements",children:"+10 tours 50"}),(0,l.jsx)("button",{onClick:()=>eE(100),className:"px-3 py-1.5 rounded bg-fuchsia-800 hover:bg-fuchsia-700 text-xs",title:"Ajoute +10 tours 100 logements",children:"+10 tours 100"}),(0,l.jsx)("button",{onClick:eR,className:"px-3 py-1.5 rounded bg-neutral-800 hover:bg-neutral-700 text-xs",title:"Diagnostic CORS / joueurs connect\xe9s",children:"Diag online"})]}),(eA||eL)&&(0,l.jsx)("p",{className:"text-[11px] mt-1",children:eL?(0,l.jsxs)("span",{className:"text-rose-400",children:["Online: erreur ",eL]}):(0,l.jsxs)("span",{className:"text-neutral-400",children:["Online: ",null==eA?void 0:eA.online," \xb7 Users: ",null==eA?void 0:null===(e=eA.users)||void 0===e?void 0:e.length]})}),(0,l.jsx)("button",{onClick:async()=>{U(e=>!e),q||await Promise.all([eO(),eq()])},className:"px-4 py-2 rounded bg-emerald-700 hover:bg-emerald-600",children:q?"Masquer mon parc":"Voir mon parc immobilier"}),I&&(0,l.jsx)("p",{className:"text-sm text-emerald-400",children:I}),D&&(0,l.jsx)("div",{className:"space-y-1",children:(0,l.jsx)("p",{className:"text-sm text-red-400",children:D})})]}),O&&(0,l.jsx)("div",{className:"fixed top-4 right-4 z-50 bg-neutral-900 border border-amber-500/60 text-amber-200 px-4 py-2 rounded shadow-lg animate-fade-in",children:O}),q&&(0,l.jsxs)("section",{className:"space-y-2",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Mon parc immobilier"}),0===_.length?(0,l.jsx)("p",{className:"text-sm text-neutral-400",children:"Aucun bien pour le moment."}):(0,l.jsxs)(l.Fragment,{children:[(()=>{let e=_.reduce((e,t)=>{var a,l,n,s,r,i,c,o,u,d,m,x,h;let p=Number(null!==(c=t.currentRent)&&void 0!==c?c:0)||0,b=Number(null!==(o=t.weeklyPayment)&&void 0!==o?o:0)||0,g=Number(null!==(u=null===(a=t.template)||void 0===a?void 0:a.taxes)&&void 0!==u?u:0)||0,v=Number(null!==(d=null===(l=t.template)||void 0===l?void 0:l.insurance)&&void 0!==d?d:0)||0,f=Number(null!==(m=null===(n=t.template)||void 0===n?void 0:n.maintenance)&&void 0!==m?m:0)||0,j=[null===(s=t.template)||void 0===s?void 0:s.plumbingState,null===(r=t.template)||void 0===r?void 0:r.electricityState,null===(i=t.template)||void 0===i?void 0:i.roofState].map(e=>String(e||"").toLowerCase()),N=1;for(let e of j)e.includes("\xe0 r\xe9nover")||e.includes("a r\xe9nover")||e.includes("r\xe9nover")?N=Math.max(N,1.5):e.includes("moyen")&&(N=Math.max(N,1.25));let y=f*N;return e.weeklyRent+=p,e.weeklyDebt+=b,e.weeklyFixed+=(g+v+y)/52,e.totalValue+=Number(null!==(x=t.currentValue)&&void 0!==x?x:0)||0,e.totalDebt+=Number(null!==(h=t.mortgageDebt)&&void 0!==h?h:0)||0,e},{weeklyRent:0,weeklyDebt:0,weeklyFixed:0,totalValue:0,totalDebt:0}),t=52*e.weeklyRent/12,a=52*e.weeklyDebt/12,n=52*e.weeklyFixed/12,s=t-a-n,i=e.totalValue-e.totalDebt;return(0,l.jsxs)("div",{className:"border border-neutral-800 rounded bg-neutral-950 p-3 text-xs flex flex-wrap gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Loyer total (mensuel)"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium text-neutral-200",children:(0,r.l)(Math.round(t))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Hypoth\xe8que (mensuel)"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium text-neutral-200",children:(0,r.l)(Math.round(a))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Charges fixes (mensuel)"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium text-neutral-200",children:(0,r.l)(Math.round(n))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Cashflow net (mensuel)"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium ".concat(s>=0?"text-emerald-400":"text-rose-400"),children:(0,r.l)(Math.round(s))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Valeur du parc"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium text-neutral-200",children:(0,r.l)(Math.round(e.totalValue))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Dette totale"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium text-neutral-200",children:(0,r.l)(Math.round(e.totalDebt))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"\xc9quit\xe9 cumul\xe9e"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium ".concat(i>=0?"text-emerald-400":"text-rose-400"),children:(0,r.l)(Math.round(i))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-neutral-400",children:"Nombre de biens"}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-medium text-neutral-200",children:_.length})]})]})})(),(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:_.map(e=>{var t,a,n,i,c,o,d;return(0,l.jsxs)("article",{className:"border border-neutral-800 rounded-lg bg-neutral-900 p-4 space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h4",{className:"font-semibold",children:null!==(n=null===(t=e.template)||void 0===t?void 0:t.name)&&void 0!==n?n:"Bien"}),(0,l.jsx)("span",{className:"text-sm text-neutral-400",children:null!==(i=null===(a=e.template)||void 0===a?void 0:a.city)&&void 0!==i?i:""})]}),(()=>{var t,a;let n=Number(null!==(t=e.purchasePrice)&&void 0!==t?t:0),s=Number(null!==(a=e.currentValue)&&void 0!==a?a:0),i=s-n,c=n>0?i/n*100:0;return(0,l.jsxs)("div",{className:"space-y-0.5",children:[(0,l.jsxs)("p",{className:"text-sm text-neutral-300",children:["Prix d'achat: ",n>0?(0,r.l)(n):"n/a"]}),(0,l.jsxs)("p",{className:"text-sm text-neutral-300",children:["Valeur actuelle: ",(0,r.l)(s)]}),n>0&&(0,l.jsxs)("p",{className:"text-sm text-neutral-300",children:["Gain: ",(0,l.jsxs)("span",{className:i>=0?"text-emerald-400":"text-red-400",children:[i>=0?"+":"",(0,r.l)(Math.round(i))," (",c.toFixed(2),"%)"]})]})]})})(),(0,l.jsxs)("p",{className:"text-sm text-neutral-300",children:["Loyer actuel: ",(0,r.l)(Number(null!==(c=e.currentRent)&&void 0!==c?c:0))]}),(()=>{var t,a,n,s,r,i,c,o,u,d,m,x;let h=Number(null!==(c=e.currentValue)&&void 0!==c?c:0)||0,p=Number(null!==(o=e.currentRent)&&void 0!==o?o:0)||0,b=Number(null!==(u=e.weeklyPayment)&&void 0!==u?u:0)||0,g=Number(null!==(d=null===(t=e.template)||void 0===t?void 0:t.taxes)&&void 0!==d?d:0)||0,v=Number(null!==(m=null===(a=e.template)||void 0===a?void 0:a.insurance)&&void 0!==m?m:0)||0,f=Number(null!==(x=null===(n=e.template)||void 0===n?void 0:n.maintenance)&&void 0!==x?x:0)||0,j=[null===(s=e.template)||void 0===s?void 0:s.plumbingState,null===(r=e.template)||void 0===r?void 0:r.electricityState,null===(i=e.template)||void 0===i?void 0:i.roofState].map(e=>String(e||"").toLowerCase()),N=1;for(let e of j)e.includes("\xe0 r\xe9nover")||e.includes("a r\xe9nover")||e.includes("r\xe9nover")?N=Math.max(N,1.5):e.includes("moyen")&&(N=Math.max(N,1.25));let y=p-((g+v+f*N)/52||0)-b,M=e=>h>0?y*e/h:0,w=M(1/7),S=M(1),C=M(52),k=e=>e>=0?"text-emerald-400":"text-red-400";return(0,l.jsxs)("p",{className:"text-xs text-neutral-400",title:"Rendement sur valeur actuelle en temps de jeu — 1j = 1/7 h, 1s = 1 h, 1 an = 52 h",children:["Rendement (jeu):"," ",(0,l.jsxs)("span",{className:k(w),children:["1j ",(100*w).toFixed(2),"%"]})," ","\xb7"," ",(0,l.jsxs)("span",{className:k(S),children:["1s ",(100*S).toFixed(2),"%"]})," ","\xb7"," ",(0,l.jsxs)("span",{className:k(C),children:["1 an ",(100*C).toFixed(2),"%"]})]})})(),(0,l.jsxs)("p",{className:"text-xs text-neutral-500",children:["Dette hypoth\xe9caire: ",(0,r.l)(Number(null!==(o=e.mortgageDebt)&&void 0!==o?o:0))," — Taux: ",(100*Number(null!==(d=e.mortgageRate)&&void 0!==d?d:0)).toFixed(2),"%"]}),(()=>{var t,a,n,s,i,c,o,d,m,x,h;let p=Number(null!==(s=e.mortgageRate)&&void 0!==s?s:ec?ec.baseMortgageRate:.05)||0,b=Number(null!==(i=e.weeklyPayment)&&void 0!==i?i:0)||0,g=Number(null!==(c=e.mortgageDebt)&&void 0!==c?c:0)||0,v=u(b,p,25),f=function(e,t,a,l){let n=l/52,s=Math.max(0,a),r=Math.max(0,t),i=Math.max(0,e);if(s<=0||i<=0||n<0)return 0;if(0===n){let e=Math.max(0,i-r);return e>0?e/s:0}let c=s/n,o=i-c;if(o<=0)return 0;let u=(r-c)/o;if(u<=0)return 0;let d=Math.log(u)/Math.log(1+n);return isFinite(d)&&d>0?d:0}(v,g,b,p)/(52/12),j=Math.max(0,Math.min(1,v>0?1-g/v:0)),N=Number(null!==(o=e.termYears)&&void 0!==o?o:25),y=Number(null!==(d=null===(t=e.template)||void 0===t?void 0:t.taxes)&&void 0!==d?d:0)||0,M=Number(null!==(m=null===(a=e.template)||void 0===a?void 0:a.insurance)&&void 0!==m?m:0)||0,w=Number(null!==(x=null===(n=e.template)||void 0===n?void 0:n.maintenance)&&void 0!==x?x:0)||0,S=52*(Number(null!==(h=e.currentRent)&&void 0!==h?h:0)||0)/12,C=52*b/12,k=(y+M+w)/52*52/12,T=S-C-k;return(0,l.jsxs)("div",{className:"space-y-0.5",children:[(0,l.jsxs)("p",{className:"text-xs text-neutral-500",title:"Paiement hebdo ~ ".concat((0,r.l)(Math.round(b)),", taux ").concat((100*p).toFixed(2),"%, terme ").concat(N," ans"),children:["Dette hypo: d\xe9but ",(0,r.l)(Math.round(v))," → actuelle ",(0,r.l)(Math.round(g)),f>0?" \xb7 ~".concat(Math.floor(f)," mois pay\xe9s"):""," \xb7 Terme: ",N," ans"]}),(0,l.jsx)("div",{className:"h-2 w-full bg-neutral-800 rounded overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-emerald-600 transition-all",style:{width:"".concat((100*j).toFixed(1),"%")},title:"Amorti ".concat((100*j).toFixed(1),"%")})}),(0,l.jsxs)("p",{className:"text-[11px] text-neutral-400 mt-1",title:"D\xe9tail mensuel bas\xe9 sur les valeurs hebdomadaires de la simulation",children:["Loyer: ",(0,r.l)(Math.round(S)),"/mois \xb7 Hypoth\xe8que: ",(0,r.l)(Math.round(C)),"/mois \xb7 Charges: ",(0,r.l)(Math.round(k)),"/mois \xb7 Cashflow: ",(0,l.jsxs)("span",{className:T>=0?"text-emerald-400":"text-rose-400",children:[(0,r.l)(Math.round(T)),"/mois"]})]})]})})(),(0,l.jsxs)("div",{className:"pt-2",children:[(0,l.jsx)("button",{onClick:()=>{var t;let a="number"==typeof(null==ec?void 0:ec.baseMortgageRate)?Number(ec.baseMortgageRate):Number(null!==(t=e.mortgageRate)&&void 0!==t?t:0);B(t=>t===e.id?"":e.id),$(a||.05),J(0)},className:"px-3 py-1.5 rounded bg-indigo-600 hover:bg-indigo-500 text-sm",children:X===e.id?"Annuler":"R\xe9hypoth\xe9quer"}),(0,l.jsx)("button",{onClick:async()=>{ea(t=>t===e.id?"":e.id),et===e.id||el[e.id]||await eV(e.id)},className:"ml-2 px-3 py-1.5 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",title:"Voir le bilan d\xe9taill\xe9 et cumul\xe9",children:et===e.id?"Masquer bilan":"Voir bilan d\xe9taill\xe9"}),(0,l.jsx)("button",{onClick:async()=>{if(x&&confirm("Vendre cet immeuble et r\xe9cup\xe9rer le produit net?"))try{let t=await (0,s.SC)("/api/games/".concat(x,"/properties/").concat(e.id,"/sell"),{method:"POST"});R("Immeuble vendu, produit net ".concat((0,r.l)(Math.round(t.proceeds)))),F(null),await Promise.all([eO(),eM(),ew()])}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec de la vente")}},className:"ml-2 px-3 py-1.5 rounded bg-rose-700 hover:bg-rose-600 text-sm",title:"Vendre l'immeuble et solder l'hypoth\xe8que",children:"Vendre"})]}),X===e.id&&(0,l.jsx)("div",{className:"mt-2 rounded border border-neutral-800 bg-neutral-950 p-3 space-y-2",children:(()=>{var t,a,n;let i=Number(null!==(t=e.currentValue)&&void 0!==t?t:0),c=Number(null!==(a=e.mortgageDebt)&&void 0!==a?a:0),o=Math.round(.8*i),u=Math.max(0,o-c),d=H;if("ltv"===W){let e=Math.min(o,Math.round(Math.max(0,Math.min(80,K))/100*i));d=c>0?Math.max(0,(e-c)/c):0}else if("amount"===W){let e=Math.max(0,Z);d=c>0?Math.max(0,e/c):0}let m=Math.min(Math.round(c*(1+(isFinite(d)?d:0))),o),h=Math.max(0,m-c),p=Number(null!==(n=e.mortgageRate)&&void 0!==n?n:0),b=5e-5>Math.abs((G||p)-p),g=h<=0&&b;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"text-xs text-neutral-300 flex flex-col gap-1",children:[(0,l.jsxs)("span",{children:["Max dette (80% LTV): ",(0,r.l)(o)]}),(0,l.jsxs)("span",{children:["Encaisse possible (cash-out): ",(0,r.l)(u)]})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-3 gap-3 text-xs text-neutral-300",children:[(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:["Mode de saisie",(0,l.jsxs)("select",{value:W,onChange:e=>Y(e.target.value),className:"px-2 py-1 rounded bg-neutral-900 border border-neutral-700",children:[(0,l.jsx)("option",{value:"pct",children:"% de la dette"}),(0,l.jsx)("option",{value:"ltv",children:"LTV cible (%)"}),(0,l.jsx)("option",{value:"amount",children:"Montant cash-out ($)"})]})]}),(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:["Nouveau taux (%)",(0,l.jsx)("input",{type:"number",min:0,max:15,step:.01,value:Math.round(1e4*G)/100,onChange:e=>$(Math.max(0,Number(e.target.value)/100)),className:"px-2 py-1 rounded bg-neutral-900 border border-neutral-700"})]}),"pct"===W&&(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:["Cash-out (% de la dette)",(0,l.jsx)("input",{type:"number",min:0,max:100,step:1,value:Math.round(100*H),onChange:e=>J(Math.max(0,Math.min(1,Number(e.target.value)/100))),className:"px-2 py-1 rounded bg-neutral-900 border border-neutral-700"})]}),"ltv"===W&&(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:["LTV cible (%)",(0,l.jsx)("input",{type:"number",min:0,max:80,step:1,value:K,onChange:e=>Q(Math.max(0,Math.min(80,Number(e.target.value)))),className:"px-2 py-1 rounded bg-neutral-900 border border-neutral-700"})]}),"amount"===W&&(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:["Montant cash-out ($)",(0,l.jsx)("input",{type:"number",min:0,step:1e3,value:Z,onChange:e=>ee(Math.max(0,Number(e.target.value))),className:"px-2 py-1 rounded bg-neutral-900 border border-neutral-700"})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{children:"Aper\xe7u"}),(0,l.jsxs)("span",{className:"text-neutral-400",children:["Nouvelle dette: ",(0,r.l)(m)," \xb7 Cash-out: ",(0,r.l)(h)]})]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:async()=>{try{await (0,s.SC)("/api/games/".concat(x,"/properties/").concat(e.id,"/refinance"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newRate:G,cashOutPercent:isFinite(d)?d:0})}),R("R\xe9hypoth\xe8que effectu\xe9e"),F(null),B(""),await Promise.all([eO(),eM()])}catch(e){R(null),F(e instanceof Error?e.message:"\xc9chec du refinancement")}},disabled:g,title:h<=0&&b?"Aucun changement (m\xeame taux et pas de cash-out)":u<=0?"Pas de marge de cash-out (80% LTV atteint) mais vous pouvez changer le taux":"",className:"px-3 py-1.5 rounded text-sm ".concat(g?"bg-neutral-700 text-neutral-300 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500"),children:"Confirmer"}),(0,l.jsx)("button",{onClick:()=>B(""),className:"px-3 py-1.5 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",children:"Annuler"})]}),Array.isArray(e.refinanceLogs)&&e.refinanceLogs.length>0&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("div",{className:"text-xs text-neutral-400 mb-1",children:"Journal (derni\xe8res r\xe9hypoth\xe8ques)"}),(0,l.jsx)("ul",{className:"text-xs text-neutral-300 space-y-1",children:e.refinanceLogs.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:new Date(e.at).toLocaleString()}),(0,l.jsxs)("span",{children:["+",(0,r.l)(Math.round(e.amount))," \xe0 ",(100*Number(e.rate)).toFixed(2),"%"]})]},e.id))})]})]})})()}),et===e.id&&(0,l.jsxs)("div",{className:"mt-3 rounded border border-neutral-800 bg-neutral-950 p-3",children:[es[e.id]&&(0,l.jsx)("p",{className:"text-xs text-neutral-400",children:"Chargement du bilan…"}),!es[e.id]&&(()=>{var t,a,n,s,i,c,o;let d=null!==(a=null===(t=el[e.id])||void 0===t?void 0:t.bilan)&&void 0!==a?a:{},m=e=>Number(null!=e?e:0)||0,x=m(null!==(n=d.purchasePrice)&&void 0!==n?n:e.purchasePrice),h=Number(null!==(s=e.mortgageRate)&&void 0!==s?s:ec?ec.baseMortgageRate:.05)||.05,p=Number(null!==(i=e.termYears)&&void 0!==i?i:25)||25,b=u(Number(null!==(c=e.weeklyPayment)&&void 0!==c?c:0)||0,h,p),g=m(d.initialMortgageDebt),v=g>0?g:Math.round(b),f=m(d.downPayment),j=null!==(o=d.accumulated)&&void 0!==o?o:{},N=m(j.rent),y=m(j.interest),M=m(j.taxes),w=m(j.insurance),S=m(j.maintenance),C=m(j.netCashflow),k=m(e.mortgageDebt),T=[N,y,M,w,S,C].every(e=>1>Math.abs(e));return(0,l.jsxs)("div",{className:"text-xs text-neutral-300 space-y-2",children:[T&&(0,l.jsx)("div",{className:"p-2 rounded border border-amber-600/40 bg-amber-500/10 text-amber-200",children:"Pas encore de cumul\xe9s \xe0 afficher. Le jeu applique loyers, int\xe9r\xeats et charges chaque heure (1h = 1 semaine de jeu). Revenez apr\xe8s un peu de temps de jeu, ou forcez une avance si vous \xeates admin."}),(0,l.jsxs)("div",{className:"grid sm:grid-cols-2 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Prix d'achat"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(x))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Mise de fonds"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(f>0?f:x>0&&v>0?Math.max(0,x-v):0))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Dette initiale"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(v))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Dette actuelle"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(k))})]})]}),(0,l.jsxs)("div",{className:"grid sm:grid-cols-3 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Loyers cumul\xe9s"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(N))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Int\xe9r\xeats pay\xe9s"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(y))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Cashflow net cumul\xe9"}),(0,l.jsx)("div",{className:C>=0?"font-medium text-emerald-400":"font-medium text-rose-400",children:(0,r.l)(Math.round(C))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Taxes cumul\xe9es"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(M))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Assurance cumul\xe9e"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(w))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-neutral-400",children:"Entretien cumul\xe9"}),(0,l.jsx)("div",{className:"font-medium",children:(0,r.l)(Math.round(S))})]})]}),Array.isArray(e.refinanceLogs)&&e.refinanceLogs.length>0&&(0,l.jsxs)("div",{className:"pt-2",children:[(0,l.jsx)("div",{className:"text-neutral-400 mb-1",children:"R\xe9hypoth\xe8ques"}),(0,l.jsx)("ul",{className:"space-y-1",children:e.refinanceLogs.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between text-neutral-300",children:[(0,l.jsx)("span",{children:new Date(e.at).toLocaleString()}),(0,l.jsxs)("span",{children:["+",(0,r.l)(Math.round(Number(e.amount||0)))," \xe0 ",(100*Number(e.rate)).toFixed(2),"%"]})]},e.id))})]})]})})()]})]},e.id)})}),eh&&(0,l.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,l.jsx)("div",{className:"text-xs text-neutral-400",children:"Outil admin: avancer le jeu de 1 mois (4 semaines de ticks)."}),(0,l.jsx)("button",{disabled:eb,onClick:async()=>{if(!x){ef("GameId manquant");return}eg(!0),ef(null);try{try{let e=await (0,s.SC)("/api/games/".concat(x,"/advance-weeks?weeks=4"),{method:"POST"});ef("Avanc\xe9 de ".concat(e.weeksApplied," semaines en ").concat(e.durationMs,"ms."))}catch(e){throw Error((null==e?void 0:e.message)||"\xc9chec avance")}await eO(),et&&await eV(et)}catch(e){ef(e.message||"\xc9chec avance")}finally{eg(!1)}},className:"px-3 py-1.5 rounded bg-purple-700 hover:bg-purple-600 disabled:opacity-50 text-sm",children:eb?"Avance en cours…":"Avancer 1 mois"}),ev&&(0,l.jsx)("p",{className:"text-xs text-neutral-300",children:ev})]}),(0,l.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,l.jsx)("button",{className:"px-3 py-2 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",onClick:()=>ex(e=>!e),children:em?"Masquer projection 10 ans":"Afficher projection 10 ans"}),em&&ey.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-baseline justify-between",children:[(0,l.jsx)("h4",{className:"text-md font-semibold",children:"Projection 10 ans (valeur nette immobili\xe8re)"}),(0,l.jsxs)("span",{className:"text-sm text-neutral-400",children:["De ",ej(ey[0].net)," \xe0 ",ej(ey[ey.length-1].net)]})]}),ec&&(0,l.jsxs)("div",{className:"flex flex-wrap items-end gap-3 mb-2",children:[(0,l.jsxs)("label",{className:"text-sm text-neutral-300 flex flex-col gap-1",children:["Sc\xe9nario",(0,l.jsxs)("select",{value:eu,onChange:e=>ed(e.target.value),className:"px-3 py-2 rounded bg-neutral-900 border border-neutral-700 text-sm",children:[(0,l.jsx)("option",{value:"prudent",children:"Prudent (biais -0,5 pt)"}),(0,l.jsx)("option",{value:"central",children:"Central"}),(0,l.jsx)("option",{value:"optimiste",children:"Optimiste (biais +0,5 pt)"})]})]}),(0,l.jsxs)("div",{className:"text-xs text-neutral-400",children:["Taux jeu actuel: ",(100*ec.baseMortgageRate).toFixed(2),"% \xb7 Appr\xe9ciation courante: ",(100*ec.appreciationAnnual).toFixed(2),"%"]})]}),(0,l.jsx)(o,{data:ey}),eN.length>0&&(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"mt-3 w-full text-sm bg-neutral-900 border border-neutral-800 rounded",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"text-left",children:[(0,l.jsx)("th",{className:"p-2",children:"Ann\xe9e"}),(0,l.jsx)("th",{className:"p-2",children:"Appr\xe9ciation"})]})}),(0,l.jsx)("tbody",{children:eN.map((e,t)=>(0,l.jsxs)("tr",{className:"border-t border-neutral-800",children:[(0,l.jsx)("td",{className:"p-2",children:t+1}),(0,l.jsxs)("td",{className:"p-2",children:[(100*e).toFixed(2),"%"]})]},t))})]})})]})]})]})]}),(0,l.jsxs)("section",{className:"space-y-2",children:[(()=>{let e=t.filter(e=>6===Number(e.units||0)).length,a=t.filter(e=>50===Number(e.units||0)).length,n=t.filter(e=>100===Number(e.units||0)).length;return(0,l.jsxs)("div",{className:"flex flex-wrap items-end gap-4",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold",children:["Immeubles disponibles ",t.length?(0,l.jsxs)("span",{className:"text-sm text-neutral-400",children:["(",t.length,")"]}):null]}),(0,l.jsxs)("div",{className:"flex gap-3 text-xs text-neutral-400",children:[(0,l.jsxs)("span",{children:["6‑plex: ",(0,l.jsx)("span",{className:"text-neutral-200 font-medium",children:e})]}),(0,l.jsxs)("span",{children:["Tours 50: ",(0,l.jsx)("span",{className:"text-neutral-200 font-medium",children:a})]}),(0,l.jsxs)("span",{children:["Tours 100: ",(0,l.jsx)("span",{className:"text-neutral-200 font-medium",children:n})]})]})]})})(),(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:eF.map(e=>{var t,a,n;return(0,l.jsxs)("article",{className:"border border-neutral-800 rounded-lg bg-neutral-900 overflow-hidden",children:[(0,l.jsx)("div",{className:"aspect-video w-full bg-neutral-800 flex items-center justify-center text-neutral-500",children:"GRATTE_CIEL"===eD(e.units)?(0,l.jsx)("span",{className:"text-xs",children:"Pas de photo"}):e.imageUrl?(0,l.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,l.jsx)("span",{className:"text-xs",children:"Pas de photo"})}),(0,l.jsxs)("div",{className:"p-4 space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h4",{className:"font-semibold",children:e.name}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-neutral-800 border border-neutral-700",children:(()=>{let t=eD(e.units);return"VILLAGE_FUTURISTE"===t?"Village futuriste":"GRATTE_CIEL"===t?"Gratte‑ciel":"TOUR"===t?"Tour":"SIXPLEX"===t?"6‑plex":"TRIPLEX"===t?"Triplex":"DUPLEX"===t?"Duplex":"Maison"})()}),(0,l.jsx)("span",{className:"text-sm text-neutral-400",children:e.city})]})]}),(0,l.jsxs)("p",{className:"text-sm text-neutral-300",children:["Prix: ",(0,r.l)(e.price)]}),(0,l.jsxs)("p",{className:"text-sm text-neutral-300",children:["Loyer unitaire: ",(0,r.l)(e.baseRent)," ",e.units?"\xd7 ".concat(e.units," log."):""]}),(()=>{var t;let a=Number(null!==(t=e.units)&&void 0!==t?t:0);return a>=800?(0,l.jsx)("p",{className:"text-xs text-fuchsia-300",children:"Village futuriste \xb7 Habitat autonome \xb7 Prix fixe strat\xe9gique"}):a>=400?(0,l.jsx)("p",{className:"text-xs text-indigo-300",children:"100 \xe9tages \xb7 Centre commercial int\xe9gr\xe9 \xb7 Multiplicateur 14–16\xd7 revenus"}):null})(),(0,l.jsxs)("p",{className:"text-xs text-neutral-500",children:["Charges: taxes ",(0,r.l)(e.taxes),"/an, assurance ",(0,r.l)(e.insurance),"/an, entretien ",(0,r.l)(e.maintenance),"/an"]}),(0,l.jsxs)("p",{className:"text-xs text-neutral-500",children:["\xc9tat — Plomberie: ",null!==(t=e.plumbingState)&&void 0!==t?t:"n/a",", \xc9lectricit\xe9: ",null!==(a=e.electricityState)&&void 0!==a?a:"n/a",", Toiture: ",null!==(n=e.roofState)&&void 0!==n?n:"n/a"]}),e.description&&(0,l.jsx)("p",{className:"text-xs text-neutral-400 mt-1",children:e.description}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>{y(e.id),ei.current&&ei.current.scrollIntoView({behavior:"smooth",block:"start"})},className:"px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-500 text-sm",children:"S\xe9lectionner"}),(0,l.jsx)("button",{onClick:()=>w(t=>t===e.id?"":e.id),className:"px-3 py-2 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",children:M===e.id?"Masquer bilan":"Voir bilan"})]}),M===e.id&&(0,l.jsx)(d,{tpl:e,mortgageRate:S,downPaymentPercent:k,mortgageYears:P,economy:ec})]})]},e.id)})})]})]})}function o(e){let{data:t}=e,a=Math.min(...t.map(e=>e.net)),n=Math.max(...t.map(e=>e.net)),s=a===n?.95*a:.98*a,r=a===n?1.05*n:1.02*n,i=e=>28+744*e/(t.length-1),c=e=>172-(e-s)*144/Math.max(1,r-s),o=t.map((e,t)=>"".concat(i(t),",").concat(c(e.net))).join(" "),u=e=>isFinite(e)?e>=1e6?"".concat((e/1e6).toFixed(2)," M$"):e>=1e3?"".concat((e/1e3).toFixed(1)," k$"):"$".concat(Math.round(e)):"$0";return(0,l.jsx)("div",{className:"w-full overflow-x-auto",children:(0,l.jsxs)("svg",{viewBox:"0 0 ".concat(800," ").concat(200),className:"w-full h-48 bg-neutral-950 border border-neutral-800 rounded",children:[(0,l.jsx)("line",{x1:28,y1:172,x2:772,y2:172,stroke:"#333"}),(0,l.jsx)("line",{x1:28,y1:28,x2:28,y2:172,stroke:"#333"}),(0,l.jsx)("text",{x:28,y:20,fill:"#9ca3af",fontSize:"10",textAnchor:"start",children:u(r)}),(0,l.jsx)("text",{x:28,y:184,fill:"#9ca3af",fontSize:"10",textAnchor:"start",children:u(s)}),[0,2,4,6,8,10].map(e=>{let a=i(e/10*(t.length-1));return(0,l.jsxs)("g",{children:[(0,l.jsx)("line",{x1:a,y1:172,x2:a,y2:176,stroke:"#555"}),(0,l.jsxs)("text",{x:a,y:186,fill:"#9ca3af",fontSize:"10",textAnchor:"middle",children:[e," ans"]})]},e)}),(0,l.jsx)("polyline",{fill:"none",stroke:"#22c55e",strokeWidth:2,points:o}),t.map((e,t)=>(0,l.jsx)("circle",{cx:i(t),cy:c(e.net),r:2,fill:"#22c55e"},t))]})})}function u(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,l=Math.max(1,Math.round(52*a)),n=t/52,s=Math.max(0,e);if(s<=0)return 0;if(n<=0)return s*l;let r=1-Math.pow(1+n,-l);return r<=0?0:s*r/n}function d(e){var t,a,s,i,c;let{tpl:u,mortgageRate:d,downPaymentPercent:m,mortgageYears:x,economy:h}=e,[p,b]=(0,n.useState)(!1),g=Math.max(1,Number(null!==(t=u.units)&&void 0!==t?t:1)),v=Number(null!==(a=u.baseRent)&&void 0!==a?a:0)*g,f=Math.max(0,v-.05*v),j=Number(null!==(s=u.maintenance)&&void 0!==s?s:0),N=(()=>{let e=[u.plumbingState,u.electricityState,u.roofState].map(e=>String(e||"").toLowerCase()),t=1;for(let a of e)a.includes("\xe0 r\xe9nover")||a.includes("a r\xe9nover")||a.includes("r\xe9nover")?t=Math.max(t,1.5):a.includes("moyen")&&(t=Math.max(t,1.25));return t})(),y=j*N,M=Number(null!==(i=u.taxes)&&void 0!==i?i:0)+Number(null!==(c=u.insurance)&&void 0!==c?c:0)+y,w=M/12,S=Math.max(0,12*f-M-0),C=u.price?S/u.price:0,k=u.price*m,T=Math.max(0,u.price-k),E=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,l=Math.max(1,Math.round(52*a)),n=t/52;return e<=0?0:n<=0?e/l:n*e/(1-Math.pow(1+n,-l))}(T,d,x),A=52*E/12,P=f-w-0-A,L=T*d,I=k>0?(S-L)/k:0,R=(0,n.useMemo)(()=>{if(!p)return[];let e=((null==h?void 0:h.schedule)&&h.schedule.length?h.schedule:Array.from({length:10},()=>.02)).slice(0,10),t=e.length,a=Number(u.price),l=T,n=[];n.push({year:0,net:a-l});for(let r=1;r<=t;r++){var s;let t=Math.max(0,52*E-l*d);l=Math.max(0,l-t),a*=1+(null!==(s=e[r-1])&&void 0!==s?s:.02),n.push({year:r,net:a-l})}return n},[p,h,u.price,T,E,d]);return(0,l.jsxs)("div",{className:"mt-3 border-t border-neutral-800 pt-3 space-y-2",children:[(0,l.jsx)("h5",{className:"font-semibold text-sm",children:"Bilan"}),(0,l.jsxs)("div",{className:"grid md:grid-cols-3 gap-3 text-xs text-neutral-300",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{children:"Vacance locative (d\xe9finie par le jeu)"}),(0,l.jsxs)("span",{className:"text-neutral-400",children:[Math.round(5),"%"]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{children:"Entretien (ajust\xe9 selon l'\xe9tat)"}),(0,l.jsxs)("span",{className:"text-neutral-400",children:[(0,r.l)(Math.round(y)),"/an \xb7 \xd7",N.toFixed(2)]})]}),h&&(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{children:"Indexation (r\xe9f.)"}),(0,l.jsxs)("span",{className:"text-neutral-400",children:["Loyers ~",(100*Math.max(0,h.appreciationAnnual)).toFixed(1),"%/an \xb7 Charges ~2.0%/an"]})]})]}),(0,l.jsxs)("ul",{className:"text-xs text-neutral-300 grid md:grid-cols-2 gap-2",children:[(0,l.jsxs)("li",{children:["Unit\xe9s: ",g]}),(0,l.jsxs)("li",{children:["Loyer brut: ",(0,r.l)(Math.round(v)),"/mois — Vacance: ",Math.round(5),"%"]}),(0,l.jsxs)("li",{children:["Loyer effectif: ",(0,r.l)(Math.round(f)),"/mois"]}),(0,l.jsxs)("li",{children:["Charges: ",(0,r.l)(Math.round(w)),"/mois (",(0,r.l)(Math.round(M)),"/an)"]}),(0,l.jsxs)("li",{children:["NOI: ",(0,r.l)(Math.round(S)),"/an \xb7 Cap rate: ",(100*C).toFixed(2),"%"]}),(0,l.jsxs)("li",{children:["Mise de fonds: ",(0,r.l)(Math.round(k))," (",Math.round(100*m),"%)"]}),(0,l.jsxs)("li",{children:["Hypoth\xe8que: ",(0,r.l)(Math.round(T))," — Paiement: ",(0,r.l)(Math.round(A)),"/mois"]}),(0,l.jsxs)("li",{children:["Cashflow estim\xe9: ",(0,l.jsxs)("span",{className:P>=0?"text-emerald-400":"text-red-400",children:[(0,r.l)(Math.round(P)),"/mois"]})]}),(0,l.jsxs)("li",{children:["Rendement sur capital (ann\xe9e 1): ",(0,l.jsxs)("span",{className:I>=0?"text-emerald-400":"text-red-400",children:[(100*I).toFixed(2),"%"]})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("button",{className:"px-3 py-1.5 rounded bg-neutral-700 hover:bg-neutral-600 text-xs",onClick:()=>b(e=>!e),children:p?"Masquer projection 10 ans":"Afficher projection 10 ans"}),p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h6",{className:"text-xs text-neutral-400 mb-1",children:"Projection 10 ans (valeur nette)"}),(0,l.jsx)(o,{data:R})]})]})]})}},9513:function(e,t,a){"use strict";a.d(t,{MS:function(){return o},SC:function(){return x},Sg:function(){return c}});var l=a(5050);let n="https://server-jeux-millionnaire.onrender.com",s=!!window.Capacitor,r=/localhost:3000$/.test(window.location.host),i="1"===l.env.NEXT_PUBLIC_FORCE_ABS,c=s||i||!r?n:"";console.log("[API] ABS_BACKEND:",n),console.log("[API] isCapacitor:",s),console.log("[API] isLocalDev:",r),console.log("[API] forceAbs:",i),console.log("[API] API_BASE:",c);class o extends Error{constructor(e,t){super(t),this.name="ApiError",this.status=e,Object.setPrototypeOf(this,o.prototype)}}let u=null,d="HM_TOKEN";async function m(){try{var e;if(u)return u;let t=await fetch("".concat(c,"/api/auth/csrf"),{credentials:"include"});if(!t.ok)return null;let a=await t.json();return u=null!==(e=null==a?void 0:a.csrf)&&void 0!==e?e:null}catch(e){return null}}async function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(t.method||"GET").toUpperCase(),l={...t.headers};if(console.log("[API] ".concat(a," ").concat(c).concat(e)),["POST","PUT","PATCH","DELETE"].includes(a)){let e=await m();e&&(l["x-csrf-token"]=e)}let n=function(){try{return window.localStorage.getItem(d)}catch(e){return null}}();n&&(l.Authorization="Bearer ".concat(n));let s=function(){try{let e=window.localStorage.getItem("hm-session");if(!e)return null;return JSON.parse(e).playerId||null}catch(e){return null}}();s&&(l["X-Player-ID"]=s);try{let a=await fetch("".concat(c).concat(e),{credentials:"include",...t,headers:l});if(console.log("[API] Response ".concat(a.status," ").concat(a.statusText)),401===a.status)try{if(n){let a=await fetch("".concat(c,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(n)}});if(a.ok){let n=await a.json().catch(()=>({}));if(null==n?void 0:n.token){try{window.localStorage.setItem(d,n.token)}catch(e){}l.Authorization="Bearer ".concat(n.token)}let s=await fetch("".concat(c).concat(e),{credentials:"include",...t,headers:l});if(!s.ok)throw new o(s.status,s.statusText);if(204===s.status)return;return await s.json()}}}catch(e){}if(!a.ok)try{if((a.headers.get("content-type")||"").includes("application/json")){let e=await a.json(),t=e&&(e.error||e.message)?String(e.error||e.message):"Erreur ".concat(a.status);throw new o(a.status,t)}{let e=(await a.text()||"").trim(),t=e.length?e:a.statusText?"".concat(a.status," ").concat(a.statusText):"Erreur ".concat(a.status);throw new o(a.status,t)}}catch(t){let e=a.statusText?"".concat(a.status," ").concat(a.statusText):"Erreur ".concat(a.status);if(t instanceof o)throw t;throw new o(a.status,e)}if(204===a.status)return;return await a.json()}catch(e){throw console.error("[API] Fetch error:",e),new o(0,"Erreur r\xe9seau: ".concat(e.message||"Failed to fetch"))}}},2044:function(e,t,a){"use strict";function l(e){let t=Number(e);return isFinite(t)?"$".concat(Math.round(t).toLocaleString()):"$0"}function n(e){return 52*Number(e||0)/12}a.d(t,{P:function(){return n},l:function(){return l}})},5050:function(e,t,a){"use strict";var l,n;e.exports=(null==(l=a.g.process)?void 0:l.env)&&"object"==typeof(null==(n=a.g.process)?void 0:n.env)?a.g.process:a(9295)},9295:function(e){!function(){var t={229:function(e){var t,a,l,n=e.exports={};function s(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{a="function"==typeof clearTimeout?clearTimeout:r}catch(e){a=r}}();var c=[],o=!1,u=-1;function d(){o&&l&&(o=!1,l.length?c=l.concat(c):u=-1,c.length&&m())}function m(){if(!o){var e=i(d);o=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,o=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===r||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function x(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];c.push(new x(e,t)),1!==c.length||o||i(m)},x.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},a={};function l(e){var n=a[e];if(void 0!==n)return n.exports;var s=a[e]={exports:{}},r=!0;try{t[e](s,s.exports,l),r=!1}finally{r&&delete a[e]}return s.exports}l.ab="//";var n=l(229);e.exports=n}()}},function(e){e.O(0,[115,205,744],function(){return e(e.s=6223)}),_N_E=e.O()}]);