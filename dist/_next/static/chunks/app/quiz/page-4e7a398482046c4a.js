(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{4091:function(e,t,n){Promise.resolve().then(n.bind(n,8972))},8972:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var s=n(7821),r=n(8078),o=n(168);function i(e){let{onClose:t,storageKey:n="hm-tutorial-quiz"}=e,o=[{title:"Bienvenue dans Quitte ou Double",content:"Gagnez de l'argent en r\xe9pondant \xe0 des questions. Vous recevez des tokens automatiquement chaque heure pour lancer une session."},{title:"D\xe9marrer une session",content:"Appuyez sur ‘D\xe9marrer le Quiz’ (1 token). Une session contient jusqu'\xe0 10 questions et commence \xe0 5 000 $."},{title:"R\xe9pondre et doubler",content:"Chaque bonne r\xe9ponse double vos gains (5k → 10k → 20k …). Vous pouvez encaisser \xe0 tout moment."},{title:"Sauter jusqu'\xe0 3 questions",content:"Si une question s'entrem\xeale ou ne vous inspire pas, utilisez ‘Passer’. Vous avez 3 sauts par session."},{title:"Mauvaise r\xe9ponse",content:"Une mauvaise r\xe9ponse = vous perdez tout. L'app affiche la bonne r\xe9ponse pendant 5 secondes, puis la session se termine."},{title:"Conseils",content:"Variez les cat\xe9gories, surveillez vos sauts restants, et encaissez si vous voulez s\xe9curiser vos gains."}],[i,a]=(0,r.useState)(0),[l,c]=(0,r.useState)(!1);return(0,s.jsx)("div",{className:"fixed inset-0 z-[9999] bg-black/70 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"max-w-lg w-full bg-white rounded-2xl shadow-2xl text-gray-900",children:[(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"text-xl font-bold mb-2",children:o[i].title}),(0,s.jsx)("div",{className:"text-sm text-gray-700 mb-6",children:o[i].content}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("label",{className:"text-xs text-gray-600 flex items-center gap-2 select-none",children:[(0,s.jsx)("input",{type:"checkbox",checked:l,onChange:e=>c(e.target.checked)}),"Ne plus afficher automatiquement"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[i>0&&(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-gray-200 hover:bg-gray-300",onClick:()=>a(e=>Math.max(0,e-1)),children:"← Pr\xe9c\xe9dent"}),i<o.length-1?(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",onClick:()=>a(e=>Math.min(o.length-1,e+1)),children:"Suivant →"}):(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700",onClick:function(){try{l&&localStorage.setItem(n,"1")}catch(e){}t()},children:"J'ai compris"})]})]})]}),(0,s.jsx)("div",{className:"px-6 pb-4 text-center",children:(0,s.jsx)("div",{className:"inline-flex gap-1",children:o.map((e,t)=>(0,s.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(t===i?"bg-indigo-600":"bg-gray-300"),"aria-hidden":!0},t))})})]})})}let a=[{id:"finance",label:"Finance",icon:"\uD83D\uDCB0",description:"Bourse, investissements, banque",color:"from-green-600 to-emerald-600"},{id:"economy",label:"\xc9conomie",icon:"\uD83D\uDCC8",description:"Macro-\xe9conomie, march\xe9s",color:"from-blue-600 to-cyan-600"},{id:"real-estate",label:"Immobilier",icon:"\uD83C\uDFE0",description:"Propri\xe9t\xe9s, hypoth\xe8ques, march\xe9",color:"from-orange-600 to-amber-600"},{id:"business",label:"Business",icon:"\uD83D\uDCBC",description:"Entreprise, management, strat\xe9gie",color:"from-gray-600 to-slate-600"},{id:"general",label:"Culture G\xe9n\xe9rale",icon:"\uD83C\uDF93",description:"Connaissances diverses",color:"from-purple-600 to-violet-600"},{id:"history",label:"Histoire",icon:"\uD83D\uDCDC",description:"\xc9v\xe9nements historiques",color:"from-amber-700 to-orange-700"},{id:"geography",label:"G\xe9ographie",icon:"\uD83C\uDF0D",description:"Pays, villes, capitales",color:"from-teal-600 to-cyan-600"},{id:"quebec",label:"Qu\xe9bec",icon:"\uD83C\uDF41",description:"Culture qu\xe9b\xe9coise",color:"from-blue-700 to-indigo-700"},{id:"science",label:"Sciences",icon:"\uD83D\uDD2C",description:"Physique, chimie, biologie",color:"from-indigo-600 to-purple-600"},{id:"technology",label:"Technologie",icon:"\uD83D\uDCBB",description:"Informatique, innovation",color:"from-cyan-600 to-blue-600"},{id:"anatomy",label:"Anatomie",icon:"\uD83E\uDEC0",description:"Corps humain, biologie",color:"from-red-600 to-rose-600"},{id:"health",label:"Sant\xe9",icon:"⚕️",description:"M\xe9decine, bien-\xeatre",color:"from-green-700 to-emerald-700"},{id:"nature",label:"Nature",icon:"\uD83C\uDF3F",description:"Environnement, \xe9cologie",color:"from-green-600 to-lime-600"},{id:"animals",label:"Animaux",icon:"\uD83E\uDD81",description:"Faune, zoologie",color:"from-yellow-600 to-orange-600"},{id:"culture",label:"Culture",icon:"\uD83C\uDFAD",description:"Arts, traditions",color:"from-pink-600 to-rose-600"},{id:"cinema",label:"Cin\xe9ma",icon:"\uD83C\uDFAC",description:"Films, acteurs, r\xe9alisateurs",color:"from-red-600 to-pink-600"},{id:"music",label:"Musique",icon:"\uD83C\uDFB5",description:"Artistes, genres, instruments",color:"from-purple-600 to-pink-600"},{id:"literature",label:"Litt\xe9rature",icon:"\uD83D\uDCDA",description:"Livres, auteurs, po\xe9sie",color:"from-amber-600 to-yellow-600"},{id:"arts",label:"Arts",icon:"\uD83C\uDFA8",description:"Peinture, sculpture, architecture",color:"from-fuchsia-600 to-purple-600"},{id:"sports",label:"Sports",icon:"⚽",description:"Comp\xe9titions, athl\xe8tes",color:"from-blue-600 to-green-600"},{id:"food",label:"Gastronomie",icon:"\uD83C\uDF7D️",description:"Cuisine, recettes, plats",color:"from-red-700 to-orange-700"},{id:"religions",label:"Religions",icon:"\uD83D\uDD4C",description:"Croyances, traditions",color:"from-indigo-700 to-purple-700"},{id:"definitions",label:"D\xe9finitions",icon:"\uD83D\uDCD6",description:"Vocabulaire, expressions",color:"from-gray-700 to-slate-700"},{id:"translation",label:"Traduction",icon:"\uD83D\uDDE3️",description:"Langues \xe9trang\xe8res",color:"from-blue-700 to-purple-700"},{id:"logic",label:"Logique",icon:"\uD83E\uDDE9",description:"Raisonnement, d\xe9duction",color:"from-violet-600 to-purple-600"},{id:"iq",label:"QI",icon:"\uD83E\uDDE0",description:"Tests de quotient intellectuel",color:"from-pink-700 to-fuchsia-700"},{id:"kids",label:"Enfants",icon:"\uD83D\uDC76",description:"Questions simples et \xe9ducatives",color:"from-yellow-500 to-orange-500"},{id:"enfants",label:"Enfants (FR)",icon:"\uD83E\uDDD2",description:"Questions pour les plus jeunes",color:"from-pink-500 to-rose-500"}],l={finance:["finance","economy","real-estate","business"],culture:["general","history","geography","quebec"],sciences:["science","technology","anatomy","health","nature","animals"],arts:["culture","cinema","music","literature","arts","sports"],autres:["food","religions","definitions","translation","logic","iq","kids","enfants"]},c={finance:{label:"Finance & Business",icon:"\uD83D\uDCBC"},culture:{label:"Culture & Histoire",icon:"\uD83C\uDF93"},sciences:{label:"Sciences & Nature",icon:"\uD83D\uDD2C"},arts:{label:"Arts & Divertissement",icon:"\uD83C\uDFAD"},autres:{label:"Autres",icon:"\uD83C\uDFAF"}};function u(e){let{onStart:t,onCancel:n,availableCategories:o,defaultSelected:i=[]}=e,[u,d]=(0,r.useState)(new Set(i)),[m,g]=(0,r.useState)(new Set(["finance"])),h=(0,r.useMemo)(()=>o?a.filter(e=>o.includes(e.id)):a,[o]),p=(0,r.useMemo)(()=>{let e={};return Object.entries(l).forEach(t=>{let[n,s]=t;e[n]=h.filter(e=>s.includes(e.id))}),e},[h]),x=e=>{let t=new Set(u);t.has(e)?t.delete(e):t.add(e),d(t)},f=e=>{let t=new Set(m);t.has(e)?t.delete(e):t.add(e),g(t)},b=e=>{let t=p[e]||[],n=new Set(u);t.forEach(e=>n.add(e.id)),d(n)};return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl bg-gradient-to-b from-neutral-900 to-neutral-950 rounded-xl border-2 border-purple-500/30 shadow-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-gradient-to-r from-purple-900/90 to-pink-900/90 backdrop-blur-sm p-6 border-b border-purple-500/30",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"\uD83C\uDFAF Choisis tes cat\xe9gories"}),(0,s.jsx)("p",{className:"text-purple-200 text-sm",children:"S\xe9lectionne au moins une cat\xe9gorie pour personnaliser ton quiz"}),(0,s.jsx)("div",{className:"mt-3 flex items-center gap-3",children:(0,s.jsxs)("span",{className:"text-white font-semibold",children:[u.size," cat\xe9gorie",u.size>1?"s":""," s\xe9lectionn\xe9e",u.size>1?"s":""]})})]}),(0,s.jsxs)("div",{className:"p-4 bg-neutral-900/50 border-b border-neutral-800 flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{d(new Set(h.map(e=>e.id)))},className:"flex-1 px-4 py-2 rounded-lg bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500/30 text-purple-300 text-sm font-medium transition-all",children:"✅ Tout s\xe9lectionner"}),(0,s.jsx)("button",{onClick:()=>{d(new Set)},className:"flex-1 px-4 py-2 rounded-lg bg-neutral-700/20 hover:bg-neutral-700/30 border border-neutral-600/30 text-neutral-300 text-sm font-medium transition-all",children:"❌ Tout effacer"})]}),(0,s.jsx)("div",{className:"p-4 space-y-4",children:Object.entries(p).map(e=>{let[t,n]=e;if(0===n.length)return null;let r=c[t],o=m.has(t),i=n.filter(e=>u.has(e.id)).length;return(0,s.jsxs)("div",{className:"border border-neutral-800 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-neutral-900/50 cursor-pointer hover:bg-neutral-800/50 transition-all",onClick:()=>f(t),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:r.icon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-white",children:r.label}),(0,s.jsxs)("p",{className:"text-xs text-neutral-400",children:[i,"/",n.length," s\xe9lectionn\xe9e",i>1?"s":""]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),b(t)},className:"px-3 py-1 rounded bg-purple-600/20 hover:bg-purple-600/40 text-purple-300 text-xs font-medium transition-all",children:"Tout"}),(0,s.jsx)("span",{className:"text-neutral-500 text-xl",children:o?"▼":"▶"})]})]}),o&&(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 p-4 bg-neutral-950/30",children:n.map(e=>{let t=u.has(e.id);return(0,s.jsxs)("button",{onClick:()=>x(e.id),className:"\n                            relative p-4 rounded-lg border-2 transition-all text-left\n                            ".concat(t?"bg-gradient-to-br ".concat(e.color," border-white/50 shadow-lg scale-105"):"bg-neutral-900/50 border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800/50","\n                          "),children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("span",{className:"text-3xl",children:e.icon}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:"font-bold text-sm mb-1 ".concat(t?"text-white":"text-neutral-200"),children:e.label}),(0,s.jsx)("p",{className:"text-xs ".concat(t?"text-white/80":"text-neutral-400"),children:e.description})]})]}),t&&(0,s.jsx)("div",{className:"absolute top-2 right-2 w-6 h-6 bg-white rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-green-600 text-sm",children:"✓"})})]},e.id)})})]},t)})}),(0,s.jsxs)("div",{className:"sticky bottom-0 bg-gradient-to-t from-neutral-900 to-neutral-900/95 backdrop-blur-sm p-6 border-t border-neutral-800 flex gap-4",children:[(0,s.jsx)("button",{onClick:n,className:"flex-1 px-6 py-3 rounded-lg bg-neutral-700 hover:bg-neutral-600 text-white font-semibold transition-all",children:"Annuler"}),(0,s.jsx)("button",{onClick:()=>{u.size>0&&t(Array.from(u))},disabled:0===u.size,className:"\n              flex-1 px-6 py-3 rounded-lg font-bold text-white transition-all\n              ".concat(u.size>0?"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 shadow-lg shadow-purple-500/30":"bg-neutral-800 text-neutral-500 cursor-not-allowed","\n            "),children:u.size>0?"\uD83D\uDE80 Commencer le quiz (".concat(u.size," cat\xe9gorie").concat(u.size>1?"s":"",")"):"⚠️ S\xe9lectionne au moins 1 cat\xe9gorie"})]})]})})}var d=n(2044),m=n(9513),g=n(6325);let h={correct:["/audio/sfx-correct.mp3","/audio/sfx-correct.wav"],wrong:["/audio/sfx-wrong.mp3","/audio/sfx-wrong.wav"],reward:["/audio/sfx-reward.mp3","/audio/sfx-reward.wav"]},p=new Map,x=null;function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sine",s=function(){try{return x||(x=new(window.AudioContext||window.webkitAudioContext)),"suspended"===x.state&&x.resume().catch(()=>{}),x}catch(e){return null}}();if(!s)return;let r=s.currentTime,o=s.createGain();o.gain.value=0,o.connect(s.destination);let i=s.createOscillator();for(let s of(i.type=n,i.connect(o),i.start(r),e))i.frequency.setValueAtTime(s.freq,r),o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(0,r),o.gain.linearRampToValueAtTime(Math.min(1,Math.max(0,t)),r+.01),o.gain.linearRampToValueAtTime(0,r+Math.max(.08,s.dur-.02)),r+=s.dur;i.stop(r+.02)}function b(e,t){"correct"===e?f([{freq:523.25,dur:.12},{freq:659.25,dur:.12},{freq:783.99,dur:.16}],t,"triangle"):"wrong"===e?f([{freq:220,dur:.16},{freq:196,dur:.22}],.9*t,"square"):f([{freq:523.25,dur:.12},{freq:659.25,dur:.12},{freq:783.99,dur:.14},{freq:1046.5,dur:.18}],Math.min(1,t),"sine")}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{let n=function(e){if(p.has(e))return p.get(e);let t=h[e]||[],n=new Audio;n.preload="auto";let s={audio:n,loaded:!1},r=0,o=()=>{if(r>=t.length){s.loaded=!0;return}let e=t[r++];n.src=e;try{n.load()}catch(e){}};return n.addEventListener("canplay",()=>{s.loaded=!0}),n.addEventListener("error",()=>{s.loaded||o()}),o(),p.set(e,s),s}(e),s=Math.min(1,Math.max(0,t)),r=n.audio.cloneNode();r.volume=s,r.play().catch(()=>{b(e,s)}),setTimeout(()=>{(r.duration===1/0||0===r.duration)&&r.paused&&b(e,s)},250)}catch(e){b("correct",Math.min(1,Math.max(0,t)))}}let v={correct:()=>y("correct",.9),wrong:()=>y("wrong",.9),reward:()=>y("reward",1)},w=Array.from({length:10}).map((e,t)=>{let n=t+1;return{question:n,amount:5e4*Math.pow(2,t),difficulty:n<=2?"Enfant":n<=5?"Moyen":"Difficile (QI)",milestone:!1}});function j(){var e,t,a,l,c,h,p;let x=(0,o.useRouter)(),[f,b]=(0,r.useState)(null),[y,j]=(0,r.useState)(null),[N,D]=(0,r.useState)(null),[k,C]=(0,r.useState)(null),[A,S]=(0,r.useState)(!0),[E,z]=(0,r.useState)(null),[T,P]=(0,r.useState)(null),[q,I]=(0,r.useState)(null),[R,M]=(0,r.useState)(null),[L,F]=(0,r.useState)(!1),[Q,O]=(0,r.useState)(null),[B,V]=(0,r.useState)(!1),[J,U]=(0,r.useState)(null),[_,X]=(0,r.useState)(60),[G,$]=(0,r.useState)(!1),[H,Y]=(0,r.useState)(!1),[K,W]=(0,r.useState)(0),[Z,ee]=(0,r.useState)(!1),[et,en]=(0,r.useState)(!1),[es,er]=(0,r.useState)(!1),[eo,ei]=(0,r.useState)(0),[ea,el]=(0,r.useState)(!1),[ec,eu]=(0,r.useState)(null),[ed,em]=(0,r.useState)(null),[eg,eh]=(0,r.useState)(!1),[ep,ex]=(0,r.useState)(!1),[ef,eb]=(0,r.useState)(null),[ey,ev]=(0,r.useState)(!1),[ew,ej]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(null==T?void 0:T.id){try{window.scrollTo({top:0,behavior:"instant"})}catch(e){try{window.scrollTo(0,0)}catch(e){}}I(null),U(null),X(60),$(!1),eb(null)}},[null==T?void 0:T.id]),(0,r.useEffect)(()=>{(0,g.YY)(),eh((0,g.Nf)())},[]),(0,r.useEffect)(()=>{let e=!1,t=async()=>{try{let t=await (0,g.yk)();if(e||er(t),!e){let e=(0,g.Ie)();e>0&&ei(t=>Math.max(t,e))}}catch(e){}};t();let n=setInterval(t,15e3);return()=>{e=!0,clearInterval(n)}},[]),(0,r.useEffect)(()=>{if(eo<=0)return;let e=setInterval(()=>{ei(e=>e>0?e-1:0)},1e3);return()=>clearInterval(e)},[eo>0]),(0,r.useEffect)(()=>{if(!E||!T||J||G)return;if(_<=0){(async()=>{try{let e={"Content-Type":"application/json"};y&&(e["X-Player-ID"]=y);let t=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/timeout"),{method:"POST",credentials:"include",headers:e,body:JSON.stringify({sessionId:E.id,questionId:T.id})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Timeout quiz erreur")}let n=await t.json();U(n.correctAnswer),$(!0),M({type:"error",message:n.message}),setTimeout(()=>{U(null),$(!1),z(null),P(null),ek(),eD()},5e3)}catch(e){M({type:"error",message:e.message})}})();return}let e=setTimeout(()=>X(e=>e-1),1e3);return()=>clearTimeout(e)},[_,E,T,J,G,y,f]);let eN=(0,r.useCallback)(async()=>{try{var e;let t=localStorage.getItem("hm-session");if(console.log("[Quiz] Session from localStorage:",t),t){let e=JSON.parse(t);if(null==e?void 0:e.gameId)return b(e.gameId),j(e.playerId),!0}console.warn("[Quiz] No session found, fallback auto-join");let n=await fetch("".concat(m.Sg,"/api/games"),{credentials:"include"});if(!n.ok)throw Error("Liste parties indisponible");let s=await n.json(),r=null===(e=s.games)||void 0===e?void 0:e[0];if(!r)throw Error("Aucune partie disponible");let o=await fetch("".concat(m.Sg,"/api/games/").concat(r.id,"/join"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!o.ok)throw Error("Join \xe9chou\xe9");let i=await o.json(),a={gameId:r.id,playerId:i.playerId,nickname:""};try{localStorage.setItem("hm-session",JSON.stringify(a))}catch(e){}return b(r.id),j(i.playerId),!0}catch(e){return console.error("[Quiz] ensureSession error:",e.message),!1}},[]);async function eD(){try{var e;let t=await fetch("".concat(m.Sg,"/api/quiz/public-stats"),{credentials:"include"});if(!t.ok)return;let n=await t.json(),s=Array.isArray(n.categories)?n.categories.map(e=>{var t,n,s,r;return{category:String(null!==(t=e.category)&&void 0!==t?t:"autre"),remaining:Number(null!==(n=e.remaining)&&void 0!==n?n:0),total:Number(null!==(s=e.total)&&void 0!==s?s:0),used:Number(null!==(r=e.used)&&void 0!==r?r:0)}}):void 0;O({remaining:Number(null!==(e=n.remaining)&&void 0!==e?e:0),remainingByCategory:n.remainingByCategory,categories:s})}catch(e){}}async function ek(e){try{(null==e?void 0:e.silent)||S(!0),console.log("[Quiz] Loading status for game:",f);let t={};y&&(t["X-Player-ID"]=y);let n=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/status"),{credentials:"include",headers:t});if(console.log("[Quiz] Status response:",n.status,n.statusText),!n.ok){let e=await n.json().catch(()=>({}));throw console.error("[Quiz] Status error:",e),Error(e.error||"Erreur chargement status")}let s=await n.json();console.log("[Quiz] Status data:",s),C(s),"number"==typeof(null==s?void 0:s.adCooldownSeconds)&&ei(e=>Math.max(e,Number(s.adCooldownSeconds))),s.hasActiveSession&&(z(s.session),await eE(s.session.id,!0)),eD()}catch(e){console.error("[Quiz] Error in loadStatus:",e),M({type:"error",message:e.message})}finally{S(!1)}}async function eC(){if(!f||!y){em("Session introuvable. Rejoignez d'abord une partie.");return}if(!ea){el(!0),em(null),eu(null);try{var e,t;if(!await (0,g.yk)()){let e=(0,g.Ie)();throw e>0&&ei(t=>Math.max(t,e)),Error("La publicit\xe9 n'est pas encore pr\xeate. R\xe9essayez bient\xf4t.")}if(!await (0,g.fL)())throw Error("Impossible d'afficher la publicit\xe9 maintenant.");let n=await (0,m.SC)("/api/games/".concat(f,"/tokens/ads"),{method:"POST",headers:{"Content-Type":"application/json","X-Player-ID":y},body:JSON.stringify({type:"quiz"})}),s=Number(null!==(e=null==n?void 0:n.added)&&void 0!==e?e:0),r="number"==typeof(null==n?void 0:n.tokens)?Number(n.tokens):void 0;"number"==typeof r&&C(e=>e?{...e,tokens:r,canPlay:r>0}:e),eu(s>0?"+".concat(s," tokens ajout\xe9s ✅"):"Tokens d\xe9j\xe0 au maximum ✅");let o=Number(null!==(t=null==n?void 0:n.cooldownSeconds)&&void 0!==t?t:0),i=(0,g.Ie)(),a=Math.max(o,i);a>0&&ei(e=>Math.max(e,a)),await ek({silent:!0})}catch(e){if(e instanceof m.MS){if(em(e.message),429===e.status){let t=e.message.match(/(\d+)/);if(t){let e=Number(t[1]);Number.isNaN(e)||ei(t=>Math.max(t,60*e))}}}else e instanceof Error?em(e.message):em("Recharge indisponible pour le moment.")}finally{el(!1),setTimeout(()=>{(0,g.yk)().then(e=>er(e))},500)}}}async function eA(){var e,t;if(E&&T&&f&&!ep&&!G){if(eb(null),!eg){eb("R\xe9v\xe9lation disponible uniquement sur l’application Android.");return}ex(!0);try{if(!await (0,g.fL)({ignoreCooldown:!0}))throw Error("Publicit\xe9 indisponible. R\xe9essayez dans un instant.");let t=await (0,m.SC)("/api/games/".concat(f,"/quiz/reveal"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:E.id,questionId:T.id})}),n=t.correctAnswer;if(!n)throw Error("R\xe9ponse invalide renvoy\xe9e.");if(U(n),I(n),M({type:"success",message:null!==(e=t.message)&&void 0!==e?e:"R\xe9ponse ".concat(n," r\xe9v\xe9l\xe9e ✅")}),v.correct(),t.completed){setTimeout(()=>{U(null),z(null),P(null),I(null),ek(),eD()},2500);return}t.question&&setTimeout(()=>{U(null),I(null),z(e=>{var n,s,r,o,i,a,l,c;if(!e)return e;let u=null!==(s=t.currentQuestion)&&void 0!==s?s:e.currentQuestion+1,d=Math.max(0,Math.min(w.length-1,u-1)),m=null!==(r=null===(n=w[d])||void 0===n?void 0:n.amount)&&void 0!==r?r:e.nextPrize;return{id:e.id,currentQuestion:u,currentEarnings:null!==(o=t.currentEarnings)&&void 0!==o?o:e.currentEarnings,securedAmount:null!==(a=t.securedAmount)&&void 0!==a?a:null!==(i=e.securedAmount)&&void 0!==i?i:0,skipsLeft:"number"==typeof t.skipsLeft?t.skipsLeft:null!==(l=e.skipsLeft)&&void 0!==l?l:0,nextPrize:null!==(c=t.nextPrize)&&void 0!==c?c:m}}),P(t.question),X(60),eD()},2500)}catch(e){e instanceof m.MS?eb(e.message):eb(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"R\xe9v\xe9lation indisponible pour le moment.")}finally{ex(!1),setTimeout(()=>{(0,g.yk)({ignoreCooldown:!0}).then(e=>er(e))},500)}}}(0,r.useEffect)(()=>((async()=>{if(!await eN()){setTimeout(()=>x.push("/"),1500);return}try{localStorage.getItem("hm-tutorial-quiz")||Y(!0)}catch(e){}try{window.dispatchEvent(new Event("hm-music/pause"))}catch(e){}})(),()=>{try{window.dispatchEvent(new Event("hm-music/resume"))}catch(e){}}),[eN,x]),(0,r.useEffect)(()=>{if(f){ek(),eD();let e=async()=>{try{var e;let t=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/online"),{credentials:"include"});if(!t.ok)return;let n=await t.json();D(Number(null!==(e=n.online)&&void 0!==e?e:0))}catch(e){}};e();let t=setInterval(e,15e3);return()=>clearInterval(t)}},[f]);let eS=(0,r.useCallback)(e=>{if(e<=0)return"";let t=Math.floor(e/60),n=e%60;return t>0?"".concat(t,"m ").concat(n.toString().padStart(2,"0"),"s"):"".concat(n,"s")},[]);async function eE(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;try{var s,r;if(S(!0),M(null),t&&e){let e={};y&&(e["X-Player-ID"]=y);let t=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/resume"),{method:"GET",credentials:"include",headers:e});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Erreur reprise de la session")}let n=await t.json();z({id:n.session.id,currentQuestion:n.session.currentQuestion,currentEarnings:n.session.currentEarnings,securedAmount:n.session.securedAmount,nextPrize:n.session.nextPrize,skipsLeft:null!==(s=n.session.skipsLeft)&&void 0!==s?s:0}),P(n.question),I(null);return}let o={"Content-Type":"application/json"};y&&(o["X-Player-ID"]=y);let i=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/start"),{method:"POST",credentials:"include",headers:o,body:JSON.stringify({selectedCategories:n&&n.length>0?n:void 0})});if(!i.ok){let e=await i.json();throw Error(e.error||"Erreur d\xe9marrage")}let a=await i.json();z({id:a.sessionId,currentQuestion:a.currentQuestion,currentEarnings:a.currentEarnings,securedAmount:a.securedAmount,nextPrize:a.nextPrize,skipsLeft:null!==(r=a.skipsLeft)&&void 0!==r?r:3}),P(a.question),I(null),ej(n||[])}catch(e){console.error(e),M({type:"error",message:e.message})}finally{S(!1)}}async function ez(){if(q&&T&&E)try{F(!0),M(null);let t={"Content-Type":"application/json"};y&&(t["X-Player-ID"]=y);let n=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/answer"),{method:"POST",credentials:"include",headers:t,body:JSON.stringify({sessionId:E.id,questionId:T.id,answer:q})});if(!n.ok){let e=await n.json();throw Error(e.error||"Erreur r\xe9ponse")}let s=await n.json();if(s.correct){if(v.correct(),s.completed)M({type:"success",message:s.message}),z(null),P(null),setTimeout(()=>{ek(),eD()},2e3);else{var e;z({id:E.id,currentQuestion:s.currentQuestion,currentEarnings:s.currentEarnings,securedAmount:s.securedAmount,nextPrize:s.nextPrize,skipsLeft:"number"==typeof s.skipsLeft?s.skipsLeft:null!==(e=E.skipsLeft)&&void 0!==e?e:0}),P(s.question),I(null),M({type:"success",message:"✓ Bonne r\xe9ponse !"}),eD()}}else M({type:"error",message:s.message}),U(s.correctAnswer),v.wrong(),K>0?ee(!0):setTimeout(()=>{U(null),z(null),P(null),I(null),ek(),eD()},5e3)}catch(e){console.error(e),M({type:"error",message:e.message})}finally{F(!1)}}async function eT(){if(E&&confirm("Voulez-vous encaisser ".concat((0,d.l)(E.currentEarnings)," ?")))try{S(!0),M(null);let e={"Content-Type":"application/json"};y&&(e["X-Player-ID"]=y);let t=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/cash-out"),{method:"POST",credentials:"include",headers:e,body:JSON.stringify({sessionId:E.id})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur encaissement")}let s=await t.json();M({type:"success",message:s.message}),z(null),P(null),v.correct(),setTimeout(async()=>{try{let{showInterstitialAd:e}=await Promise.resolve().then(n.bind(n,6325));await e()||console.log("[Quiz] Ad not ready or cooldown active")}catch(e){console.log("[Quiz] Ad error:",e)}},500),setTimeout(()=>{ek(),eD()},2e3)}catch(e){console.error(e),M({type:"error",message:e.message})}finally{S(!1)}}async function eP(){en(!0);try{let{showInterstitialAd:e}=await Promise.resolve().then(n.bind(n,6325));await e()?(W(e=>e+1),M({type:"success",message:"\uD83C\uDF81 +1 Passe de vie obtenue !"}),v.reward()):M({type:"error",message:"Aucune publicit\xe9 disponible pour le moment"})}catch(e){console.error("[Quiz] Error watching ad:",e),M({type:"error",message:"Erreur lors du chargement de la publicit\xe9"})}finally{en(!1)}}async function eq(){var e;if(E&&T){if((null!==(e=E.skipsLeft)&&void 0!==e?e:0)<=0){M({type:"error",message:"Vous n'avez plus de sauts disponibles."});return}try{F(!0),M(null);let e={"Content-Type":"application/json"};y&&(e["X-Player-ID"]=y);let t=await fetch("".concat(m.Sg,"/api/games/").concat(f,"/quiz/skip"),{method:"POST",credentials:"include",headers:e,body:JSON.stringify({sessionId:E.id,questionId:T.id})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Impossible de passer la question")}let n=await t.json();U(n.correctAnswer),M({type:"success",message:"R\xe9ponse: ".concat(n.correctAnswer," (question pass\xe9e)")}),F(!0),setTimeout(()=>{var e,t;U(null),F(!1),z({id:n.session.id,currentQuestion:n.session.currentQuestion,currentEarnings:n.session.currentEarnings,securedAmount:n.session.securedAmount,nextPrize:n.session.nextPrize,skipsLeft:null!==(t=n.session.skipsLeft)&&void 0!==t?t:Math.max(0,(null!==(e=E.skipsLeft)&&void 0!==e?e:0)-1)}),P(n.question),I(null),X(60),M({type:"success",message:"Question pass\xe9e. Il vous reste ".concat(n.session.skipsLeft," saut(s).")})},3e3)}catch(e){M({type:"error",message:e.message})}finally{J||F(!1)}}}return A&&!T?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-white text-center",children:[(0,s.jsx)("div",{className:"text-xl mb-4",children:"Chargement..."}),R&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-red-600 rounded-lg max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"font-bold mb-2",children:"❌ Erreur"}),(0,s.jsx)("div",{className:"text-sm",children:R.message}),(0,s.jsx)("button",{onClick:()=>x.push("/"),className:"mt-4 px-4 py-2 bg-white/20 hover:bg-white/30 rounded",children:"← Retour \xe0 l'accueil"})]}),E&&!T&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300 mb-2",children:"Reprise de la session en cours..."}),(0,s.jsx)("button",{onClick:()=>eE(E.id,!0),className:"px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-black font-bold rounded",children:"\uD83D\uDD04 Reprendre maintenant"})]})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white p-4 overflow-x-hidden",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("button",{onClick:()=>x.push("/"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition",children:"← Retour"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-center",children:"\uD83D\uDCB0 Quitte ou Double"}),(0,s.jsx)("div",{className:"text-sm text-gray-300 min-w-[120px] text-right",children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)("button",{onClick:()=>Y(!0),className:"px-2 py-1 bg-white/10 hover:bg-white/20 rounded",title:"Voir le tutoriel",children:"❓ Tutoriel"}),null!=N?(0,s.jsxs)("span",{title:"Joueurs connect\xe9s \xe0 la partie",children:["\uD83D\uDC65 ",N," en ligne"]}):(0,s.jsx)("span",{className:"text-gray-500",children:"\xa0"})]})})]}),Q&&(0,s.jsxs)("div",{className:"mb-6 text-xs",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:["number"==typeof Q.remaining&&(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-emerald-800/40 border border-emerald-700 text-emerald-200",children:["Questions totales: ",Q.remaining]}),(null==k?void 0:k.tokens)===20&&(0,s.jsx)("span",{className:"px-2 py-1 rounded bg-yellow-600/30 border border-yellow-500 text-yellow-300 font-semibold",title:"Vous avez atteint le maximum de tokens",children:"✅ Max tokens (20)"}),Q.categories&&Q.categories.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[Q.categories.slice(0,5).map(e=>{var t,n;return(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-gray-200",title:"Restantes: ".concat(e.remaining," / Total: ").concat(null!==(t=e.total)&&void 0!==t?t:"?"," (Utilis\xe9es: ").concat(null!==(n=e.used)&&void 0!==n?n:"?",")"),children:[e.category," ",e.remaining]},e.category)}),Q.categories.length>5&&(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-gray-200",children:["+",Q.categories.length-5," autres"]})]}),(0,s.jsx)("button",{onClick:()=>V(e=>!e),className:"ml-2 px-2 py-1 rounded bg-blue-600/40 hover:bg-blue-600/60 border border-blue-500 text-blue-100",children:B?"Fermer d\xe9tails":"D\xe9tails cat\xe9gories"})]}):Q.remainingByCategory&&(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-gray-200",children:["Finance ",Q.remainingByCategory.finance," \xb7 \xc9conomie ",Q.remainingByCategory.economy," \xb7 Immo ",Q.remainingByCategory.realEstate]})]}),B&&Q.categories&&Q.categories.length>0&&(0,s.jsxs)("div",{className:"mt-4 bg-white/5 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"text-center font-bold mb-3 text-white/90",children:"\uD83D\uDCC2 Banque par cat\xe9gorie"}),(0,s.jsx)("div",{className:"space-y-2",children:Q.categories.slice().sort((e,t)=>e.category.localeCompare(t.category)).map(e=>{var t,n,r;let o=null!==(n=e.total)&&void 0!==n?n:e.remaining+(null!==(t=e.used)&&void 0!==t?t:0),i=null!==(r=e.used)&&void 0!==r?r:o-e.remaining,a=o>0?Math.round(e.remaining/o*100):0,l=["definitions","quebec","religions"].includes(e.category.toLowerCase()),c=["enfant","kids","enfants"].includes(e.category.toLowerCase());return(0,s.jsxs)("div",{className:"p-2 rounded border ".concat(c?"border-green-500/60 bg-green-500/10":l?"border-indigo-400/60 bg-indigo-400/10":"border-white/10 bg-white/5"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsxs)("div",{className:"font-semibold flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.category}),c&&(0,s.jsx)("span",{className:"text-xs px-1 py-0.5 rounded bg-green-600/40 border border-green-500",children:"Enfants (Q1-2)"}),l&&(0,s.jsx)("span",{className:"text-xs px-1 py-0.5 rounded bg-indigo-600/40 border border-indigo-500",children:"Cibl\xe9e (Q3-5)"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-300",children:["Restantes ",e.remaining," / Total ",o," \xb7 Utilis\xe9es ",i]})]}),(0,s.jsx)("div",{className:"h-2 rounded overflow-hidden bg-black/30",children:(0,s.jsx)("div",{className:"h-full transition-all ".concat(a<25?"bg-red-500":a<50?"bg-yellow-500":"bg-emerald-500"),style:{width:"".concat(a,"%")}})}),(0,s.jsxs)("div",{className:"mt-1 text-[10px] text-gray-400",children:[a,"% restantes"]})]},e.category)})}),(0,s.jsx)("p",{className:"mt-3 text-[10px] text-gray-400 text-center",children:"Les cat\xe9gories cibl\xe9es (D\xe9finitions, Qu\xe9bec, Religions) sont prioritaires pour les questions 3 \xe0 5."})]})]}),R&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat("success"===R.type?"bg-green-600":"bg-red-600"),children:R.message}),!E&&k&&!k.hasActiveSession&&(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center",children:[(0,s.jsxs)("div",{className:"mb-8 p-6 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-xl border-2 border-yellow-500/50",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"\uD83C\uDF9F️ Vos Tokens Quiz"}),(0,s.jsx)("div",{className:"text-6xl font-bold text-yellow-400 mb-2",children:k.tokens||0}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:k.tokens>0?"Vous avez ".concat(k.tokens," token").concat(k.tokens>1?"s":""," disponible").concat(k.tokens>1?"s":""):"Aucun token disponible"}),k.secondsUntilNextToken&&(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["⏱️ Prochain token dans ",Math.floor(k.secondsUntilNextToken/60)," min ",k.secondsUntilNextToken%60," sec"]})]}),eg?(0,s.jsxs)("div",{className:"mb-6 bg-indigo-900/40 border border-indigo-500/30 rounded-lg p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-indigo-100",children:"Recharge instantan\xe9e \uD83C\uDF81"}),(0,s.jsx)("p",{className:"text-xs text-indigo-200/70",children:"Regardez une pub pour regagner +20 tokens (cooldown 30 min)."})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{try{localStorage.removeItem("hm-ad-consent")}catch(e){}eu("Consentement r\xe9initialis\xe9.")},className:"text-[11px] px-2 py-1 rounded bg-white/10 hover:bg-white/20 border border-white/20",title:"Effacer le consentement pubs (UMP se r\xe9affichera sur Android)",children:"R\xe9initialiser consentement"})]}),(0,s.jsx)("button",{onClick:eC,disabled:ea||eo>0||!es||(null!==(t=null==k?void 0:k.tokens)&&void 0!==t?t:0)>=20,className:"w-full py-2 rounded-lg font-semibold transition ".concat(ea||eo>0||!es||(null!==(a=null==k?void 0:k.tokens)&&void 0!==a?a:0)>=20?"bg-white/10 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-400 to-green-500 text-black hover:from-emerald-300 hover:to-green-400"),children:ea?"Lecture en cours…":eo>0?"Disponible dans ".concat(eS(eo)):(null!==(l=null==k?void 0:k.tokens)&&void 0!==l?l:0)>=20?"Tokens d\xe9j\xe0 au maximum":es?"\uD83D\uDCFA Regarder une pub (+20 tokens)":"Pr\xe9paration de la pub…"}),ec&&(0,s.jsx)("div",{className:"text-xs text-emerald-300",children:ec}),ed&&(0,s.jsx)("div",{className:"text-xs text-red-300",children:ed})]}):(0,s.jsxs)("div",{className:"mb-6 bg-white/10 border border-white/20 rounded-lg p-4 space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:"Recharge par publicit\xe9 disponible sur Android"}),(0,s.jsx)("p",{className:"text-xs text-gray-300",children:"Installez l’application Android pour regarder une pub et regagner des tokens imm\xe9diatement."}),(0,s.jsx)("a",{href:"/telecharger",className:"inline-block mt-1 px-3 py-1 text-xs rounded bg-gradient-to-r from-yellow-300 to-orange-400 text-black font-semibold hover:from-yellow-200 hover:to-orange-300",children:"T\xe9l\xe9charger l’APK"})]}),k.canPlay?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Pr\xeat \xe0 jouer ?"}),(0,s.jsxs)("p",{className:"mb-6 text-lg",children:["R\xe9pondez aux questions et accumulez des gains !",(0,s.jsx)("br",{}),"Vous pouvez encaisser \xe0 tout moment ou continuer pour doubler vos gains."]}),(0,s.jsxs)("div",{className:"mb-6 text-left max-w-md mx-auto bg-white/5 p-4 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"\uD83D\uDCDC R\xe8gles :"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[(0,s.jsx)("li",{children:"1 token = 1 session de quiz"}),(0,s.jsx)("li",{children:"Gagnez 1 token automatiquement toutes les heures"}),(0,s.jsx)("li",{children:"R\xe8gle Quitte ou Double: on commence \xe0 50 000 $"}),(0,s.jsx)("li",{children:"Chaque bonne r\xe9ponse double vos gains (50k → 100k → 200k → 400k ...)"}),(0,s.jsx)("li",{children:"Vous pouvez encaisser \xe0 tout moment pour s\xe9curiser vos gains"}),(0,s.jsx)("li",{children:"Mauvaise r\xe9ponse = vous perdez tout"}),(0,s.jsxs)("li",{children:["Vous pouvez sauter jusqu'\xe0 ",(0,s.jsx)("b",{children:"3 questions"})," par session"]}),(0,s.jsx)("li",{children:"Maximum 10 questions par session"}),(0,s.jsx)("li",{children:"Difficult\xe9: Q1-2 enfants, Q3-5 moyenne (tous sujets), Q6-10 difficile (tests de QI)"})]})]}),(0,s.jsx)("button",{onClick:function(){ev(!0)},className:"px-8 py-4 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 rounded-xl font-bold text-xl transition shadow-lg",children:"\uD83C\uDFAE D\xe9marrer le Quiz (Co\xfbte 1 token)"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"⏰ Pas de token disponible"}),(0,s.jsxs)("p",{className:"mb-4 text-lg",children:["Prochain token dans ",(0,s.jsxs)("span",{className:"font-bold text-yellow-400",children:[Math.floor((k.secondsUntilNextToken||0)/60)," minutes"]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-300 mb-4",children:"Vous gagnez automatiquement 1 token toutes les heures"}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"\uD83D\uDCA1 Les tokens s'accumulent si vous ne jouez pas"}),(0,s.jsx)("div",{className:"mt-4 text-sm text-gray-300",children:"Ou gagnez imm\xe9diatement +20 tokens en regardant une publicit\xe9 ci-dessus."})]})]}),E&&T&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Question"}),(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[E.currentQuestion," / 10"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Gains actuels"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-green-400",children:(0,d.l)(E.currentEarnings)})]})]}),(0,s.jsx)("div",{className:"mb-2 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-lg font-mono px-4 py-1 rounded-full border ".concat(_<=5?"bg-red-600 border-red-500 animate-pulse":"bg-black/30 border-white/20"),children:["⏱️ ",_,"s"]})}),(0,s.jsxs)("div",{className:"text-center text-sm text-gray-300",children:["Sauts restants : ",(0,s.jsxs)("span",{className:"font-bold",children:[null!==(c=E.skipsLeft)&&void 0!==c?c:0," / 3"]})]}),(0,s.jsxs)("div",{className:"text-center text-sm text-purple-300 mt-1",children:["✨ Passes de vie : ",(0,s.jsx)("span",{className:"font-bold",children:K})]}),0===E.skipsLeft&&(0,s.jsx)("div",{className:"mt-2 flex justify-center text-xs text-gray-400",children:"Recharge de saut momentan\xe9ment indisponible."}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300 mb-1",children:"Prochain gain"}),(0,s.jsx)("div",{className:"text-3xl font-bold text-yellow-400",children:(0,d.l)(E.nextPrize)}),(null===(e=w[E.currentQuestion-1])||void 0===e?void 0:e.milestone)&&(0,s.jsx)("div",{className:"mt-2 text-xs text-green-400",children:"\uD83D\uDEE1️ Palier de s\xe9curit\xe9"})]}),E.securedAmount>0&&(0,s.jsxs)("div",{className:"mt-4 text-center text-sm text-gray-300",children:["Montant s\xe9curis\xe9 : ",(0,s.jsx)("span",{className:"font-bold text-green-400",children:(0,d.l)(E.securedAmount)})]})]}),(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:T.text}),G&&(0,s.jsxs)("div",{className:"mb-4 text-center text-red-300 text-sm",children:["Temps \xe9coul\xe9 — r\xe9ponse correcte: ",(0,s.jsx)("span",{className:"font-bold",children:J})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["A","B","C","D"].map(e=>{let t=J===e,n=J&&q===e&&J!==q,r=!!J,o=J?t?"bg-green-600 text-black font-bold":n?"bg-red-600 text-white font-bold":"bg-white/5":q===e?"bg-yellow-500 text-black font-bold shadow-lg":"bg-white/5 hover:bg-white/10";return(0,s.jsxs)("button",{onClick:()=>!r&&I(e),disabled:r,className:"".concat("p-4 rounded-lg text-left transition transform hover:scale-105"," ").concat(o," ").concat(r?"opacity-70 cursor-not-allowed":""),children:[(0,s.jsxs)("span",{className:"font-bold mr-2",children:[e,"."]}),T["option".concat(e)]]},e)})})]},T.id),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("button",{onClick:eP,disabled:et,className:"w-full md:w-auto px-4 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-sm transition shadow-lg",title:"Regarder une publicit\xe9 pour obtenir une passe de vie",children:et?"⏳ ...":"\uD83D\uDCFA Pub → +1 Passe"}),(0,s.jsxs)("button",{onClick:eT,disabled:L||0===E.currentEarnings,className:"w-full md:flex-1 px-6 py-4 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition shadow-lg",children:["\uD83D\uDCB0 Encaisser ",(0,d.l)(E.currentEarnings)]}),(0,s.jsxs)("button",{onClick:eq,disabled:L||!!J||(null!==(h=E.skipsLeft)&&void 0!==h?h:0)<=0,className:"w-full md:w-auto px-4 py-4 bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition shadow-lg",title:"Passer cette question",children:["⏭️ Passer (",null!==(p=E.skipsLeft)&&void 0!==p?p:0,"/3)"]}),eg?(0,s.jsx)("button",{onClick:eA,disabled:ep||!!J||G,className:"w-full md:w-auto px-4 py-4 bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-300 hover:to-orange-400 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-sm transition shadow-lg",title:"Regarder une publicit\xe9 pour obtenir automatiquement la bonne r\xe9ponse",children:ep?"⏳ R\xe9v\xe9lation...":"\uD83D\uDCFA R\xe9ponse auto (pub)"}):(0,s.jsx)("button",{disabled:!0,className:"w-full md:w-auto px-4 py-4 bg-gray-700 text-gray-300 rounded-xl font-bold text-sm cursor-not-allowed",title:"Disponible uniquement sur l’application Android",children:"\uD83D\uDCF1 R\xe9ponse auto: Android requis"}),(0,s.jsx)("button",{onClick:ez,disabled:!q||L||!!J,className:"w-full md:flex-1 px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition shadow-lg",children:L?"⏳ ...":"✓ Valider ma r\xe9ponse"})]}),ef&&(0,s.jsx)("div",{className:"text-xs text-red-300 mt-2",children:ef})]}),(0,s.jsxs)("div",{className:"mt-8 bg-white/5 backdrop-blur-md rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4 text-center",children:"\uD83D\uDCCA \xc9chelle des gains"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 text-sm",children:w.map(e=>(0,s.jsxs)("div",{className:"p-2 rounded text-center ".concat(E&&E.currentQuestion===e.question?"bg-yellow-500 text-black font-bold":"bg-white/5"),children:[(0,s.jsxs)("div",{className:"text-xs",children:["Q",e.question]}),(0,s.jsx)("div",{className:"font-bold",children:(0,d.l)(Math.round(e.amount))})]},e.question))})]})]}),H&&(0,s.jsx)(i,{onClose:()=>Y(!1)}),ey&&(0,s.jsx)(u,{onStart:function(e){ev(!1),eE(void 0,!1,e)},onCancel:function(){ev(!1)}}),Z&&K>0&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-gradient-to-br from-purple-900 to-pink-900 rounded-2xl p-8 max-w-md w-full shadow-2xl border-2 border-purple-500",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"✨"}),(0,s.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"Mauvaise r\xe9ponse !"}),(0,s.jsxs)("p",{className:"text-gray-200 mb-6",children:["Vous avez ",(0,s.jsx)("span",{className:"font-bold text-yellow-400",children:K})," passe",K>1?"s":""," de vie.",(0,s.jsx)("br",{}),"Voulez-vous en utiliser une pour continuer ?"]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("button",{onClick:function(){K>0&&(W(e=>e-1),ee(!1),M({type:"success",message:"✨ Passe utilis\xe9e ! Vous continuez le quiz."}),v.reward(),setTimeout(()=>ek(),1e3))},className:"w-full px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 rounded-xl font-bold text-lg transition shadow-lg",children:"✓ Utiliser une passe et continuer"}),(0,s.jsx)("button",{onClick:()=>{ee(!1),setTimeout(()=>{U(null),z(null),P(null),I(null),ek(),eD()},5e3)},className:"w-full px-6 py-4 bg-gray-600 hover:bg-gray-500 rounded-xl font-bold transition",children:"✗ Non, arr\xeater le quiz"})]})]})})})]})}},6325:function(e,t,n){"use strict";n.d(t,{Fy:function(){return x},Ie:function(){return h},Nf:function(){return p},YY:function(){return l},fL:function(){return m},showInterstitialAd:function(){return d},yk:function(){return g}});let s=!1,r=0,o=0;try{{let e=localStorage.getItem("hm-ads-rewarded-last"),t=e?Number(e):0;!Number.isNaN(t)&&t>0&&(o=t)}}catch(e){}function i(){let e=window.Capacitor,t=!1;try{let n=null==e?void 0:e.isNativePlatform;"function"==typeof n?t=!!n():(null==e?void 0:e.platform)&&"web"!==e.platform&&(t=!0)}catch(e){}return console.log("[Ads] isNativePlatform:",t),console.log("[Ads] Capacitor available:",!!e),console.log("[Ads] Capacitor.platform:",null==e?void 0:e.platform),t}function a(){var e;let t=window.Capacitor;return(console.log("[Ads] Capacitor:",t),console.log("[Ads] Capacitor.Plugins:",null==t?void 0:t.Plugins),console.log("[Ads] Capacitor.Plugins.AdMob:",null==t?void 0:null===(e=t.Plugins)||void 0===e?void 0:e.AdMob),null==t?void 0:t.Plugins)?t.Plugins.AdMob:null}async function l(){if(!s){if(!i()){console.log("[Ads] Skip initialization (web/PWA)");return}try{let e=localStorage.getItem("hm-ad-consent");if(!e||"refused"===e){let t=a();if(t&&"function"==typeof t.requestConsent)try{let n=await t.requestConsent();if(n&&"boolean"==typeof n.npa){let t=n.npa?"npa":"accepted";try{localStorage.setItem("hm-ad-consent",t),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(e){}e=t}}catch(e){console.warn("[Ads] Native requestConsent failed:",e)}}if("refused"===e){e="npa";try{localStorage.setItem("hm-ad-consent","npa"),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(e){}}if("accepted"!==e&&"npa"!==e){console.log("[Ads] User has not accepted ad consent, skipping initialization");return}}catch(e){}try{let i=a();if(!i){console.log("[Ads] AdMob plugin not available");return}await i.initialize(),s=!0;try{var e,t,n,r,o;null===(e=i.addListener)||void 0===e||e.call(i,"adShowed",()=>console.log("[Ads] Event: adShowed")),null===(t=i.addListener)||void 0===t||t.call(i,"adDismissed",()=>console.log("[Ads] Event: adDismissed")),null===(n=i.addListener)||void 0===n||n.call(i,"rewardedAdShowed",()=>console.log("[Ads] Event: rewardedAdShowed")),null===(r=i.addListener)||void 0===r||r.call(i,"rewardedAdDismissed",()=>console.log("[Ads] Event: rewardedAdDismissed")),null===(o=i.addListener)||void 0===o||o.call(i,"rewardEarned",e=>console.log("[Ads] Event: rewardEarned",e))}catch(e){console.warn("[Ads] Failed to attach listeners:",e)}await c(),await u(),console.log("[Ads] AdMob initialized successfully")}catch(e){console.error("[Ads] Failed to initialize AdMob:",e)}}}async function c(){if(!i())return;let e=a();if(e&&s)try{await e.loadInterstitial(),console.log("[Ads] Interstitial ad loaded")}catch(e){console.error("[Ads] Failed to load interstitial ad:",e)}}async function u(){if(!i())return;let e=a();if(e&&s)try{await e.loadRewardedAd(),console.log("[Ads] Rewarded ad loaded")}catch(e){console.error("[Ads] Failed to load rewarded ad:",e)}}async function d(){if(!i())return console.log("[Ads] Not on native platform"),!1;let e=a();if(!e||!s)return console.log("[Ads] AdMob not initialized"),!1;let t=Date.now();if(t-r<12e4)return console.log("[Ads] Too soon to show another ad"),!1;try{let{ready:n}=await e.isAdReady();if(!n)return console.log("[Ads] No ad ready to show, loading new one..."),c(),!1;return await e.showInterstitial(),r=t,c(),console.log("[Ads] Interstitial ad shown successfully"),!0}catch(e){return console.error("[Ads] Failed to show interstitial ad:",e),!1}}async function m(e){var t;if(!i())return console.log("[Ads] Not on native platform"),!1;let n=a();if(!n||!s)return console.log("[Ads] AdMob not initialized"),!1;let r="function"==typeof e?{onReward:e}:null!=e?e:{},l=null!==(t=r.ignoreCooldown)&&void 0!==t&&t,c=Date.now();if(!l&&c-o<3e5){let e=Math.ceil((3e5-(c-o))/6e4);return console.log("[Ads] Too soon to show another rewarded ad. Wait ".concat(e," more minutes")),!1}try{let{ready:e}=await n.isRewardedAdReady();if(!e)return console.log("[Ads] No rewarded ad ready to show, loading new one..."),u(),!1;let t=await n.showRewardedAd();if(!l){o=c;try{localStorage.setItem("hm-ads-rewarded-last",String(c))}catch(e){}}return r.onReward&&r.onReward(t.amount,t.type),u(),console.log("[Ads] Rewarded ad shown successfully. Reward: ".concat(t.amount," ").concat(t.type)),!0}catch(e){return console.error("[Ads] Failed to show rewarded ad:",e),!1}}async function g(e){if(!i())return!1;let t=a();if(!t||!s)return!1;let n=Date.now();if(!(null==e?void 0:e.ignoreCooldown)&&n-o<3e5)return!1;try{let{ready:e}=await t.isRewardedAdReady();return e}catch(e){return!1}}function h(){let e=Date.now()-o;return e>=3e5?0:Math.ceil((3e5-e)/1e3)}function p(){return i()}async function x(){if(!i())return!1;let e=a();if(!e||!s)return!1;try{let{ready:t}=await e.isAdReady();return t}catch(e){return!1}}},9513:function(e,t,n){"use strict";n.d(t,{MS:function(){return c},SC:function(){return g},Sg:function(){return l}});var s=n(5050);let r="https://server-jeux-millionnaire.onrender.com",o=!!window.Capacitor,i=/localhost:3000$/.test(window.location.host),a="1"===s.env.NEXT_PUBLIC_FORCE_ABS,l=o||a||!i?r:"";console.log("[API] ABS_BACKEND:",r),console.log("[API] isCapacitor:",o),console.log("[API] isLocalDev:",i),console.log("[API] forceAbs:",a),console.log("[API] API_BASE:",l);class c extends Error{constructor(e,t){super(t),this.name="ApiError",this.status=e,Object.setPrototypeOf(this,c.prototype)}}let u=null,d="HM_TOKEN";async function m(){try{var e;if(u)return u;let t=await fetch("".concat(l,"/api/auth/csrf"),{credentials:"include"});if(!t.ok)return null;let n=await t.json();return u=null!==(e=null==n?void 0:n.csrf)&&void 0!==e?e:null}catch(e){return null}}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.method||"GET").toUpperCase(),s={...t.headers};if(console.log("[API] ".concat(n," ").concat(l).concat(e)),["POST","PUT","PATCH","DELETE"].includes(n)){let e=await m();e&&(s["x-csrf-token"]=e)}let r=function(){try{return window.localStorage.getItem(d)}catch(e){return null}}();r&&(s.Authorization="Bearer ".concat(r));let o=function(){try{let e=window.localStorage.getItem("hm-session");if(!e)return null;return JSON.parse(e).playerId||null}catch(e){return null}}();o&&(s["X-Player-ID"]=o);try{let n=await fetch("".concat(l).concat(e),{credentials:"include",...t,headers:s});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(r){let n=await fetch("".concat(l,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(n.ok){let r=await n.json().catch(()=>({}));if(null==r?void 0:r.token){try{window.localStorage.setItem(d,r.token)}catch(e){}s.Authorization="Bearer ".concat(r.token)}let o=await fetch("".concat(l).concat(e),{credentials:"include",...t,headers:s});if(!o.ok)throw new c(o.status,o.statusText);if(204===o.status)return;return await o.json()}}}catch(e){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let e=await n.json(),t=e&&(e.error||e.message)?String(e.error||e.message):"Erreur ".concat(n.status);throw new c(n.status,t)}{let e=(await n.text()||"").trim(),t=e.length?e:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new c(n.status,t)}}catch(t){let e=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(t instanceof c)throw t;throw new c(n.status,e)}if(204===n.status)return;return await n.json()}catch(e){throw console.error("[API] Fetch error:",e),new c(0,"Erreur r\xe9seau: ".concat(e.message||"Failed to fetch"))}}},2044:function(e,t,n){"use strict";function s(e){let t=Number(e);return isFinite(t)?"$".concat(Math.round(t).toLocaleString()):"$0"}function r(e){return 52*Number(e||0)/12}n.d(t,{P:function(){return r},l:function(){return s}})},168:function(e,t,n){"use strict";var s=n(7462);n.o(s,"usePathname")&&n.d(t,{usePathname:function(){return s.usePathname}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})},5050:function(e,t,n){"use strict";var s,r;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(9295)},9295:function(e){!function(){var t={229:function(e){var t,n,s,r=e.exports={};function o(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var l=[],c=!1,u=-1;function d(){c&&s&&(c=!1,s.length?l=s.concat(l):u=-1,l.length&&m())}function m(){if(!c){var e=a(d);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||c||a(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=h,r.addListener=h,r.once=h,r.off=h,r.removeListener=h,r.removeAllListeners=h,r.emit=h,r.prependListener=h,r.prependOnceListener=h,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}},i=!0;try{t[e](o,o.exports,s),i=!1}finally{i&&delete n[e]}return o.exports}s.ab="//";var r=s(229);e.exports=r}()}},function(e){e.O(0,[115,205,744],function(){return e(e.s=4091)}),_N_E=e.O()}]);