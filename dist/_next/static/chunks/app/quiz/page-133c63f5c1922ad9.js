(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{4091:function(e,t,n){Promise.resolve().then(n.bind(n,5069))},5069:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var s=n(7821),r=n(8078),o=n(168);function a(e){let{onClose:t,storageKey:n="hm-tutorial-quiz"}=e,o=[{title:"Bienvenue dans Quitte ou Double",content:"Gagnez de l'argent en r\xe9pondant \xe0 des questions. Vous recevez des tokens automatiquement chaque heure pour lancer une session."},{title:"D\xe9marrer une session",content:"Appuyez sur ‘D\xe9marrer le Quiz’ (1 token). Une session contient jusqu'\xe0 10 questions et commence \xe0 5 000 $."},{title:"R\xe9pondre et doubler",content:"Chaque bonne r\xe9ponse double vos gains (5k → 10k → 20k …). Vous pouvez encaisser \xe0 tout moment."},{title:"Sauter jusqu'\xe0 3 questions",content:"Si une question s'entrem\xeale ou ne vous inspire pas, utilisez ‘Passer’. Vous avez 3 sauts par session."},{title:"Mauvaise r\xe9ponse",content:"Une mauvaise r\xe9ponse = vous perdez tout. L'app affiche la bonne r\xe9ponse pendant 5 secondes, puis la session se termine."},{title:"Conseils",content:"Variez les cat\xe9gories, surveillez vos sauts restants, et encaissez si vous voulez s\xe9curiser vos gains."}],[a,i]=(0,r.useState)(0),[l,c]=(0,r.useState)(!1);return(0,s.jsx)("div",{className:"fixed inset-0 z-[9999] bg-black/70 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"max-w-lg w-full bg-white rounded-2xl shadow-2xl text-gray-900",children:[(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"text-xl font-bold mb-2",children:o[a].title}),(0,s.jsx)("div",{className:"text-sm text-gray-700 mb-6",children:o[a].content}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("label",{className:"text-xs text-gray-600 flex items-center gap-2 select-none",children:[(0,s.jsx)("input",{type:"checkbox",checked:l,onChange:e=>c(e.target.checked)}),"Ne plus afficher automatiquement"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[a>0&&(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-gray-200 hover:bg-gray-300",onClick:()=>i(e=>Math.max(0,e-1)),children:"← Pr\xe9c\xe9dent"}),a<o.length-1?(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",onClick:()=>i(e=>Math.min(o.length-1,e+1)),children:"Suivant →"}):(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700",onClick:function(){try{l&&localStorage.setItem(n,"1")}catch(e){}t()},children:"J'ai compris"})]})]})]}),(0,s.jsx)("div",{className:"px-6 pb-4 text-center",children:(0,s.jsx)("div",{className:"inline-flex gap-1",children:o.map((e,t)=>(0,s.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(t===a?"bg-indigo-600":"bg-gray-300"),"aria-hidden":!0},t))})})]})})}var i=n(2044),l=n(9513),c=n(6325);let d={correct:["/audio/sfx-correct.mp3","/audio/sfx-correct.wav"],wrong:["/audio/sfx-wrong.mp3","/audio/sfx-wrong.wav"],reward:["/audio/sfx-reward.mp3","/audio/sfx-reward.wav"]},u=new Map,m=null;function g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sine",s=function(){try{return m||(m=new(window.AudioContext||window.webkitAudioContext)),"suspended"===m.state&&m.resume().catch(()=>{}),m}catch(e){return null}}();if(!s)return;let r=s.currentTime,o=s.createGain();o.gain.value=0,o.connect(s.destination);let a=s.createOscillator();for(let s of(a.type=n,a.connect(o),a.start(r),e))a.frequency.setValueAtTime(s.freq,r),o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(0,r),o.gain.linearRampToValueAtTime(Math.min(1,Math.max(0,t)),r+.01),o.gain.linearRampToValueAtTime(0,r+Math.max(.08,s.dur-.02)),r+=s.dur;a.stop(r+.02)}function h(e,t){"correct"===e?g([{freq:523.25,dur:.12},{freq:659.25,dur:.12},{freq:783.99,dur:.16}],t,"triangle"):"wrong"===e?g([{freq:220,dur:.16},{freq:196,dur:.22}],.9*t,"square"):g([{freq:523.25,dur:.12},{freq:659.25,dur:.12},{freq:783.99,dur:.14},{freq:1046.5,dur:.18}],Math.min(1,t),"sine")}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{let n=function(e){if(u.has(e))return u.get(e);let t=d[e]||[],n=new Audio;n.preload="auto";let s={audio:n,loaded:!1},r=0,o=()=>{if(r>=t.length){s.loaded=!0;return}let e=t[r++];n.src=e;try{n.load()}catch(e){}};return n.addEventListener("canplay",()=>{s.loaded=!0}),n.addEventListener("error",()=>{s.loaded||o()}),o(),u.set(e,s),s}(e),s=Math.min(1,Math.max(0,t)),r=n.audio.cloneNode();r.volume=s,r.play().catch(()=>{h(e,s)}),setTimeout(()=>{(r.duration===1/0||0===r.duration)&&r.paused&&h(e,s)},250)}catch(e){h("correct",Math.min(1,Math.max(0,t)))}}let f={correct:()=>x("correct",.9),wrong:()=>x("wrong",.9),reward:()=>x("reward",1)},p=Array.from({length:10}).map((e,t)=>{let n=t+1;return{question:n,amount:5e4*Math.pow(2,t),difficulty:n<=2?"Enfant":n<=5?"Moyen":"Difficile (QI)",milestone:!1}});function b(){var e,t,d,u,m,g,h;let x=(0,o.useRouter)(),[b,y]=(0,r.useState)(null),[w,v]=(0,r.useState)(null),[j,N]=(0,r.useState)(null),[k,A]=(0,r.useState)(null),[S,C]=(0,r.useState)(!0),[E,T]=(0,r.useState)(null),[z,D]=(0,r.useState)(null),[P,I]=(0,r.useState)(null),[q,M]=(0,r.useState)(null),[R,L]=(0,r.useState)(!1),[Q,F]=(0,r.useState)(null),[O,V]=(0,r.useState)(!1),[B,X]=(0,r.useState)(null),[J,U]=(0,r.useState)(60),[_,G]=(0,r.useState)(!1),[$,Y]=(0,r.useState)(!1),[H,K]=(0,r.useState)(0),[W,Z]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(!1),[en,es]=(0,r.useState)(!1),[er,eo]=(0,r.useState)(0),[ea,ei]=(0,r.useState)(!1),[el,ec]=(0,r.useState)(null),[ed,eu]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(null==z?void 0:z.id){try{window.scrollTo({top:0,behavior:"instant"})}catch(e){try{window.scrollTo(0,0)}catch(e){}}I(null),X(null),U(60),G(!1)}},[null==z?void 0:z.id]),(0,r.useEffect)(()=>{(0,c.YY)()},[]),(0,r.useEffect)(()=>{let e=!1,t=async()=>{try{let t=await (0,c.yk)();if(e||es(t),!e){let e=(0,c.Ie)();e>0&&eo(t=>Math.max(t,e))}}catch(e){}};t();let n=setInterval(t,15e3);return()=>{e=!0,clearInterval(n)}},[]),(0,r.useEffect)(()=>{if(er<=0)return;let e=setInterval(()=>{eo(e=>e>0?e-1:0)},1e3);return()=>clearInterval(e)},[er>0]),(0,r.useEffect)(()=>{if(!E||!z||B||_)return;if(J<=0){(async()=>{try{let e={"Content-Type":"application/json","X-CSRF":"1"};w&&(e["X-Player-ID"]=w);let t=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/timeout"),{method:"POST",credentials:"include",headers:e,body:JSON.stringify({sessionId:E.id,questionId:z.id})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Timeout quiz erreur")}let n=await t.json();X(n.correctAnswer),G(!0),M({type:"error",message:n.message}),setTimeout(()=>{X(null),G(!1),T(null),D(null),eh(),eg()},5e3)}catch(e){M({type:"error",message:e.message})}})();return}let e=setTimeout(()=>U(e=>e-1),1e3);return()=>clearTimeout(e)},[J,E,z,B,_,w,b]);let em=(0,r.useCallback)(async()=>{try{var e;let t=localStorage.getItem("hm-session");if(console.log("[Quiz] Session from localStorage:",t),t){let e=JSON.parse(t);if(null==e?void 0:e.gameId)return y(e.gameId),v(e.playerId),!0}console.warn("[Quiz] No session found, fallback auto-join");let n=await fetch("".concat(l.Sg,"/api/games"),{credentials:"include"});if(!n.ok)throw Error("Liste parties indisponible");let s=await n.json(),r=null===(e=s.games)||void 0===e?void 0:e[0];if(!r)throw Error("Aucune partie disponible");let o=await fetch("".concat(l.Sg,"/api/games/").concat(r.id,"/join"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!o.ok)throw Error("Join \xe9chou\xe9");let a=await o.json(),i={gameId:r.id,playerId:a.playerId,nickname:""};try{localStorage.setItem("hm-session",JSON.stringify(i))}catch(e){}return y(r.id),v(a.playerId),!0}catch(e){return console.error("[Quiz] ensureSession error:",e.message),!1}},[]);async function eg(){try{var e;let t=await fetch("".concat(l.Sg,"/api/quiz/public-stats"),{credentials:"include"});if(!t.ok)return;let n=await t.json(),s=Array.isArray(n.categories)?n.categories.map(e=>{var t,n,s,r;return{category:String(null!==(t=e.category)&&void 0!==t?t:"autre"),remaining:Number(null!==(n=e.remaining)&&void 0!==n?n:0),total:Number(null!==(s=e.total)&&void 0!==s?s:0),used:Number(null!==(r=e.used)&&void 0!==r?r:0)}}):void 0;F({remaining:Number(null!==(e=n.remaining)&&void 0!==e?e:0),remainingByCategory:n.remainingByCategory,categories:s})}catch(e){}}async function eh(e){try{(null==e?void 0:e.silent)||C(!0),console.log("[Quiz] Loading status for game:",b);let t={"X-CSRF":"1"};w&&(t["X-Player-ID"]=w);let n=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/status"),{credentials:"include",headers:t});if(console.log("[Quiz] Status response:",n.status,n.statusText),!n.ok){let e=await n.json().catch(()=>({}));throw console.error("[Quiz] Status error:",e),Error(e.error||"Erreur chargement status")}let s=await n.json();console.log("[Quiz] Status data:",s),A(s),"number"==typeof(null==s?void 0:s.adCooldownSeconds)&&eo(e=>Math.max(e,Number(s.adCooldownSeconds))),s.hasActiveSession&&(T(s.session),await ep(s.session.id,!0)),eg()}catch(e){console.error("[Quiz] Error in loadStatus:",e),M({type:"error",message:e.message})}finally{C(!1)}}async function ex(){if(!b||!w){eu("Session introuvable. Rejoignez d'abord une partie.");return}if(!ea){ei(!0),eu(null),ec(null);try{var e,t;if(!await (0,c.yk)()){let e=(0,c.Ie)();throw e>0&&eo(t=>Math.max(t,e)),Error("La publicit\xe9 n'est pas encore pr\xeate. R\xe9essayez bient\xf4t.")}if(!await (0,c.fL)())throw Error("Impossible d'afficher la publicit\xe9 maintenant.");let n=await (0,l.SC)("/api/games/".concat(b,"/tokens/ads"),{method:"POST",headers:{"Content-Type":"application/json","X-Player-ID":w},body:JSON.stringify({type:"quiz"})}),s=Number(null!==(e=null==n?void 0:n.added)&&void 0!==e?e:0),r="number"==typeof(null==n?void 0:n.tokens)?Number(n.tokens):void 0;"number"==typeof r&&A(e=>e?{...e,tokens:r,canPlay:r>0}:e),ec(s>0?"+".concat(s," tokens ajout\xe9s ✅"):"Tokens d\xe9j\xe0 au maximum ✅");let o=Number(null!==(t=null==n?void 0:n.cooldownSeconds)&&void 0!==t?t:0),a=(0,c.Ie)(),i=Math.max(o,a);i>0&&eo(e=>Math.max(e,i)),await eh({silent:!0})}catch(e){if(e instanceof l.MS){if(eu(e.message),429===e.status){let t=e.message.match(/(\d+)/);if(t){let e=Number(t[1]);Number.isNaN(e)||eo(t=>Math.max(t,60*e))}}}else e instanceof Error?eu(e.message):eu("Recharge indisponible pour le moment.")}finally{ei(!1),setTimeout(()=>{(0,c.yk)().then(e=>es(e))},500)}}}(0,r.useEffect)(()=>((async()=>{if(!await em()){setTimeout(()=>x.push("/"),1500);return}try{localStorage.getItem("hm-tutorial-quiz")||Y(!0)}catch(e){}try{window.dispatchEvent(new Event("hm-music/pause"))}catch(e){}})(),()=>{try{window.dispatchEvent(new Event("hm-music/resume"))}catch(e){}}),[em,x]),(0,r.useEffect)(()=>{if(b){eh(),eg();let e=async()=>{try{var e;let t=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/online"),{credentials:"include"});if(!t.ok)return;let n=await t.json();N(Number(null!==(e=n.online)&&void 0!==e?e:0))}catch(e){}};e();let t=setInterval(e,15e3);return()=>clearInterval(t)}},[b]);let ef=(0,r.useCallback)(e=>{if(e<=0)return"";let t=Math.floor(e/60),n=e%60;return t>0?"".concat(t,"m ").concat(n.toString().padStart(2,"0"),"s"):"".concat(n,"s")},[]);async function ep(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n,s;if(C(!0),M(null),t&&e){let e={"X-CSRF":"1"};w&&(e["X-Player-ID"]=w);let t=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/resume"),{method:"GET",credentials:"include",headers:e});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Erreur reprise de la session")}let s=await t.json();T({id:s.session.id,currentQuestion:s.session.currentQuestion,currentEarnings:s.session.currentEarnings,securedAmount:s.session.securedAmount,nextPrize:s.session.nextPrize,skipsLeft:null!==(n=s.session.skipsLeft)&&void 0!==n?n:0}),D(s.question),I(null);return}let r={"Content-Type":"application/json","X-CSRF":"1"};w&&(r["X-Player-ID"]=w);let o=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/start"),{method:"POST",credentials:"include",headers:r,body:JSON.stringify({})});if(!o.ok){let e=await o.json();throw Error(e.error||"Erreur d\xe9marrage")}let a=await o.json();T({id:a.sessionId,currentQuestion:a.currentQuestion,currentEarnings:a.currentEarnings,securedAmount:a.securedAmount,nextPrize:a.nextPrize,skipsLeft:null!==(s=a.skipsLeft)&&void 0!==s?s:3}),D(a.question),I(null)}catch(e){console.error(e),M({type:"error",message:e.message})}finally{C(!1)}}async function eb(){if(P&&z&&E)try{L(!0),M(null);let t={"Content-Type":"application/json","X-CSRF":"1"};w&&(t["X-Player-ID"]=w);let n=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/answer"),{method:"POST",credentials:"include",headers:t,body:JSON.stringify({sessionId:E.id,questionId:z.id,answer:P})});if(!n.ok){let e=await n.json();throw Error(e.error||"Erreur r\xe9ponse")}let s=await n.json();if(s.correct){if(f.correct(),s.completed)M({type:"success",message:s.message}),T(null),D(null),setTimeout(()=>{eh(),eg()},2e3);else{var e;T({id:E.id,currentQuestion:s.currentQuestion,currentEarnings:s.currentEarnings,securedAmount:s.securedAmount,nextPrize:s.nextPrize,skipsLeft:"number"==typeof s.skipsLeft?s.skipsLeft:null!==(e=E.skipsLeft)&&void 0!==e?e:0}),D(s.question),I(null),M({type:"success",message:"✓ Bonne r\xe9ponse !"}),eg()}}else M({type:"error",message:s.message}),X(s.correctAnswer),f.wrong(),H>0?Z(!0):setTimeout(()=>{X(null),T(null),D(null),I(null),eh(),eg()},5e3)}catch(e){console.error(e),M({type:"error",message:e.message})}finally{L(!1)}}async function ey(){if(E&&confirm("Voulez-vous encaisser ".concat((0,i.l)(E.currentEarnings)," ?")))try{C(!0),M(null);let e={"Content-Type":"application/json","X-CSRF":"1"};w&&(e["X-Player-ID"]=w);let t=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/cash-out"),{method:"POST",credentials:"include",headers:e,body:JSON.stringify({sessionId:E.id})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur encaissement")}let s=await t.json();M({type:"success",message:s.message}),T(null),D(null),f.correct(),setTimeout(async()=>{try{let{showInterstitialAd:e}=await Promise.resolve().then(n.bind(n,6325));await e()||console.log("[Quiz] Ad not ready or cooldown active")}catch(e){console.log("[Quiz] Ad error:",e)}},500),setTimeout(()=>{eh(),eg()},2e3)}catch(e){console.error(e),M({type:"error",message:e.message})}finally{C(!1)}}async function ew(){et(!0);try{let{showInterstitialAd:e}=await Promise.resolve().then(n.bind(n,6325));await e()?(K(e=>e+1),M({type:"success",message:"\uD83C\uDF81 +1 Passe de vie obtenue !"}),f.reward()):M({type:"error",message:"Aucune publicit\xe9 disponible pour le moment"})}catch(e){console.error("[Quiz] Error watching ad:",e),M({type:"error",message:"Erreur lors du chargement de la publicit\xe9"})}finally{et(!1)}}async function ev(){var e;if(E&&z){if((null!==(e=E.skipsLeft)&&void 0!==e?e:0)<=0){M({type:"error",message:"Vous n'avez plus de sauts disponibles."});return}try{L(!0),M(null);let e={"Content-Type":"application/json","X-CSRF":"1"};w&&(e["X-Player-ID"]=w);let t=await fetch("".concat(l.Sg,"/api/games/").concat(b,"/quiz/skip"),{method:"POST",credentials:"include",headers:e,body:JSON.stringify({sessionId:E.id,questionId:z.id})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Impossible de passer la question")}let n=await t.json();X(n.correctAnswer),M({type:"success",message:"R\xe9ponse: ".concat(n.correctAnswer," (question pass\xe9e)")}),L(!0),setTimeout(()=>{var e,t;X(null),L(!1),T({id:n.session.id,currentQuestion:n.session.currentQuestion,currentEarnings:n.session.currentEarnings,securedAmount:n.session.securedAmount,nextPrize:n.session.nextPrize,skipsLeft:null!==(t=n.session.skipsLeft)&&void 0!==t?t:Math.max(0,(null!==(e=E.skipsLeft)&&void 0!==e?e:0)-1)}),D(n.question),I(null),U(60),M({type:"success",message:"Question pass\xe9e. Il vous reste ".concat(n.session.skipsLeft," saut(s).")})},3e3)}catch(e){M({type:"error",message:e.message})}finally{B||L(!1)}}}return S&&!z?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-white text-center",children:[(0,s.jsx)("div",{className:"text-xl mb-4",children:"Chargement..."}),q&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-red-600 rounded-lg max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"font-bold mb-2",children:"❌ Erreur"}),(0,s.jsx)("div",{className:"text-sm",children:q.message}),(0,s.jsx)("button",{onClick:()=>x.push("/"),className:"mt-4 px-4 py-2 bg-white/20 hover:bg-white/30 rounded",children:"← Retour \xe0 l'accueil"})]}),E&&!z&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300 mb-2",children:"Reprise de la session en cours..."}),(0,s.jsx)("button",{onClick:()=>ep(E.id,!0),className:"px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-black font-bold rounded",children:"\uD83D\uDD04 Reprendre maintenant"})]})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white p-4 overflow-x-hidden",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("button",{onClick:()=>x.push("/"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition",children:"← Retour"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-center",children:"\uD83D\uDCB0 Quitte ou Double"}),(0,s.jsx)("div",{className:"text-sm text-gray-300 min-w-[120px] text-right",children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)("button",{onClick:()=>Y(!0),className:"px-2 py-1 bg-white/10 hover:bg-white/20 rounded",title:"Voir le tutoriel",children:"❓ Tutoriel"}),null!=j?(0,s.jsxs)("span",{title:"Joueurs connect\xe9s \xe0 la partie",children:["\uD83D\uDC65 ",j," en ligne"]}):(0,s.jsx)("span",{className:"text-gray-500",children:"\xa0"})]})})]}),Q&&(0,s.jsxs)("div",{className:"mb-6 text-xs",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:["number"==typeof Q.remaining&&(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-emerald-800/40 border border-emerald-700 text-emerald-200",children:["Questions totales: ",Q.remaining]}),(null==k?void 0:k.tokens)===20&&(0,s.jsx)("span",{className:"px-2 py-1 rounded bg-yellow-600/30 border border-yellow-500 text-yellow-300 font-semibold",title:"Vous avez atteint le maximum de tokens",children:"✅ Max tokens (20)"}),Q.categories&&Q.categories.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[Q.categories.slice(0,5).map(e=>{var t,n;return(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-gray-200",title:"Restantes: ".concat(e.remaining," / Total: ").concat(null!==(t=e.total)&&void 0!==t?t:"?"," (Utilis\xe9es: ").concat(null!==(n=e.used)&&void 0!==n?n:"?",")"),children:[e.category," ",e.remaining]},e.category)}),Q.categories.length>5&&(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-gray-200",children:["+",Q.categories.length-5," autres"]})]}),(0,s.jsx)("button",{onClick:()=>V(e=>!e),className:"ml-2 px-2 py-1 rounded bg-blue-600/40 hover:bg-blue-600/60 border border-blue-500 text-blue-100",children:O?"Fermer d\xe9tails":"D\xe9tails cat\xe9gories"})]}):Q.remainingByCategory&&(0,s.jsxs)("span",{className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-gray-200",children:["Finance ",Q.remainingByCategory.finance," \xb7 \xc9conomie ",Q.remainingByCategory.economy," \xb7 Immo ",Q.remainingByCategory.realEstate]})]}),O&&Q.categories&&Q.categories.length>0&&(0,s.jsxs)("div",{className:"mt-4 bg-white/5 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"text-center font-bold mb-3 text-white/90",children:"\uD83D\uDCC2 Banque par cat\xe9gorie"}),(0,s.jsx)("div",{className:"space-y-2",children:Q.categories.slice().sort((e,t)=>e.category.localeCompare(t.category)).map(e=>{var t,n,r;let o=null!==(n=e.total)&&void 0!==n?n:e.remaining+(null!==(t=e.used)&&void 0!==t?t:0),a=null!==(r=e.used)&&void 0!==r?r:o-e.remaining,i=o>0?Math.round(e.remaining/o*100):0,l=["definitions","quebec","religions"].includes(e.category.toLowerCase()),c=["enfant","kids","enfants"].includes(e.category.toLowerCase());return(0,s.jsxs)("div",{className:"p-2 rounded border ".concat(c?"border-green-500/60 bg-green-500/10":l?"border-indigo-400/60 bg-indigo-400/10":"border-white/10 bg-white/5"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsxs)("div",{className:"font-semibold flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.category}),c&&(0,s.jsx)("span",{className:"text-xs px-1 py-0.5 rounded bg-green-600/40 border border-green-500",children:"Enfants (Q1-2)"}),l&&(0,s.jsx)("span",{className:"text-xs px-1 py-0.5 rounded bg-indigo-600/40 border border-indigo-500",children:"Cibl\xe9e (Q3-5)"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-300",children:["Restantes ",e.remaining," / Total ",o," \xb7 Utilis\xe9es ",a]})]}),(0,s.jsx)("div",{className:"h-2 rounded overflow-hidden bg-black/30",children:(0,s.jsx)("div",{className:"h-full transition-all ".concat(i<25?"bg-red-500":i<50?"bg-yellow-500":"bg-emerald-500"),style:{width:"".concat(i,"%")}})}),(0,s.jsxs)("div",{className:"mt-1 text-[10px] text-gray-400",children:[i,"% restantes"]})]},e.category)})}),(0,s.jsx)("p",{className:"mt-3 text-[10px] text-gray-400 text-center",children:"Les cat\xe9gories cibl\xe9es (D\xe9finitions, Qu\xe9bec, Religions) sont prioritaires pour les questions 3 \xe0 5."})]})]}),q&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat("success"===q.type?"bg-green-600":"bg-red-600"),children:q.message}),!E&&k&&!k.hasActiveSession&&(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center",children:[(0,s.jsxs)("div",{className:"mb-8 p-6 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-xl border-2 border-yellow-500/50",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"\uD83C\uDF9F️ Vos Tokens Quiz"}),(0,s.jsx)("div",{className:"text-6xl font-bold text-yellow-400 mb-2",children:k.tokens||0}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:k.tokens>0?"Vous avez ".concat(k.tokens," token").concat(k.tokens>1?"s":""," disponible").concat(k.tokens>1?"s":""):"Aucun token disponible"}),k.secondsUntilNextToken&&(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["⏱️ Prochain token dans ",Math.floor(k.secondsUntilNextToken/60)," min ",k.secondsUntilNextToken%60," sec"]})]}),(0,s.jsxs)("div",{className:"mb-6 bg-indigo-900/40 border border-indigo-500/30 rounded-lg p-4 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-indigo-100",children:"Recharge instantan\xe9e \uD83C\uDF81"}),(0,s.jsx)("p",{className:"text-xs text-indigo-200/70",children:"Regardez une pub pour regagner +20 tokens (cooldown 30 min)."})]}),(0,s.jsx)("button",{onClick:ex,disabled:ea||er>0||!en||(null!==(t=null==k?void 0:k.tokens)&&void 0!==t?t:0)>=20,className:"w-full py-2 rounded-lg font-semibold transition ".concat(ea||er>0||!en||(null!==(d=null==k?void 0:k.tokens)&&void 0!==d?d:0)>=20?"bg-white/10 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-400 to-green-500 text-black hover:from-emerald-300 hover:to-green-400"),children:ea?"Lecture en cours…":er>0?"Disponible dans ".concat(ef(er)):(null!==(u=null==k?void 0:k.tokens)&&void 0!==u?u:0)>=20?"Tokens d\xe9j\xe0 au maximum":en?"\uD83D\uDCFA Regarder une pub (+20 tokens)":"Pub indisponible sur cette plateforme"}),el&&(0,s.jsx)("div",{className:"text-xs text-emerald-300",children:el}),ed&&(0,s.jsx)("div",{className:"text-xs text-red-300",children:ed})]}),k.canPlay?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Pr\xeat \xe0 jouer ?"}),(0,s.jsxs)("p",{className:"mb-6 text-lg",children:["R\xe9pondez aux questions et accumulez des gains !",(0,s.jsx)("br",{}),"Vous pouvez encaisser \xe0 tout moment ou continuer pour doubler vos gains."]}),(0,s.jsxs)("div",{className:"mb-6 text-left max-w-md mx-auto bg-white/5 p-4 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"\uD83D\uDCDC R\xe8gles :"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[(0,s.jsx)("li",{children:"1 token = 1 session de quiz"}),(0,s.jsx)("li",{children:"Gagnez 1 token automatiquement toutes les heures"}),(0,s.jsx)("li",{children:"R\xe8gle Quitte ou Double: on commence \xe0 50 000 $"}),(0,s.jsx)("li",{children:"Chaque bonne r\xe9ponse double vos gains (50k → 100k → 200k → 400k ...)"}),(0,s.jsx)("li",{children:"Vous pouvez encaisser \xe0 tout moment pour s\xe9curiser vos gains"}),(0,s.jsx)("li",{children:"Mauvaise r\xe9ponse = vous perdez tout"}),(0,s.jsxs)("li",{children:["Vous pouvez sauter jusqu'\xe0 ",(0,s.jsx)("b",{children:"3 questions"})," par session"]}),(0,s.jsx)("li",{children:"Maximum 10 questions par session"}),(0,s.jsx)("li",{children:"Difficult\xe9: Q1-2 enfants, Q3-5 moyenne (tous sujets), Q6-10 difficile (tests de QI)"})]})]}),(0,s.jsx)("button",{onClick:()=>ep(),className:"px-8 py-4 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 rounded-xl font-bold text-xl transition shadow-lg",children:"\uD83C\uDFAE D\xe9marrer le Quiz (Co\xfbte 1 token)"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"⏰ Pas de token disponible"}),(0,s.jsxs)("p",{className:"mb-4 text-lg",children:["Prochain token dans ",(0,s.jsxs)("span",{className:"font-bold text-yellow-400",children:[Math.floor((k.secondsUntilNextToken||0)/60)," minutes"]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-300 mb-4",children:"Vous gagnez automatiquement 1 token toutes les heures"}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"\uD83D\uDCA1 Les tokens s'accumulent si vous ne jouez pas"}),(0,s.jsx)("div",{className:"mt-4 text-sm text-gray-300",children:"Ou gagnez imm\xe9diatement +20 tokens en regardant une publicit\xe9 ci-dessus."})]})]}),E&&z&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Question"}),(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[E.currentQuestion," / 10"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Gains actuels"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-green-400",children:(0,i.l)(E.currentEarnings)})]})]}),(0,s.jsx)("div",{className:"mb-2 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-lg font-mono px-4 py-1 rounded-full border ".concat(J<=5?"bg-red-600 border-red-500 animate-pulse":"bg-black/30 border-white/20"),children:["⏱️ ",J,"s"]})}),(0,s.jsxs)("div",{className:"text-center text-sm text-gray-300",children:["Sauts restants : ",(0,s.jsxs)("span",{className:"font-bold",children:[null!==(m=E.skipsLeft)&&void 0!==m?m:0," / 3"]})]}),(0,s.jsxs)("div",{className:"text-center text-sm text-purple-300 mt-1",children:["✨ Passes de vie : ",(0,s.jsx)("span",{className:"font-bold",children:H})]}),0===E.skipsLeft&&(0,s.jsx)("div",{className:"mt-2 flex justify-center text-xs text-gray-400",children:"Recharge de saut momentan\xe9ment indisponible."}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300 mb-1",children:"Prochain gain"}),(0,s.jsx)("div",{className:"text-3xl font-bold text-yellow-400",children:(0,i.l)(E.nextPrize)}),(null===(e=p[E.currentQuestion-1])||void 0===e?void 0:e.milestone)&&(0,s.jsx)("div",{className:"mt-2 text-xs text-green-400",children:"\uD83D\uDEE1️ Palier de s\xe9curit\xe9"})]}),E.securedAmount>0&&(0,s.jsxs)("div",{className:"mt-4 text-center text-sm text-gray-300",children:["Montant s\xe9curis\xe9 : ",(0,s.jsx)("span",{className:"font-bold text-green-400",children:(0,i.l)(E.securedAmount)})]})]}),(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:z.text}),_&&(0,s.jsxs)("div",{className:"mb-4 text-center text-red-300 text-sm",children:["Temps \xe9coul\xe9 — r\xe9ponse correcte: ",(0,s.jsx)("span",{className:"font-bold",children:B})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["A","B","C","D"].map(e=>{let t=B===e,n=B&&P===e&&B!==P,r=R||!!B,o=B?t?"bg-green-600 text-black font-bold":n?"bg-red-600 text-white font-bold":"bg-white/5":P===e?"bg-yellow-500 text-black font-bold shadow-lg":"bg-white/5 hover:bg-white/10";return(0,s.jsxs)("button",{onClick:()=>!B&&I(e),disabled:r,className:"".concat("p-4 rounded-lg text-left transition transform hover:scale-105"," ").concat(o," ").concat(r?"opacity-70 cursor-not-allowed":""),children:[(0,s.jsxs)("span",{className:"font-bold mr-2",children:[e,"."]}),z["option".concat(e)]]},e)})})]},z.id),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("button",{onClick:ew,disabled:ee,className:"w-full md:w-auto px-4 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-sm transition shadow-lg",title:"Regarder une publicit\xe9 pour obtenir une passe de vie",children:ee?"⏳ ...":"\uD83D\uDCFA Pub → +1 Passe"}),(0,s.jsxs)("button",{onClick:ey,disabled:R||0===E.currentEarnings,className:"w-full md:flex-1 px-6 py-4 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition shadow-lg",children:["\uD83D\uDCB0 Encaisser ",(0,i.l)(E.currentEarnings)]}),(0,s.jsxs)("button",{onClick:ev,disabled:R||!!B||(null!==(g=E.skipsLeft)&&void 0!==g?g:0)<=0,className:"w-full md:w-auto px-4 py-4 bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition shadow-lg",title:"Passer cette question",children:["⏭️ Passer (",null!==(h=E.skipsLeft)&&void 0!==h?h:0,"/3)"]}),(0,s.jsx)("button",{onClick:eb,disabled:!P||R||!!B,className:"w-full md:flex-1 px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition shadow-lg",children:R?"⏳ ...":"✓ Valider ma r\xe9ponse"})]})]}),(0,s.jsxs)("div",{className:"mt-8 bg-white/5 backdrop-blur-md rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4 text-center",children:"\uD83D\uDCCA \xc9chelle des gains"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 text-sm",children:p.map(e=>(0,s.jsxs)("div",{className:"p-2 rounded text-center ".concat(E&&E.currentQuestion===e.question?"bg-yellow-500 text-black font-bold":"bg-white/5"),children:[(0,s.jsxs)("div",{className:"text-xs",children:["Q",e.question]}),(0,s.jsx)("div",{className:"font-bold",children:(0,i.l)(Math.round(e.amount))})]},e.question))})]})]}),$&&(0,s.jsx)(a,{onClose:()=>Y(!1)}),W&&H>0&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-gradient-to-br from-purple-900 to-pink-900 rounded-2xl p-8 max-w-md w-full shadow-2xl border-2 border-purple-500",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"✨"}),(0,s.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"Mauvaise r\xe9ponse !"}),(0,s.jsxs)("p",{className:"text-gray-200 mb-6",children:["Vous avez ",(0,s.jsx)("span",{className:"font-bold text-yellow-400",children:H})," passe",H>1?"s":""," de vie.",(0,s.jsx)("br",{}),"Voulez-vous en utiliser une pour continuer ?"]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("button",{onClick:function(){H>0&&(K(e=>e-1),Z(!1),M({type:"success",message:"✨ Passe utilis\xe9e ! Vous continuez le quiz."}),f.reward(),setTimeout(()=>eh(),1e3))},className:"w-full px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 rounded-xl font-bold text-lg transition shadow-lg",children:"✓ Utiliser une passe et continuer"}),(0,s.jsx)("button",{onClick:()=>{Z(!1),setTimeout(()=>{X(null),T(null),D(null),I(null),eh(),eg()},5e3)},className:"w-full px-6 py-4 bg-gray-600 hover:bg-gray-500 rounded-xl font-bold transition",children:"✗ Non, arr\xeater le quiz"})]})]})})})]})}},6325:function(e,t,n){"use strict";n.d(t,{Ie:function(){return h},YY:function(){return l},fL:function(){return m},showInterstitialAd:function(){return u},yk:function(){return g}});let s=!1,r=0,o=0;function a(){var e,t,n;let s=!!(null===(t=window.Capacitor)||void 0===t?void 0:null===(e=t.isNativePlatform)||void 0===e?void 0:e.call(t));return console.log("[Ads] isNativePlatform:",s),console.log("[Ads] Capacitor available:",!!window.Capacitor),console.log("[Ads] Capacitor.isNativePlatform:",null===(n=window.Capacitor)||void 0===n?void 0:n.isNativePlatform),s}function i(){var e;let t=window.Capacitor;return(console.log("[Ads] Capacitor:",t),console.log("[Ads] Capacitor.Plugins:",null==t?void 0:t.Plugins),console.log("[Ads] Capacitor.Plugins.AdMob:",null==t?void 0:null===(e=t.Plugins)||void 0===e?void 0:e.AdMob),null==t?void 0:t.Plugins)?t.Plugins.AdMob:null}async function l(){if(!s&&a()){try{let e=localStorage.getItem("hm-ad-consent");if(!e){let t=i();if(t&&"function"==typeof t.requestConsent)try{let n=await t.requestConsent();if(n&&"boolean"==typeof n.npa){let t=n.npa?"npa":"accepted";try{localStorage.setItem("hm-ad-consent",t),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(e){}e=t}}catch(e){console.warn("[Ads] Native requestConsent failed:",e)}}if("accepted"!==e&&"npa"!==e){console.log("[Ads] User has not accepted ad consent, skipping initialization");return}}catch(e){}try{let a=i();if(!a){console.log("[Ads] AdMob plugin not available");return}await a.initialize(),s=!0;try{var e,t,n,r,o;null===(e=a.addListener)||void 0===e||e.call(a,"adShowed",()=>console.log("[Ads] Event: adShowed")),null===(t=a.addListener)||void 0===t||t.call(a,"adDismissed",()=>console.log("[Ads] Event: adDismissed")),null===(n=a.addListener)||void 0===n||n.call(a,"rewardedAdShowed",()=>console.log("[Ads] Event: rewardedAdShowed")),null===(r=a.addListener)||void 0===r||r.call(a,"rewardedAdDismissed",()=>console.log("[Ads] Event: rewardedAdDismissed")),null===(o=a.addListener)||void 0===o||o.call(a,"rewardEarned",e=>console.log("[Ads] Event: rewardEarned",e))}catch(e){console.warn("[Ads] Failed to attach listeners:",e)}await c(),await d(),console.log("[Ads] AdMob initialized successfully")}catch(e){console.error("[Ads] Failed to initialize AdMob:",e)}}}async function c(){if(!a())return;let e=i();if(e&&s)try{await e.loadInterstitial(),console.log("[Ads] Interstitial ad loaded")}catch(e){console.error("[Ads] Failed to load interstitial ad:",e)}}async function d(){if(!a())return;let e=i();if(e&&s)try{await e.loadRewardedAd(),console.log("[Ads] Rewarded ad loaded")}catch(e){console.error("[Ads] Failed to load rewarded ad:",e)}}async function u(){if(!a())return console.log("[Ads] Not on native platform"),!1;let e=i();if(!e||!s)return console.log("[Ads] AdMob not initialized"),!1;let t=Date.now();if(t-r<12e4)return console.log("[Ads] Too soon to show another ad"),!1;try{let{ready:n}=await e.isAdReady();if(!n)return console.log("[Ads] No ad ready to show, loading new one..."),c(),!1;return await e.showInterstitial(),r=t,c(),console.log("[Ads] Interstitial ad shown successfully"),!0}catch(e){return console.error("[Ads] Failed to show interstitial ad:",e),!1}}async function m(e){if(!a())return console.log("[Ads] Not on native platform"),!1;let t=i();if(!t||!s)return console.log("[Ads] AdMob not initialized"),!1;let n=Date.now();if(n-o<3e5){let e=Math.ceil((3e5-(n-o))/6e4);return console.log("[Ads] Too soon to show another rewarded ad. Wait ".concat(e," more minutes")),!1}try{let{ready:s}=await t.isRewardedAdReady();if(!s)return console.log("[Ads] No rewarded ad ready to show, loading new one..."),d(),!1;let r=await t.showRewardedAd();return o=n,e&&e(r.amount,r.type),d(),console.log("[Ads] Rewarded ad shown successfully. Reward: ".concat(r.amount," ").concat(r.type)),!0}catch(e){return console.error("[Ads] Failed to show rewarded ad:",e),!1}}async function g(){if(!a())return!1;let e=i();if(!e||!s||Date.now()-o<3e5)return!1;try{let{ready:t}=await e.isRewardedAdReady();return t}catch(e){return!1}}function h(){let e=Date.now()-o;return e>=3e5?0:Math.ceil((3e5-e)/1e3)}},9513:function(e,t,n){"use strict";n.d(t,{MS:function(){return c},SC:function(){return g},Sg:function(){return l}});var s=n(5050);let r="https://server-jeux-millionnaire.onrender.com",o=!!window.Capacitor,a=/localhost:3000$/.test(window.location.host),i="1"===s.env.NEXT_PUBLIC_FORCE_ABS,l=o||i||!a?r:"";console.log("[API] ABS_BACKEND:",r),console.log("[API] isCapacitor:",o),console.log("[API] isLocalDev:",a),console.log("[API] forceAbs:",i),console.log("[API] API_BASE:",l);class c extends Error{constructor(e,t){super(t),this.name="ApiError",this.status=e,Object.setPrototypeOf(this,c.prototype)}}let d=null,u="HM_TOKEN";async function m(){try{var e;if(d)return d;let t=await fetch("".concat(l,"/api/auth/csrf"),{credentials:"include"});if(!t.ok)return null;let n=await t.json();return d=null!==(e=null==n?void 0:n.csrf)&&void 0!==e?e:null}catch(e){return null}}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.method||"GET").toUpperCase(),s={...t.headers};if(console.log("[API] ".concat(n," ").concat(l).concat(e)),["POST","PUT","PATCH","DELETE"].includes(n)){let e=await m();e&&(s["x-csrf-token"]=e)}let r=function(){try{return window.localStorage.getItem(u)}catch(e){return null}}();r&&(s.Authorization="Bearer ".concat(r));let o=function(){try{let e=window.localStorage.getItem("hm-session");if(!e)return null;return JSON.parse(e).playerId||null}catch(e){return null}}();o&&(s["X-Player-ID"]=o);try{let n=await fetch("".concat(l).concat(e),{credentials:"include",...t,headers:s});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(r){let n=await fetch("".concat(l,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(n.ok){let r=await n.json().catch(()=>({}));if(null==r?void 0:r.token){try{window.localStorage.setItem(u,r.token)}catch(e){}s.Authorization="Bearer ".concat(r.token)}let o=await fetch("".concat(l).concat(e),{credentials:"include",...t,headers:s});if(!o.ok)throw new c(o.status,o.statusText);if(204===o.status)return;return await o.json()}}}catch(e){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let e=await n.json(),t=e&&(e.error||e.message)?String(e.error||e.message):"Erreur ".concat(n.status);throw new c(n.status,t)}{let e=(await n.text()||"").trim(),t=e.length?e:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new c(n.status,t)}}catch(t){let e=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(t instanceof c)throw t;throw new c(n.status,e)}if(204===n.status)return;return await n.json()}catch(e){throw console.error("[API] Fetch error:",e),new c(0,"Erreur r\xe9seau: ".concat(e.message||"Failed to fetch"))}}},2044:function(e,t,n){"use strict";function s(e){let t=Number(e);return isFinite(t)?"$".concat(Math.round(t).toLocaleString()):"$0"}function r(e){return 52*Number(e||0)/12}n.d(t,{P:function(){return r},l:function(){return s}})},168:function(e,t,n){"use strict";var s=n(7462);n.o(s,"usePathname")&&n.d(t,{usePathname:function(){return s.usePathname}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})},5050:function(e,t,n){"use strict";var s,r;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(9295)},9295:function(e){!function(){var t={229:function(e){var t,n,s,r=e.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l=[],c=!1,d=-1;function u(){c&&s&&(c=!1,s.length?l=s.concat(l):d=-1,l.length&&m())}function m(){if(!c){var e=i(u);c=!0;for(var t=l.length;t;){for(s=l,l=[];++d<t;)s&&s[d].run();d=-1,t=l.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||c||i(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=h,r.addListener=h,r.once=h,r.off=h,r.removeListener=h,r.removeAllListeners=h,r.emit=h,r.prependListener=h,r.prependOnceListener=h,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}},a=!0;try{t[e](o,o.exports,s),a=!1}finally{a&&delete n[e]}return o.exports}s.ab="//";var r=s(229);e.exports=r}()}},function(e){e.O(0,[115,205,744],function(){return e(e.s=4091)}),_N_E=e.O()}]);