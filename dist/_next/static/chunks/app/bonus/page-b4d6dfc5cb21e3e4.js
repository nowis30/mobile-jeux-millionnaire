(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{7438:function(e,t,n){Promise.resolve().then(n.bind(n,3678))},3678:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var o=n(7821),r=n(8078),a=n(4233),s=n(6325),l=n(2705),i=n(9513),c=n(2044);function u(){let[e,t]=(0,r.useState)(null),[n,u]=(0,r.useState)(null),[d,f]=(0,r.useState)(!1),[h,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[w,v]=(0,r.useState)(0),[x,b]=(0,r.useState)(null),[y,A]=(0,r.useState)(null),[N,j]=(0,r.useState)(""),[C,S]=(0,r.useState)(1e6);(0,r.useEffect)(()=>{let e=()=>{var e,t,n,o;let r=window,a=!!r.Capacitor,s=(null===(t=r.Capacitor)||void 0===t?void 0:null===(e=t.isNativePlatform)||void 0===e?void 0:e.call(t))||!1,l=!!(null===(o=r.Capacitor)||void 0===o?void 0:null===(n=o.Plugins)||void 0===n?void 0:n.AdMob),i="Capacitor: ".concat(a," | Native: ").concat(s," | AdMob: ").concat(l);j(i),console.log("[Bonus Debug]",i),console.log("[Bonus Debug] Full Capacitor:",r.Capacitor)};e(),setTimeout(e,2e3)},[]),(0,r.useEffect)(()=>{let e=(0,l.dF)();e&&(t(e.gameId||null),u(e.playerId||null))},[]);let T=(0,r.useCallback)(async()=>{if(e&&n)try{var t;let n=await (0,i.SC)("/api/games/".concat(e,"/bonus/status"));f(!!n.available),v(Math.max(0,Number(null!==(t=n.secondsUntilAvailable)&&void 0!==t?t:0))),"number"!=typeof n.rewardAmount||Number.isNaN(n.rewardAmount)||S(n.rewardAmount),A(null)}catch(e){if((null==e?void 0:e.status)===404)return;A((null==e?void 0:e.message)||"Impossible de r\xe9cup\xe9rer la disponibilit\xe9 du bonus.")}},[e,n]);(0,r.useEffect)(()=>{T()},[T]),(0,r.useEffect)(()=>{let e=async()=>{m(await (0,s.yk)());let e=(0,s.Ie)();e>0&&v(e)};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{if(w>0){let e=setTimeout(()=>{v(e=>Math.max(0,e-1))},1e3);return()=>clearTimeout(e)}},[w]);let I=async()=>{if(!e||!n){A("Rejoignez la partie mondiale pour d\xe9bloquer ce bonus.");return}if(!p&&!(w>0)&&d&&h){g(!0),A(null),b(null);try{var t,o;if(!await (0,s.fL)((e,t)=>{console.log("R\xe9compense AdMob gagn\xe9e: ".concat(e," ").concat(t))})){A("La pub n'a pas pu \xeatre affich\xe9e. R\xe9essayez dans quelques instants.");return}let n=await (0,i.SC)("/api/games/".concat(e,"/bonus/redeem"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),r=Number(null!==(t=null==n?void 0:n.rewardAmount)&&void 0!==t?t:C);b(r),S(r);let a=Number(null!==(o=null==n?void 0:n.secondsUntilNext)&&void 0!==o?o:0),l=(0,s.Ie)();v(Math.max(a,l)),f(!1),m(!1),T()}catch(e){(null==e?void 0:e.status)===429&&T(),console.error("Erreur lors de l'affichage de la pub:",e),A((null==e?void 0:e.message)||"Une erreur s'est produite")}finally{g(!1)}}},E=!e||!n||p||w>0||!d||!h;return(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white p-4",children:(0,o.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,o.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,o.jsxs)(a.default,{href:"/",className:"text-white/80 hover:text-white transition-colors flex items-center gap-2",children:[(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Retour"]})}),(0,o.jsxs)("div",{className:"text-center mb-8",children:[(0,o.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"\uD83D\uDCB0 Bonus Gratuit"}),(0,o.jsxs)("p",{className:"text-xl text-white/80",children:["Regardez une pub et gagnez ",(0,c.l)(C)," !"]})]}),(0,o.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 shadow-2xl border border-white/20",children:[(0,o.jsxs)("div",{className:"text-center mb-8",children:[(0,o.jsxs)("div",{className:"inline-block bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full px-8 py-4 mb-4",children:[(0,o.jsx)("div",{className:"text-sm text-white/90 uppercase tracking-wider mb-1",children:"R\xe9compense"}),(0,o.jsx)("div",{className:"text-5xl font-bold text-white",children:(0,c.l)(C)})]}),(0,o.jsx)("p",{className:"text-white/70 text-sm",children:"Regardez une publicit\xe9 de 30 secondes pour recevoir cette r\xe9compense"})]}),x&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-green-500/20 border border-green-500/50 rounded-lg text-center",children:[(0,o.jsx)("div",{className:"text-2xl mb-2",children:"\uD83C\uDF89"}),(0,o.jsxs)("div",{className:"text-lg font-semibold",children:["F\xe9licitations ! Vous avez gagn\xe9 $",x.toLocaleString()," !"]}),(0,o.jsx)("div",{className:"text-sm text-white/70 mt-2",children:"L'argent a \xe9t\xe9 ajout\xe9 \xe0 votre compte"})]}),y&&(0,o.jsx)("div",{className:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-center",children:(0,o.jsx)("div",{className:"text-sm",children:y})}),(0,o.jsx)("button",{onClick:I,disabled:E,className:"\n              w-full py-4 px-6 rounded-xl font-bold text-xl\n              transition-all duration-200 shadow-lg\n              ".concat(E?"bg-gray-500 cursor-not-allowed opacity-60":"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 hover:scale-105 active:scale-95","\n            "),children:p?(0,o.jsxs)("span",{className:"flex items-center justify-center gap-3",children:[(0,o.jsxs)("svg",{className:"animate-spin h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Chargement de la publicit\xe9..."]}):e&&n?w>0?(0,o.jsxs)("span",{children:["⏱️ Disponible dans ",(e=>{if(0===e)return"";let t=Math.floor(e/60),n=e%60;return t>0?"".concat(t,"min ").concat(n,"s"):"".concat(n,"s")})(w)]}):d?h?(0,o.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCFA"}),(0,o.jsx)("span",{children:"Regarder la publicit\xe9"})]}):(0,o.jsx)("span",{children:"\uD83D\uDCFA Chargement de la pub..."}):(0,o.jsx)("span",{children:"\uD83D\uDD04 Bonus en pr\xe9paration..."}):(0,o.jsx)("span",{children:"Connexion en cours..."})}),(0,o.jsxs)("div",{className:"mt-6 space-y-3 text-sm text-white/70",children:[(0,o.jsxs)("div",{className:"flex items-start gap-2",children:[(0,o.jsx)("span",{className:"text-green-400 mt-0.5",children:"✓"}),(0,o.jsx)("span",{children:"Regardez la publicit\xe9 en entier pour recevoir la r\xe9compense"})]}),(0,o.jsxs)("div",{className:"flex items-start gap-2",children:[(0,o.jsx)("span",{className:"text-green-400 mt-0.5",children:"✓"}),(0,o.jsx)("span",{children:"Vous pouvez gagner un bonus toutes les 5 minutes"})]}),(0,o.jsxs)("div",{className:"flex items-start gap-2",children:[(0,o.jsx)("span",{className:"text-green-400 mt-0.5",children:"✓"}),(0,o.jsx)("span",{children:"L'argent est imm\xe9diatement cr\xe9dit\xe9 sur votre compte"})]})]})]}),(0,o.jsxs)("div",{className:"mt-8 text-center text-sm text-white/50",children:[(0,o.jsx)("p",{children:"Les publicit\xe9s nous aident \xe0 maintenir le jeu gratuit pour tous"}),(0,o.jsx)("p",{className:"mt-2",children:"Merci de votre soutien ! \uD83D\uDC9C"}),N&&(0,o.jsx)("div",{className:"mt-4 p-2 bg-black/30 rounded text-xs font-mono text-left",children:N})]})]})})}},6325:function(e,t,n){"use strict";n.d(t,{Ie:function(){return m},YY:function(){return i},fL:function(){return f},showInterstitialAd:function(){return d},yk:function(){return h}});let o=!1,r=0,a=0;function s(){var e,t,n;let o=!!(null===(t=window.Capacitor)||void 0===t?void 0:null===(e=t.isNativePlatform)||void 0===e?void 0:e.call(t));return console.log("[Ads] isNativePlatform:",o),console.log("[Ads] Capacitor available:",!!window.Capacitor),console.log("[Ads] Capacitor.isNativePlatform:",null===(n=window.Capacitor)||void 0===n?void 0:n.isNativePlatform),o}function l(){var e;let t=window.Capacitor;return(console.log("[Ads] Capacitor:",t),console.log("[Ads] Capacitor.Plugins:",null==t?void 0:t.Plugins),console.log("[Ads] Capacitor.Plugins.AdMob:",null==t?void 0:null===(e=t.Plugins)||void 0===e?void 0:e.AdMob),null==t?void 0:t.Plugins)?t.Plugins.AdMob:null}async function i(){if(!o&&s()){try{let e=localStorage.getItem("hm-ad-consent");if(!e){let t=l();if(t&&"function"==typeof t.requestConsent)try{let n=await t.requestConsent();if(n&&"boolean"==typeof n.npa){let t=n.npa?"npa":"accepted";try{localStorage.setItem("hm-ad-consent",t),localStorage.setItem("hm-ad-consent-date",new Date().toISOString())}catch(e){}e=t}}catch(e){console.warn("[Ads] Native requestConsent failed:",e)}}if("accepted"!==e&&"npa"!==e){console.log("[Ads] User has not accepted ad consent, skipping initialization");return}}catch(e){}try{let s=l();if(!s){console.log("[Ads] AdMob plugin not available");return}await s.initialize(),o=!0;try{var e,t,n,r,a;null===(e=s.addListener)||void 0===e||e.call(s,"adShowed",()=>console.log("[Ads] Event: adShowed")),null===(t=s.addListener)||void 0===t||t.call(s,"adDismissed",()=>console.log("[Ads] Event: adDismissed")),null===(n=s.addListener)||void 0===n||n.call(s,"rewardedAdShowed",()=>console.log("[Ads] Event: rewardedAdShowed")),null===(r=s.addListener)||void 0===r||r.call(s,"rewardedAdDismissed",()=>console.log("[Ads] Event: rewardedAdDismissed")),null===(a=s.addListener)||void 0===a||a.call(s,"rewardEarned",e=>console.log("[Ads] Event: rewardEarned",e))}catch(e){console.warn("[Ads] Failed to attach listeners:",e)}await c(),await u(),console.log("[Ads] AdMob initialized successfully")}catch(e){console.error("[Ads] Failed to initialize AdMob:",e)}}}async function c(){if(!s())return;let e=l();if(e&&o)try{await e.loadInterstitial(),console.log("[Ads] Interstitial ad loaded")}catch(e){console.error("[Ads] Failed to load interstitial ad:",e)}}async function u(){if(!s())return;let e=l();if(e&&o)try{await e.loadRewardedAd(),console.log("[Ads] Rewarded ad loaded")}catch(e){console.error("[Ads] Failed to load rewarded ad:",e)}}async function d(){if(!s())return console.log("[Ads] Not on native platform"),!1;let e=l();if(!e||!o)return console.log("[Ads] AdMob not initialized"),!1;let t=Date.now();if(t-r<12e4)return console.log("[Ads] Too soon to show another ad"),!1;try{let{ready:n}=await e.isAdReady();if(!n)return console.log("[Ads] No ad ready to show, loading new one..."),c(),!1;return await e.showInterstitial(),r=t,c(),console.log("[Ads] Interstitial ad shown successfully"),!0}catch(e){return console.error("[Ads] Failed to show interstitial ad:",e),!1}}async function f(e){if(!s())return console.log("[Ads] Not on native platform"),!1;let t=l();if(!t||!o)return console.log("[Ads] AdMob not initialized"),!1;let n=Date.now();if(n-a<3e5){let e=Math.ceil((3e5-(n-a))/6e4);return console.log("[Ads] Too soon to show another rewarded ad. Wait ".concat(e," more minutes")),!1}try{let{ready:o}=await t.isRewardedAdReady();if(!o)return console.log("[Ads] No rewarded ad ready to show, loading new one..."),u(),!1;let r=await t.showRewardedAd();return a=n,e&&e(r.amount,r.type),u(),console.log("[Ads] Rewarded ad shown successfully. Reward: ".concat(r.amount," ").concat(r.type)),!0}catch(e){return console.error("[Ads] Failed to show rewarded ad:",e),!1}}async function h(){if(!s())return!1;let e=l();if(!e||!o||Date.now()-a<3e5)return!1;try{let{ready:t}=await e.isRewardedAdReady();return t}catch(e){return!1}}function m(){let e=Date.now()-a;return e>=3e5?0:Math.ceil((3e5-e)/1e3)}},9513:function(e,t,n){"use strict";n.d(t,{MS:function(){return c},SC:function(){return h},Sg:function(){return i}});var o=n(5050);let r="https://server-jeux-millionnaire.onrender.com",a=!!window.Capacitor,s=/localhost:3000$/.test(window.location.host),l="1"===o.env.NEXT_PUBLIC_FORCE_ABS,i=a||l||!s?r:"";console.log("[API] ABS_BACKEND:",r),console.log("[API] isCapacitor:",a),console.log("[API] isLocalDev:",s),console.log("[API] forceAbs:",l),console.log("[API] API_BASE:",i);class c extends Error{constructor(e,t){super(t),this.name="ApiError",this.status=e,Object.setPrototypeOf(this,c.prototype)}}let u=null,d="HM_TOKEN";async function f(){try{var e;if(u)return u;let t=await fetch("".concat(i,"/api/auth/csrf"),{credentials:"include"});if(!t.ok)return null;let n=await t.json();return u=null!==(e=null==n?void 0:n.csrf)&&void 0!==e?e:null}catch(e){return null}}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.method||"GET").toUpperCase(),o={...t.headers};if(console.log("[API] ".concat(n," ").concat(i).concat(e)),["POST","PUT","PATCH","DELETE"].includes(n)){let e=await f();e&&(o["x-csrf-token"]=e)}let r=function(){try{return window.localStorage.getItem(d)}catch(e){return null}}();r&&(o.Authorization="Bearer ".concat(r));let a=function(){try{let e=window.localStorage.getItem("hm-session");if(!e)return null;return JSON.parse(e).playerId||null}catch(e){return null}}();a&&(o["X-Player-ID"]=a);try{let n=await fetch("".concat(i).concat(e),{credentials:"include",...t,headers:o});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(r){let n=await fetch("".concat(i,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(r)}});if(n.ok){let r=await n.json().catch(()=>({}));if(null==r?void 0:r.token){try{window.localStorage.setItem(d,r.token)}catch(e){}o.Authorization="Bearer ".concat(r.token)}let a=await fetch("".concat(i).concat(e),{credentials:"include",...t,headers:o});if(!a.ok)throw new c(a.status,a.statusText);if(204===a.status)return;return await a.json()}}}catch(e){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let e=await n.json(),t=e&&(e.error||e.message)?String(e.error||e.message):"Erreur ".concat(n.status);throw new c(n.status,t)}{let e=(await n.text()||"").trim(),t=e.length?e:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new c(n.status,t)}}catch(t){let e=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(t instanceof c)throw t;throw new c(n.status,e)}if(204===n.status)return;return await n.json()}catch(e){throw console.error("[API] Fetch error:",e),new c(0,"Erreur r\xe9seau: ".concat(e.message||"Failed to fetch"))}}},2044:function(e,t,n){"use strict";function o(e){let t=Number(e);return isFinite(t)?"$".concat(Math.round(t).toLocaleString()):"$0"}function r(e){return 52*Number(e||0)/12}n.d(t,{P:function(){return r},l:function(){return o}})},2705:function(e,t,n){"use strict";n.d(t,{Aj:function(){return a},Ov:function(){return s},dF:function(){return r}});let o="hm-session";function r(){let e=window;if(!e)return null;try{let t=e.localStorage.getItem(o);if(!t)return null;let n=JSON.parse(t);if(!n.gameId)return null;return n}catch(e){return console.error("loadSession error",e),null}}function a(e){let t=window;t&&t.localStorage.setItem(o,JSON.stringify(e))}function s(){let e=window;e&&e.localStorage.removeItem(o)}},5050:function(e,t,n){"use strict";var o,r;e.exports=(null==(o=n.g.process)?void 0:o.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(9295)},9295:function(e){!function(){var t={229:function(e){var t,n,o,r=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var i=[],c=!1,u=-1;function d(){c&&o&&(c=!1,o.length?i=o.concat(i):u=-1,i.length&&f())}function f(){if(!c){var e=l(d);c=!0;for(var t=i.length;t;){for(o=i,i=[];++u<t;)o&&o[u].run();u=-1,t=i.length}o=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new h(e,t)),1!==i.length||c||l(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}},s=!0;try{t[e](a,a.exports,o),s=!1}finally{s&&delete n[e]}return a.exports}o.ab="//";var r=o(229);e.exports=r}()}},function(e){e.O(0,[233,115,205,744],function(){return e(e.s=7438)}),_N_E=e.O()}]);