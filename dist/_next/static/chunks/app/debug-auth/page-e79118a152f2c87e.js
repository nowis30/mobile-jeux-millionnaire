(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{8074:function(t,e,n){Promise.resolve().then(n.bind(n,9822))},9822:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return a}});var r=n(7821),o=n(8078),s=n(9513);function a(){let[t,e]=(0,o.useState)(null),[n,a]=(0,o.useState)(null),[c,i]=(0,o.useState)([]),[u,l]=(0,o.useState)(null),h=t=>i(e=>[...e,t]);return(0,o.useEffect)(()=>{try{l(localStorage.getItem("HM_TOKEN"))}catch(t){h("Impossible de lire HM_TOKEN")}(async()=>{try{let t=await (0,s.SC)("/api/auth/me");e(t)}catch(t){h("/api/auth/me \xe9chec: "+((null==t?void 0:t.message)||"inconnu"))}try{let t=await fetch("".concat(s.Sg,"/api/auth/debug-token"),{credentials:"include",headers:u?{Authorization:"Bearer ".concat(u)}:{}});if(t.ok){let e=await t.json();a(e.payload)}else{let e=await t.json().catch(()=>({}));h("/api/auth/debug-token status "+t.status+" "+(e.error||t.statusText))}}catch(t){h("/api/auth/debug-token fetch error: "+((null==t?void 0:t.message)||"inconnu"))}})()},[u]),(0,r.jsxs)("main",{className:"max-w-lg mx-auto space-y-4",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"Debug Auth"}),(0,r.jsxs)("div",{className:"p-3 rounded bg-neutral-900 border border-neutral-700 text-xs space-y-2",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"API_BASE:"})," ",s.Sg]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"HM_TOKEN localStorage:"})," ",u||"null"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Me:"})," ",t?JSON.stringify(t):"null"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Payload JWT:"})," ",n?JSON.stringify(n):"null"]}),c.length>0&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-red-400 font-medium",children:"Erreurs:"}),c.map((t,e)=>(0,r.jsxs)("p",{className:"text-red-300",children:["â€¢ ",t]},e))]})]}),(0,r.jsx)("p",{className:"text-xs opacity-70",children:"Si le payload est null mais HM_TOKEN pr\xe9sent, le serveur rejette le token (expir\xe9 ou mauvais). Reconnectez-vous sur /login."})]})}},9513:function(t,e,n){"use strict";n.d(e,{MS:function(){return u},SC:function(){return d},Sg:function(){return i}});var r=n(5050);let o="https://server-jeux-millionnaire.onrender.com",s=!!window.Capacitor,a=/localhost:3000$/.test(window.location.host),c="1"===r.env.NEXT_PUBLIC_FORCE_ABS,i=s||c||!a?o:"";console.log("[API] ABS_BACKEND:",o),console.log("[API] isCapacitor:",s),console.log("[API] isLocalDev:",a),console.log("[API] forceAbs:",c),console.log("[API] API_BASE:",i);class u extends Error{constructor(t,e){super(e),this.name="ApiError",this.status=t,Object.setPrototypeOf(this,u.prototype)}}let l=null,h="HM_TOKEN";async function f(){try{var t;if(l)return l;let e=await fetch("".concat(i,"/api/auth/csrf"),{credentials:"include"});if(!e.ok)return null;let n=await e.json();return l=null!==(t=null==n?void 0:n.csrf)&&void 0!==t?t:null}catch(t){return null}}async function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(e.method||"GET").toUpperCase(),r={...e.headers};if(console.log("[API] ".concat(n," ").concat(i).concat(t)),["POST","PUT","PATCH","DELETE"].includes(n)){let t=await f();t&&(r["x-csrf-token"]=t)}let o=function(){try{return window.localStorage.getItem(h)}catch(t){return null}}();o&&(r.Authorization="Bearer ".concat(o));let s=function(){try{let t=window.localStorage.getItem("hm-session");if(!t)return null;return JSON.parse(t).playerId||null}catch(t){return null}}();s&&(r["X-Player-ID"]=s);try{let n=await fetch("".concat(i).concat(t),{credentials:"include",...e,headers:r});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(o){let n=await fetch("".concat(i,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(o)}});if(n.ok){let o=await n.json().catch(()=>({}));if(null==o?void 0:o.token){try{window.localStorage.setItem(h,o.token)}catch(t){}r.Authorization="Bearer ".concat(o.token)}let s=await fetch("".concat(i).concat(t),{credentials:"include",...e,headers:r});if(!s.ok)throw new u(s.status,s.statusText);if(204===s.status)return;return await s.json()}}}catch(t){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let t=await n.json(),e=t&&(t.error||t.message)?String(t.error||t.message):"Erreur ".concat(n.status);throw new u(n.status,e)}{let t=(await n.text()||"").trim(),e=t.length?t:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new u(n.status,e)}}catch(e){let t=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(e instanceof u)throw e;throw new u(n.status,t)}if(204===n.status)return;return await n.json()}catch(t){throw console.error("[API] Fetch error:",t),new u(0,"Erreur r\xe9seau: ".concat(t.message||"Failed to fetch"))}}},5050:function(t,e,n){"use strict";var r,o;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(9295)},9295:function(t){!function(){var e={229:function(t){var e,n,r,o=t.exports={};function s(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function c(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:s}catch(t){e=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var i=[],u=!1,l=-1;function h(){u&&r&&(u=!1,r.length?i=r.concat(i):l=-1,i.length&&f())}function f(){if(!u){var t=c(h);u=!0;for(var e=i.length;e;){for(r=i,i=[];++l<e;)r&&r[l].run();l=-1,e=i.length}r=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}o.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];i.push(new d(t,e)),1!==i.length||u||c(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(t){return[]},o.binding=function(t){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var s=n[t]={exports:{}},a=!0;try{e[t](s,s.exports,r),a=!1}finally{a&&delete n[t]}return s.exports}r.ab="//";var o=r(229);t.exports=o}()}},function(t){t.O(0,[115,205,744],function(){return t(t.s=8074)}),_N_E=t.O()}]);