(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[579],{3898:function(e,t,n){Promise.resolve().then(n.bind(n,5468))},5468:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n(7821),a=n(8078),s=n(9513),l=n(2044);function i(){let[e,t]=(0,a.useState)(""),[n,i]=(0,a.useState)(""),[c,o]=(0,a.useState)(""),[u,d]=(0,a.useState)([]),[m,h]=(0,a.useState)(null),[x,f]=(0,a.useState)([]),[v,p]=(0,a.useState)(!1),[g,j]=(0,a.useState)(null),[y,N]=(0,a.useState)({});(0,a.useEffect)(()=>{(async()=>{try{var e;let n=await (0,s.SC)("/api/games"),r=null===(e=n.games)||void 0===e?void 0:e[0];(null==r?void 0:r.id)&&t(r.id)}catch(e){}})()},[]),(0,a.useEffect)(()=>{e&&(async()=>{try{var t;let n=await (0,s.SC)("/api/games/".concat(e,"/me"));(null==n?void 0:null===(t=n.player)||void 0===t?void 0:t.id)&&i(n.player.id)}catch(e){}})()},[e]),(0,a.useEffect)(()=>{e&&(async()=>{try{let t=await (0,s.SC)("/api/games/".concat(e,"/state"));d((t.players||[]).map(e=>({id:e.id,nickname:e.nickname})))}catch(e){}})()},[e]);let w=(0,a.useCallback)(async()=>{let t=c||n;if(e&&t){p(!0);try{let n=await (0,s.SC)("/api/games/".concat(e,"/players/").concat(t,"/portfolio"));h(n),j(null)}catch(e){j(e instanceof Error?e.message:"Erreur chargement portefeuille")}finally{p(!1)}}},[e,n,c]),b=(0,a.useCallback)(async()=>{let t=c||n;if(e&&t)try{var r;let n=await (0,s.SC)("/api/games/".concat(e,"/properties/holdings/").concat(t));f(null!==(r=n.holdings)&&void 0!==r?r:[])}catch(e){}},[e,n,c]);(0,a.useEffect)(()=>{e&&n&&(w(),b())},[e,n,w,b]);let T=(0,a.useCallback)(async t=>{var n,r;let a=Number(null!==(n=y[t])&&void 0!==n?n:0);if(!e||!t||a<=0)return alert("Montant invalide");try{let n=await (0,s.SC)("/api/games/".concat(e,"/properties/").concat(t,"/repay"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:a})});alert("Remboursement appliqu\xe9: ".concat((0,l.l)(Math.round(null!==(r=n.applied)&&void 0!==r?r:a)))),await Promise.all([w(),b()])}catch(e){alert(e instanceof Error?e.message:"Erreur remboursement")}},[e,y,w,b]),k=(0,a.useMemo)(()=>(null==m?void 0:m.totals)?m.totals:null,[m]);return(0,r.jsxs)("main",{className:"space-y-6",children:[(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Portefeuille"}),(0,r.jsx)("p",{className:"text-sm text-neutral-300",children:"Vue agr\xe9g\xe9e de vos immeubles, dette et gains cumul\xe9s."}),(0,r.jsxs)("div",{className:"mt-2 flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[(0,r.jsx)("label",{className:"text-xs text-neutral-400",children:"Voir le portefeuille de:"}),(0,r.jsx)("select",{value:c||n,onChange:e=>o(e.target.value===n?"":e.target.value),className:"px-2 py-1 rounded bg-neutral-900 border border-neutral-700 text-xs",children:[...u].sort((e,t)=>e.nickname.localeCompare(t.nickname)).map(e=>(0,r.jsx)("option",{value:e.id,children:e.nickname||e.id.slice(0,6)},e.id))}),c&&c!==n&&(0,r.jsx)("span",{className:"text-[11px] text-neutral-500",children:"Lecture seule"})]})]}),(0,r.jsxs)("section",{className:"space-y-3",children:[v&&(0,r.jsx)("div",{className:"text-sm text-neutral-400",children:"Chargementâ€¦"}),g&&(0,r.jsx)("div",{className:"text-sm text-rose-400",children:g}),k&&(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-neutral-300",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Valeur totale"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(k.totalValue))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Dette totale"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(k.totalDebt))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Cashflow (mensuel)"}),(0,r.jsx)("div",{className:"font-medium ".concat(k.monthlyNet>=0?"text-emerald-400":"text-rose-400"),children:(0,l.l)(Math.round(k.monthlyNet))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Biens"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:k.holdingsCount})]})]}),k&&(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-neutral-300 mt-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Loyers (hebdo)"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(k.weeklyRent||0))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Hypoth\xe8que (hebdo)"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(k.weeklyDebt||0))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Charges fixes (hebdo)"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(k.weeklyFixed||0))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Net (hebdo)"}),(0,r.jsx)("div",{className:"".concat((k.weeklyNet||0)>=0?"text-emerald-400":"text-rose-400"," font-medium"),children:(0,l.l)(Math.round(k.weeklyNet||0))})]})]}),(null==m?void 0:m.playerGains)&&(0,r.jsx)("div",{className:"mt-3 border border-neutral-800 rounded bg-neutral-950 p-3 text-xs text-neutral-300",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Gains cumul\xe9s (Pari)"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(m.playerGains.cumulativePariGain))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Gains cumul\xe9s (Quiz)"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(m.playerGains.cumulativeQuizGain))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"March\xe9 (r\xe9alis\xe9s)"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(m.playerGains.cumulativeMarketRealized))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-neutral-400",children:"Dividendes cumul\xe9s"}),(0,r.jsx)("div",{className:"font-medium text-neutral-200",children:(0,l.l)(Math.round(m.playerGains.cumulativeMarketDividends))})]})]})}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold",children:"Mes biens"}),0===x.length?(0,r.jsx)("p",{className:"text-sm text-neutral-400",children:"Vous n'avez pas de biens."}):(0,r.jsx)("div",{className:"grid gap-3",children:x.map(e=>{var t,a,s,i,o,u,d;return(0,r.jsxs)("div",{className:"border border-neutral-800 rounded bg-neutral-900 p-3 text-xs text-neutral-300",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:null!==(a=null===(t=e.template)||void 0===t?void 0:t.name)&&void 0!==a?a:"Bien"}),(0,r.jsxs)("div",{className:"text-neutral-400 text-[12px]",children:["Valeur: ",(0,l.l)(Math.round(null!==(s=e.currentValue)&&void 0!==s?s:0))," \xb7 Dette: ",(0,l.l)(Math.round(null!==(i=e.mortgageDebt)&&void 0!==i?i:0))]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-neutral-400 text-[12px]",children:["Loyer hebdo: ",(0,l.l)(Math.round(null!==(o=e.currentRent)&&void 0!==o?o:0))]}),(0,r.jsxs)("div",{className:"text-neutral-400 text-[12px]",children:["Paiement hebdo: ",(0,l.l)(Math.round(null!==(u=e.weeklyPayment)&&void 0!==u?u:0))]})]})]}),(!c||c===n)&&(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,r.jsx)("input",{type:"number",className:"px-2 py-1 rounded bg-neutral-800 border border-neutral-700 text-xs",placeholder:"Montant \xe0 rembourser",value:null!==(d=y[e.id])&&void 0!==d?d:"",onChange:t=>N(n=>({...n,[e.id]:Number(t.target.value)}))}),(0,r.jsx)("button",{onClick:()=>T(e.id),className:"px-3 py-1.5 rounded bg-emerald-600 hover:bg-emerald-500 text-sm",children:"Rembourser"})]})]},e.id)})})]})]})]})}},9513:function(e,t,n){"use strict";n.d(t,{MS:function(){return o},SC:function(){return h},Sg:function(){return c}});var r=n(5050);let a="https://server-jeux-millionnaire.onrender.com",s=!!window.Capacitor,l=/localhost:3000$/.test(window.location.host),i="1"===r.env.NEXT_PUBLIC_FORCE_ABS,c=s||i||!l?a:"";console.log("[API] ABS_BACKEND:",a),console.log("[API] isCapacitor:",s),console.log("[API] isLocalDev:",l),console.log("[API] forceAbs:",i),console.log("[API] API_BASE:",c);class o extends Error{constructor(e,t){super(t),this.name="ApiError",this.status=e,Object.setPrototypeOf(this,o.prototype)}}let u=null,d="HM_TOKEN";async function m(){try{var e;if(u)return u;let t=await fetch("".concat(c,"/api/auth/csrf"),{credentials:"include"});if(!t.ok)return null;let n=await t.json();return u=null!==(e=null==n?void 0:n.csrf)&&void 0!==e?e:null}catch(e){return null}}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.method||"GET").toUpperCase(),r={...t.headers};if(console.log("[API] ".concat(n," ").concat(c).concat(e)),["POST","PUT","PATCH","DELETE"].includes(n)){let e=await m();e&&(r["x-csrf-token"]=e)}let a=function(){try{return window.localStorage.getItem(d)}catch(e){return null}}();a&&(r.Authorization="Bearer ".concat(a));let s=function(){try{let e=window.localStorage.getItem("hm-session");if(!e)return null;return JSON.parse(e).playerId||null}catch(e){return null}}();s&&(r["X-Player-ID"]=s);try{let n=await fetch("".concat(c).concat(e),{credentials:"include",...t,headers:r});if(console.log("[API] Response ".concat(n.status," ").concat(n.statusText)),401===n.status)try{if(a){let n=await fetch("".concat(c,"/api/auth/refresh"),{credentials:"include",headers:{Authorization:"Bearer ".concat(a)}});if(n.ok){let a=await n.json().catch(()=>({}));if(null==a?void 0:a.token){try{window.localStorage.setItem(d,a.token)}catch(e){}r.Authorization="Bearer ".concat(a.token)}let s=await fetch("".concat(c).concat(e),{credentials:"include",...t,headers:r});if(!s.ok)throw new o(s.status,s.statusText);if(204===s.status)return;return await s.json()}}}catch(e){}if(!n.ok)try{if((n.headers.get("content-type")||"").includes("application/json")){let e=await n.json(),t=e&&(e.error||e.message)?String(e.error||e.message):"Erreur ".concat(n.status);throw new o(n.status,t)}{let e=(await n.text()||"").trim(),t=e.length?e:n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);throw new o(n.status,t)}}catch(t){let e=n.statusText?"".concat(n.status," ").concat(n.statusText):"Erreur ".concat(n.status);if(t instanceof o)throw t;throw new o(n.status,e)}if(204===n.status)return;return await n.json()}catch(e){throw console.error("[API] Fetch error:",e),new o(0,"Erreur r\xe9seau: ".concat(e.message||"Failed to fetch"))}}},2044:function(e,t,n){"use strict";function r(e){let t=Number(e);return isFinite(t)?"$".concat(Math.round(t).toLocaleString()):"$0"}function a(e){return 52*Number(e||0)/12}n.d(t,{P:function(){return a},l:function(){return r}})},5050:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(9295)},9295:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:l}catch(e){n=l}}();var c=[],o=!1,u=-1;function d(){o&&r&&(o=!1,r.length?c=r.concat(c):u=-1,c.length&&m())}function m(){if(!o){var e=i(d);o=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,o=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===l||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||o||i(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=x,a.addListener=x,a.once=x,a.off=x,a.removeListener=x,a.removeAllListeners=x,a.emit=x,a.prependListener=x,a.prependOnceListener=x,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}},l=!0;try{t[e](s,s.exports,r),l=!1}finally{l&&delete n[e]}return s.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[115,205,744],function(){return e(e.s=3898)}),_N_E=e.O()}]);